<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>梁述锥的博客</title>
  <subtitle>让学习成为一种习惯！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="//Sujuei.me/"/>
  <updated>2016-11-21T07:51:04.755Z</updated>
  <id>//Sujuei.me/</id>
  
  <author>
    <name>sujuei</name>
    <email>liangshuzhui@foxmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>鼓浪屿</title>
    <link href="//Sujuei.me/2016/08/01/gulangyu/"/>
    <id>//Sujuei.me/2016/08/01/gulangyu/</id>
    <published>2016-07-31T17:36:00.000Z</published>
    <updated>2016-11-21T07:51:04.755Z</updated>
    
    <content type="html"><![CDATA[<p>—— Sujuei 2015.11.04</p>
<p>要不要去厦门玩玩？<br>这个问题，在出发前一晚还是个问题。<br>早上一起来，感觉无数个灵魂在逼催着我：去！<br>这感觉过于强烈，似乎不去那儿，世界就要毁灭了…</p>
<p><img src="/assets/blogImg/gulangyu.jpg" alt="a cat"><br><a id="more"></a><br>为了拯救世界，买了到厦门的动车票，再从三丘田码头坐轮渡，傍晚来到了鼓浪屿。<br>住的客栈接近龙头路，吃的玩的都有，一个人也逍遥自在。<br>赖皮鸭，虾扯蛋，芒果冰，林氏鱼丸，烧仙草，当然还有各种海鲜，变着花样来品尝。<br>睡觉时还惦记着没能排队买到的肠粉。</p>
<p>第二天主要是游览古迹。观海园、怡园、皓月园、菽庄藏海，路程虽远，但也有趣。<br>路遇算命猜姓的先生，20块钱，猜你姓名。<br>我在一旁看看究竟。<br>原来有很张写满姓氏的卡片，要猜的人，需要挑选出包含自己姓氏的那张。<br>如此重复几次，算命先生能准确猜出你的姓氏。</p>
<p>无非是数学游戏，一横一竖，玄机在交叉点呗。<br>不过断人财路可不好，笑笑离开。</p>
<p>当然，作为一个路痴，旅行中不出点意外好像就是最大的意外。<br>不出所料，我迷路了。<br>等我赶到日光岩时，月光已经洒满了海面。<br>门票已经买了，我还是想上去，即使这地儿人影都没有。</p>
<p>日光寺在山腰，弘一法师曾在这住过。<br>登山时，寺里梵唱迭起，木鱼敲击，声声入耳，仿佛从四面八方涌来。<br>感觉自己的身体暴露在广大的宗教尊严面前<br>渺小而恐惧。<br>手机的电筒不能安慰心理，索性关掉了。</p>
<p>我不会梵语，但会背心经。也在心中默念“照见五蕴皆空，度一切苦厄…”<br>不知不觉，突然发现已来到了山顶。<br>就这样，一座岛的全貌突然尽收眼底。<br>这是见过的，最美的鼓浪屿。<br>风呼呼的吹，仿佛月光不是直直的，有了一些弧度与质感。<br>心情便好多了。什么升职加薪迎娶白富美，都去TMD。</p>
<p>随后，我听到身后有脚步声，有人也跑到了山顶<br>定睛一看，居然还是个女孩。<br>我们见到对方都相视一笑，随后约好一起下山。<br>她说她叫天天，天天快乐的天天。</p>
<p>跟她去看了音乐会，又走到龙头路找吃的。<br>但她什么也不愿意吃，一问，她说，想吃酸辣土豆丝。<br>只有笑着承认，真是意料之外的答案。<br>我出来玩，就是为了吃平时吃不到的东西；<br>她则是觉得家乡的菜最熟悉，在哪都愿意吃的。</p>
<p>好吧，陪你吃，<br>因为离开武汉这么久，我也挺想念这道菜。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;—— Sujuei 2015.11.04&lt;/p&gt;
&lt;p&gt;要不要去厦门玩玩？&lt;br&gt;这个问题，在出发前一晚还是个问题。&lt;br&gt;早上一起来，感觉无数个灵魂在逼催着我：去！&lt;br&gt;这感觉过于强烈，似乎不去那儿，世界就要毁灭了…&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/blogImg/gulangyu.jpg&quot; alt=&quot;a cat&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="旅行" scheme="//Sujuei.me/tags/%E6%97%85%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>hexo在github的搭建</title>
    <link href="//Sujuei.me/2016/05/12/hexo-hello/"/>
    <id>//Sujuei.me/2016/05/12/hexo-hello/</id>
    <published>2016-05-12T00:55:00.000Z</published>
    <updated>2016-11-21T08:47:33.282Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/hexo1.jpg" alt="hexo标题">   </p>
<p>##安装node.js<br>下载-安装<br><img src="/assets/blogImg/hexo2.jpg" alt="hexo标题"><br>参考链接：<br><a href="http://jingyan.baidu.com/article/b0b63dbfca599a4a483070a5.html" target="_blank" rel="external">http://jingyan.baidu.com/article/b0b63dbfca599a4a483070a5.html</a></p>
<p>##打开Telent客户端（如果没打开会出错）<br>如果是windowXP<br>输入<br>win7:<br><img src="/assets/blogImg/hexo3.jpg" alt="hexo标题"><br>xp:<br>在[运行]中输入”services.msc”，确定后出现[服务管理器]；<br>或者在[控制面板]里进入[管理工具]，运行[服务]就会出现[服务管理器]；<br>在[服务管理器]中找到[Telnet] 项，按键盘的”t”-“e”-“l”键很快就能找着；<br>在双击后出现的[属性对话框]中[启动类型]改为[自动]或[手动]；<br>启动Telnet服务<br>在[属性对话框]中的[服务状态]项中点击[启动]；<br>在[运行]中输入”cmd”，确定后在光标提示符输入”net start telnet”回车，当屏幕显示”Telnet服务正在启动…Telnet 服务已经启动成功。”后，说明Telnet服务已经在你本机启动了。</p>
<ol>
<li>安装git<br><img src="/assets/blogImg/hexo4.jpg" alt="hexo标题"><br>点击下一步完成即可<br>##SSH<br>生成SSH密钥<br>查看是否已经有了ssh密钥：<br>cd ~/.ssh<br>如果没有密钥则不会有此文件夹，有则备份删除<br>生成密钥：<br>$ ssh-keygen -t rsa -c “you@gmail.com”<br>按3个回车，密码为空。<br>最后得到了两个文件：id_rsa和id_rsa.pub<br><img src="/assets/blogImg/hexo5.jpg" alt="hexo标题"><br>打开github网站<br>在github上添加ssh密钥，这要添加的是“id_rsa.pub”里面的公钥。<br>选择Settings<br><img src="/assets/blogImg/hexo6.jpg" alt="hexo标题"><br>选择 SSH and GDP keys<br><img src="/assets/blogImg/hexo7.jpg" alt="hexo标题"><br>点击new ssh key<br><img src="/assets/blogImg/hexo8.jpg" alt="hexo标题"><br>添加id_rsa.pub里面的公钥到key中提交即可<br><img src="/assets/blogImg/hexo9.jpg" alt="hexo标题"><br>#安装插件<br>npm install hexo-deployer-git –save<br>##安装HEXO<br>官网：<a href="https://hexo.io/zh-cn/" target="_blank" rel="external">https://hexo.io/zh-cn/</a><br>右击选择 Bash<br><img src="/assets/blogImg/hexo10.jpg" alt="hexo标题"><br>选择想要存放盘 cd<br>npm install hexo-cli -g//安装</li>
</ol>
<p>hexo -v//查看版本号（如果可以显示说明安装成功）</p>
<p>hexo init myblog//初始化一个博客（myblog随便取）</p>
<p>cd myblog//选择（同上面myblog的取名）</p>
<p>npm install//初始化博客</p>
<p> hexo g//生成静态网页（输入后查看根目录是否有public文件夹，如果没有请重装）</p>
<p>hexo server//开启服务器</p>
<p>在浏览器中输入：<a href="http://127.0.0.1:4000/" target="_blank" rel="external">http://127.0.0.1:4000/</a><br><img src="/assets/blogImg/hexo11.jpg" alt="hexo标题"><br>安装完成</p>
<p>##建github库与推送<br><img src="/assets/blogImg/hexo12.jpg" alt="hexo标题"><br>复制克隆码（一定要是SSH的）<br><img src="/assets/blogImg/hexo13.jpg" alt="hexo标题"><br>打开博客存放位置进入_config.yml（配置文件）<br><img src="/assets/blogImg/hexo14.jpg" alt="hexo标题"><br>在deploy:位置输入<br>deploy://前面不能有有空格<br>  type: git<br>  repo: git@github.com:crazezy2333/crazezy2333.github.io.git //克隆码<br>  branch: master<br>推送<br>hexo clean//清除原静态网页<br>hexo generate//生成静态网页<br>hexo deploy//推送<br>完成</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/hexo1.jpg&quot; alt=&quot;hexo标题&quot;&gt;   &lt;/p&gt;
&lt;p&gt;##安装node.js&lt;br&gt;下载-安装&lt;br&gt;&lt;img src=&quot;/assets/blogImg/hexo2.jpg&quot; alt=&quot;hexo标题&quot;&gt;&lt;b
    
    </summary>
    
    
      <category term="hexo" scheme="//Sujuei.me/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>Nginx能为前端开发带来什么？</title>
    <link href="//Sujuei.me/2015/11/03/nginx-in-fe/"/>
    <id>//Sujuei.me/2015/11/03/nginx-in-fe/</id>
    <published>2015-11-03T13:30:00.000Z</published>
    <updated>2016-11-21T07:52:57.922Z</updated>
    
    <content type="html"><![CDATA[<p>Nginx那么好，我想去看看。<br>接连逛了两个书城后，我发现并没有Nginx相关的书籍。<br>这就很奇怪！</p>
<p><img src="/assets/blogImg/nginx0.jpg" alt=""></p>
<p>Nginx，一名<strong>网红</strong>（网络服务器红人…），就算没有自传和回忆录，争着介绍它的花边新闻也该有吧。</p>
<p>后来找到仅有的一两本书籍，也直接深入到“源码剖析”的阶段。写得并不十分满意，况且我还不需要这些。<br>后来发现了原因，大概是因为<strong>“使用太简单了，都不值得出书”</strong>。<br>是的，Nginx把纷繁复杂的功能，浓缩成一份简单的配置，极易上手。<br>当它呈现到你面前时，感觉独具匠心。</p>
<a id="more"></a>
<h3 id="Nginx与NodeJs"><a href="#Nginx与NodeJs" class="headerlink" title="Nginx与NodeJs"></a>Nginx与NodeJs</h3><p>（这里的标题有点歧义。此处的NodeJs，皆引申为NodeJs所搭建的服务器。）</p>
<p>有人说，作为一名前端，<strong>我的真爱是NodeJs</strong>。<br>同时也认同，抛去性能之类的比较，单纯从实现的角度，NodeJs编写的服务器也能实现Nginx的各种功能。                </p>
<p>这些我都赞成，但使用Nginx并不意味着抛弃NodeJs。事实上，它们并不冲突，还可以在一起愉快的玩耍。              </p>
<p>在业内，这样的模型已很常见：资源转发，反向代理，静态资源处理，负载均衡，这些事情扔给Nginx来处理，只是几行配置的事情；同时在上游，让NodeJs去处理它最擅长的I/O等事情。               </p>
<p>合理分配各自<strong>擅长</strong>的事情，这样的思路，同样可以运用于前端开发中。                </p>
<p>以前用NodeJs几百行实现的服务器功能，在npm与github的海洋里花尽心思去寻找的模块，也许在Nginx里是一条成熟的配置。它能帮其分担很多事情，节约了成本。                  </p>
<h3 id="场景一：环境切换"><a href="#场景一：环境切换" class="headerlink" title="场景一：环境切换"></a>场景一：环境切换</h3><p>前端开发中，经常面临多个部署环境切换的问题。<br>我们通常用配hosts的方式去实现。更优化些，我们将机器的服务绑定了不同的域名：比如正式环境是a.qq.com，测试环境是test.a.qq.com。 </p>
<p>然而在拓展性和易用性方面，还不足够好。<br>而Nginx作为反向代理，就很容易处理资源转发的问题。                 </p>
<p>思路很简单：</p>
<blockquote>
<ol>
<li>读取请求里的cookie，如果键名host_id有值，则代理到这个IP地址；</li>
<li>如果没有，则代理到默认的正式环境（此处举例为1.1.1.1）;</li>
</ol>
</blockquote>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">set</span> $env_id <span class="comment">"1.1.1.1"</span>;</div><div class="line"><span class="keyword">if</span> ( <span class="symbol">$</span>http_cookie ~* <span class="string">"host_id=(\S+)(;.*|$)"</span>) &#123;</div><div class="line">    <span class="keyword">set</span> $env_id <span class="comment">$1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">location / &#123;</div><div class="line">    proxy_set_header Host <span class="symbol">$</span>host;</div><div class="line">    proxy_pass   http:<span class="comment">//$env_id:80;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那接下来的事情，就是<strong>怎样用最简便的方式，把IP种在cookie里？</strong><br>我们应用了nginx-http-footer-filter模块，html文件经过代理时，都注入了一小段js代码。</p>
<p>这段代码，会帮我们展示小菜单，点击某个环境时，则将IP种到cookie里，同时刷新页面，让Nginx完成环境切换。<br><img src="/assets/blogImg/nginx1.jpg" alt=""></p>
<p>切换环境，如今只需点击一次。</p>
<h3 id="场景二：SourceMap"><a href="#场景二：SourceMap" class="headerlink" title="场景二：SourceMap"></a>场景二：SourceMap</h3><p>在线上环境调试Js代码是件麻烦的事情，因为目前合格的前端部署，代码都应经过压缩。性能问题是优化了，debug可不怎么方便。</p>
<p>而SourceMap正好可以解决此问题。</p>
<p>在最新的各版本浏览器里，如果满足：</p>
<ol>
<li>压缩后的js文件后面有<code>//# sourceMappingURL=xxx.map</code>格式的注释</li>
<li>浏览器能正常访问到sourceMappingURL</li>
</ol>
<p>那么，就能把压缩过的代码还原。<br>要实现这样的功能，就必须：</p>
<ol>
<li>现网环境不带以上形式的注释，同时访问不到sourceMap（安全性考虑）</li>
<li>测试环境带注释，能访问sourceMap</li>
</ol>
<p>这样的模型，用<code>反向代理+内容纂改</code>的思路再合适不过。<br>每次构建编译时，我们会把sourceMap文件存放到一台机器（举例为1.1.1.1），命名为js文件名后加<code>.map</code>后缀。随后，使用Nginx，通过这几行配置就能把此功能实现：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">location</span> <span class="regexp">~ \.js$</span> &#123;</div><div class="line">    <span class="attribute">footer</span> <span class="string">"\n//# sourceMappingURL=<span class="variable">$request_uri</span>.map"</span>;</div><div class="line">    <span class="attribute">footer_types</span> <span class="string">"*"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>只要经过代理，在chrome里，我们能看到每份被压缩过的js文件，都有一个对应的源码文件。<br>你可以直接使用它来做打断点之类的操作，大大的提升了调试质量。<br><img src="/assets/blogImg/nginx2.jpg" alt=""></p>
<h3 id="场景三：内容纂改"><a href="#场景三：内容纂改" class="headerlink" title="场景三：内容纂改"></a>场景三：内容纂改</h3><p>其实在以上两个场景里，都涉及了“内容纂改”。<br>无论是说“纂改”还是“劫持”，大家的印象都不是什么好事情，但另一方面，他们又可以让事情有趣起来。</p>
<p>统一介绍下，Nginx涉及纂改的模块有：</p>
<ul>
<li><a href="https://m.oschina.net/blog/156826" target="_blank" rel="external">nginx_http_footer_filter</a>：往文件的底部添加文字，可包含Nginx的内置变量；</li>
<li><a href="http://nginx.org/en/docs/http/ngx_http_addition_module.html" target="_blank" rel="external">nginx_http_addition_module</a>：从一个url去读取内容，将之添加到文件的头部或顶部；</li>
<li><a href="http://nginx.org/en/docs/http/ngx_http_sub_module.html" target="_blank" rel="external">nginx_http_sub_module</a>：替换字符</li>
</ul>
<p>除去上面两种场景，合理运用这些模块对应的配置，可以做出许多小工具，这是很有想象力的事情。<br>单单针对移动web前端开发，就可以实现： </p>
<blockquote>
<ol>
<li>将<a href="http://people.apache.org/~pmuellr/weinre-docs/latest/" target="_blank" rel="external">weinre</a>脚本插入到html里，让移动web调试更加便捷。</li>
<li>移动web经常用到localStorage优化首屏，但debug时又会受到干扰，通过一个按钮很方便的清除本地缓存。</li>
<li>手机APP内嵌页面，很难将其网址分享给另一个人。通过一个按钮就能生成url对应的二维码等</li>
</ol>
</blockquote>
<h3 id="场景四：本地映射"><a href="#场景四：本地映射" class="headerlink" title="场景四：本地映射"></a>场景四：本地映射</h3><p>在Windows下的前端抓包调试，Fiddler+Willow的能力毋庸置疑。<br>而脱离了.NET体系的Linux和Mac，即使有一些代替工具，但某些方面还是略显不足。   </p>
<p>比如：<strong>线上接口映射到本地文件</strong>。<br>想到Fiddler的本质也是一个代理，而开启一个有这样能力的Nginx服务，并不是太难的事情。           </p>
<p>而且，我们可以做得更灵活，比如：</p>
<ul>
<li>同时支持慢速调试</li>
<li>同时支持目录层级映射</li>
<li>同时支持正则匹配</li>
<li>JSON返回的数据有可能是变化的（比如分页时候），同时支持动态数据</li>
</ul>
<p>这些场景，只运用到Nginx里的“<a href="http://www.linuxidc.com/Linux/2014-01/95493.htm" target="_blank" rel="external">rewrite规则</a>”。<br>从参考的文档可以大致看到，rewrite规则非常灵活，能完成各种场景的转发。 </p>
<p>最简单的模型中，我们把所有带<code>cgi-bin</code>路径的请求，rewite到本地的一个服务，同时带上请求的所有参数，<br>仅需这三行配置即可：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">location</span> <span class="regexp">~ /cgi-bin/*</span> &#123;</div><div class="line">    <span class="attribute">rewrite</span><span class="regexp"> ^(.*)$</span> http://127.0.0.1:8080/cgi-bin/ <span class="literal">last</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>后续的事情，可以在本地创建一个cgi-bin文件夹，在里面放置需要映射的文本，并开启服务到8080端口即可。 </p>
<p>##场景五：移动侧调试</p>
<p><code>Fiddler</code> 有一个勾选项 <code>Allow remote computers to connect</code>，并可以指定 <code>listen port</code> 可以使得手机/其它终端通过将本机设为代理而访问本机环境，与 <code>hosts</code> 配合会很实用。</p>
<p>这个功能，用Nginx也很容易做到。<br>通过 <code>default_server</code> 作为代理，手机终端通过设置网络代理为本机IP和相应的 <code>listen port</code>，从而可以访问本机的 Web 服务。</p>
<p>其中也是用到了<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="external">ngx_http_proxy_module</a>模块的配置：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"> <span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>  <span class="number">80</span> default_server;</div><div class="line">    <span class="attribute">server_name</span>  localhost;</div><div class="line">    <span class="attribute">resolver</span> <span class="number">8.8.8.8</span>;</div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Real-Ip <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_pass</span> http://<span class="variable">$host</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="section">server</span> &#123;</div><div class="line">    <span class="attribute">listen</span>  <span class="number">80</span>;</div><div class="line">    <span class="attribute">server_name</span>  ke.qq.com;</div><div class="line">    <span class="attribute">location</span> / &#123;</div><div class="line">        <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Real-Ip <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$remote_addr</span>;</div><div class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:9091/;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="边角料"><a href="#边角料" class="headerlink" title="边角料"></a>边角料</h3><p>除去特定场景，Nginx的一些配置也跟前端息息相关。以下简单罗列，作为边角材料。</p>
<p>1.<a href="https://github.com/alibaba/nginx-http-concat" target="_blank" rel="external">nginx_http_concat</a><br>资源合并，处理CDN combo。例如通过这样的方式<code>http://example.com/??style1.css,style2.css,foo/style3.css</code>访问合并后的资源。</p>
<p>2.<a href="http://nginx.org/en/docs/http/ngx_http_image_filter_module.html" target="_blank" rel="external">ngx_http_image_filter_module</a><br>图片处理。提供图片缩放，jpg压缩，旋转等特性。</p>
<p>3.适配PC与移动web<br>总体可运用<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="external">ngx_http_proxy_module</a>，去实现路径转发。判断平台类型的Nginx配置，在开源项目<a href="http://detectmobilebrowsers.com/" target="_blank" rel="external">detectmobilebrowsers</a>中可以找到。</p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>学习Nginx，我本身只是出于开开眼界的目的。而的确发现了一些很有启发性的特质。<br>于前端开发，无论线上线下，熟练掌握基本配置，可以做出许多提高效率的工具。<br><strong>但既然是工具，熟手就好</strong>。 </p>
<p>比如Fiddler直观，但Nginx更底层，更灵活，应当按照实际选择即可。</p>
<p>话说回来，后来心情有些惆怅。<br>想起之前，我用NodeJs写过一个八百行的本地调试服务，如今更习惯用Nginx的几行配置。<br>不过我又想，<strong>既然我已经花了时间去写，为什么还要花时间去用？！</strong> </p>
<p>心情又好起来了。（等等有什么不对，管它呢…）</p>
<hr>
<p>END.<br>15.11.03 Sujuei</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Nginx那么好，我想去看看。&lt;br&gt;接连逛了两个书城后，我发现并没有Nginx相关的书籍。&lt;br&gt;这就很奇怪！&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/assets/blogImg/nginx0.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Nginx，一名&lt;strong&gt;网红&lt;/strong&gt;（网络服务器红人…），就算没有自传和回忆录，争着介绍它的花边新闻也该有吧。&lt;/p&gt;
&lt;p&gt;后来找到仅有的一两本书籍，也直接深入到“源码剖析”的阶段。写得并不十分满意，况且我还不需要这些。&lt;br&gt;后来发现了原因，大概是因为&lt;strong&gt;“使用太简单了，都不值得出书”&lt;/strong&gt;。&lt;br&gt;是的，Nginx把纷繁复杂的功能，浓缩成一份简单的配置，极易上手。&lt;br&gt;当它呈现到你面前时，感觉独具匠心。&lt;/p&gt;
    
    </summary>
    
    
      <category term="前端" scheme="//Sujuei.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>作为一个前端，可以如何机智地弄坏一台电脑？</title>
    <link href="//Sujuei.me/2015/07/06/hack-in-localstorage/"/>
    <id>//Sujuei.me/2015/07/06/hack-in-localstorage/</id>
    <published>2015-07-06T14:30:00.000Z</published>
    <updated>2016-11-21T05:22:38.931Z</updated>
    
    <content type="html"><![CDATA[<p>有人说，前端的界限就在浏览器那儿。</p>
<p>无论你触发了多少bug，最多导致浏览器崩溃，对系统影响不到哪去。<br>这就像二次元各种炫酷的毁灭世界，都不会导致三次元的世界末日。<br>然而，作为一个前端，我发现是有方式打开次元大门的…</p>
<p>这个实验脑洞较大，动机无聊，但某种意义上反映了一些<strong>安全问题</strong>。<br>想象一下，有天你在家里上网，吃着火锅还唱着歌，<strong>点开一个链接，电脑突然就蓝屏了</strong>！想想还真有点小激动。<br><a id="more"></a></p>
<p>###起因</p>
<p>故事得从localStorage说起。</p>
<p>html5的本地存储，相信大家都不陌生。将数据以二进制文件形式存储到本地，在当前应用得非常广泛。<br>windows下的chrome，localStorage存储于<code>C:\Users\xxx\AppData\Local\Google\Chrome\User Data\Default\Local Storage</code>文件夹中。但如果任由网页无限写文件，对用户硬盘的伤害可想而知，因而浏览器对其做了大小限制。</p>
<p>对于一个域名+端口，PC侧的上限是5M-10M之间，移动侧是则不大于2.5M。</p>
<p>那么问题就变成：<strong>这样的限制足够保护用户硬盘了吗</strong>？</p>
<p>###关键</p>
<p>关键的问题在于，这一限制，针对的是一个<code>域名+端口</code>。<br>也就是说，你访问<code>同一个域名的不同端口</code>，它们的localStorage并无关联，是分开存储的。</p>
<p>我用node简单地开启了服务器，这时，用户访问<code>http://127.0.0.1:1000</code>到<code>http://127.0.0.1:1099</code>这100个端口，会请求到同一个页面：<code>index.html</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="comment">//100个端口</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">var</span> port = <span class="number">1000</span>; port&lt; <span class="number">1100</span>; port++)&#123;</div><div class="line">  http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>) </span>&#123;</div><div class="line">    <span class="comment">//请忽略这种循环读文件的方式，只为了简便</span></div><div class="line">    fs.readFile(<span class="string">'./index.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, content</span>)</span>&#123;</div><div class="line">      <span class="keyword">if</span>(err) &#123;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        response.writeHead(<span class="number">200</span>, &#123; <span class="string">'Content-Type'</span> : <span class="string">'text/html; charset=UTF-8'</span> &#125;);</div><div class="line">        response.write(content);</div><div class="line">        response.end();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;).listen(port, <span class="string">'127.0.0.1'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当然，这个index.html里涉及了localStorage写操作。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var s = <span class="string">""</span>;</div><div class="line"><span class="comment">//慢慢来，别写太大了，好害怕…</span></div><div class="line">for(var i=<span class="number">0</span>; i&lt; <span class="number">3</span> * <span class="number">1024</span> * <span class="number">1024</span>; i++)&#123;</div><div class="line">  s += <span class="string">"0"</span>;</div><div class="line">&#125;</div><div class="line">localStorage.setItem(<span class="string">"testData"</span>, s);</div></pre></td></tr></table></figure>
<p>我试着用浏览器分别访问了几个端口，结果是分开存储。一切跟剧本一样。</p>
<p>###自动遍历</p>
<p>但这种程度还不够。<br>如果要实验变得更好（xie）玩（e）一些，问题就变成如何<code>让用户自动遍历这些端口</code>？</p>
<p>iframe是个好的尝试。<br>只要一打开<code>http://127.0.0.1: 1000</code>，页面的脚步就会创建一个iframe，去请求<code>http://127.0.0.1: 1001</code>，一直循环下去。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> Main = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">var</span> _key = <span class="string">"testData"</span>;</div><div class="line">  <span class="built_in">var</span> _max = <span class="number">1100</span>; <span class="comment">//最大限制</span></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attribute">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">//慢慢来，别写太大了，好害怕…</span></div><div class="line">      <span class="built_in">var</span> s = <span class="string">""</span>;</div><div class="line">      <span class="keyword">for</span>(<span class="built_in">var</span> i=<span class="number">0</span>; i&lt; <span class="number">3</span> * <span class="number">1024</span> * <span class="number">1024</span>; i++)&#123;</div><div class="line">        s += <span class="string">"0"</span>;</div><div class="line">      &#125;</div><div class="line">      localStorage.setItem(_key, s);</div><div class="line"></div><div class="line">      <span class="built_in">var</span> port = <span class="built_in">parseInt</span>(location.port)+<span class="number">1</span>;</div><div class="line">      <span class="keyword">if</span>(port &gt; _max) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">      <span class="comment">//新添加iframe</span></div><div class="line">      <span class="built_in">var</span> <span class="built_in">url</span> = <span class="string">"http://127.0.0.1:"</span> + port;</div><div class="line">      <span class="built_in">var</span> $iframe = <span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</div><div class="line">      $iframe.src = <span class="built_in">url</span>;</div><div class="line">      <span class="built_in">document</span>.getElementsByTagName(<span class="string">"body"</span>)[<span class="number">0</span>].appendChild($iframe);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>当然iframe我们还可以设置为不可见，以掩盖这种不厚道的行为…<br>比方说，有人发给你一个链接，你打开后发现是个视频，而你根本注意不到背后的脚本，在视频播放的几分钟里，快要把你的C盘写满。</p>
<p>然后我就看到请求如潮水渐涨：<br><img src="/assets/blogImg/localstorage1.png" alt=""></p>
<p>但是，请求到1081端口，最新的chrome就崩溃掉了…原来iframe嵌套太多，已经到达了浏览器的极限。</p>
<p>###防止浏览器崩溃</p>
<p>C盘还未撑满，同志还需努力。怎么办？</p>
<p>突然想到，到达iframe极限之前，我们可以重定向啊。<br>每访问50个端口，就使用<code>window.location.href</code>重定向一次，去确保浏览器不崩溃。</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> Main = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">var</span> _key = <span class="string">"testData"</span>;</div><div class="line">  <span class="built_in">var</span> _max = <span class="number">1200</span>; <span class="comment">//最大限制</span></div><div class="line">  <span class="built_in">var</span> _jumpSpace = <span class="number">50</span>; <span class="comment">//为避免iframe过多导致浏览器crash，每50个执行跳转</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attribute">init</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="comment">//慢慢来，别写太大了，好害怕…</span></div><div class="line">      <span class="built_in">var</span> s = <span class="string">""</span>;</div><div class="line">      <span class="keyword">for</span>(<span class="built_in">var</span> i=<span class="number">0</span>; i&lt; <span class="number">3</span> * <span class="number">1024</span> * <span class="number">1024</span>; i++)&#123;</div><div class="line">        s += <span class="string">"0"</span>;</div><div class="line">      &#125;</div><div class="line">      localStorage.setItem(_key, s);</div><div class="line"></div><div class="line">      <span class="built_in">var</span> port = <span class="built_in">parseInt</span>(location.port)+<span class="number">1</span>;</div><div class="line">      <span class="keyword">if</span>(port &gt; _max) <span class="keyword">return</span>;</div><div class="line"></div><div class="line">      <span class="keyword">if</span>(port % _jumpSpace == <span class="number">0</span>)&#123;</div><div class="line">        <span class="comment">//每50个，重定向一次</span></div><div class="line">        <span class="built_in">window</span>.location.href = <span class="built_in">url</span>;</div><div class="line">      &#125;<span class="title">else</span>&#123;</div><div class="line">        <span class="comment">//新添加iframe</span></div><div class="line">        <span class="built_in">var</span> $iframe = <span class="built_in">document</span>.createElement(<span class="string">"iframe"</span>);</div><div class="line">        $iframe.src = <span class="built_in">url</span>;</div><div class="line">        <span class="built_in">document</span>.getElementsByTagName(<span class="string">"body"</span>)[<span class="number">0</span>].appendChild($iframe);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure>
<p>事实证明，这种蛮拼的方法的确可行。</p>
<p>至此，只要访问<code>http://127.0.0.1: 1000</code>，就会往Local Storage文件夹里写入近500M无用数据：<br><img src="/assets/blogImg/localstorage3.png" alt=""></p>
<p>里面的数据是这样的：<br><img src="/assets/blogImg/localstorage2.png" alt=""></p>
<p>###继续实验的黑科技</p>
<p>算了下我的C盘还有空间嘛，那就把端口数量从100增长到200个。<br>结果是这样的，到达了1.17G大小。<br><img src="/assets/blogImg/localstorage4.png" alt=""></p>
<p>在后续的实验中，我就慢慢的把端口数量与存储的数据调大。</p>
<p>电脑也运行得越来越慢。这是为什么呢？</p>
<p>我观察到，有时候执行<code>localStorage.setItem()</code>后，在文件夹里不一定立即能看到数据文件。<br>怀疑这些数据会被chrome先放到内存里，以避免重复读写带来的消耗，在空闲或关闭的时机，再写进硬盘里。</p>
<p>但此时，浏览器已经影响到系统了。它处于一种“不会崩溃”，但“因为占用了许多内存，已经妨碍用户电脑的正常使用”的状态。<br>即使用户关闭了浏览器窗口，也不会很快恢复。要知道读写任务并不是随窗口关闭而终止的，否则浏览器会丢失数据。</p>
<p>遭遇黑科技的人们能做的只有：</p>
<ol>
<li>等待；</li>
<li>用任务管理器关掉chrome进程，再等待；</li>
<li>相信并尝试“重启电脑解决90%电脑问题”的科学论断</li>
</ol>
<p>可以说，浏览器的内心几乎是崩溃的。</p>
<p>###最后</p>
<p>最后，还是得用严肃脸告诫一下：害人之心不可无。<br>本实验，从一开始就是怀揣着将<code>安全问题上交给国家的初衷</code>去做的（是的就是这么纯粹）。</p>
<p>后续，看着C盘还有2G空间，我又把端口增长到2000个，试下会发生什么。<br>由于请求过多，需要一定时间，我就去做别的事情了。<br>回来后发现房间安静祥和，美轮美奂，一片蓝光，像是加了特技。</p>
<p><img src="/assets/blogImg/localstorage5.png" alt=""></p>
<p>那么问题来了，计算机修理哪家强？<br>有点急…</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;有人说，前端的界限就在浏览器那儿。&lt;/p&gt;
&lt;p&gt;无论你触发了多少bug，最多导致浏览器崩溃，对系统影响不到哪去。&lt;br&gt;这就像二次元各种炫酷的毁灭世界，都不会导致三次元的世界末日。&lt;br&gt;然而，作为一个前端，我发现是有方式打开次元大门的…&lt;/p&gt;
&lt;p&gt;这个实验脑洞较大，动机无聊，但某种意义上反映了一些&lt;strong&gt;安全问题&lt;/strong&gt;。&lt;br&gt;想象一下，有天你在家里上网，吃着火锅还唱着歌，&lt;strong&gt;点开一个链接，电脑突然就蓝屏了&lt;/strong&gt;！想想还真有点小激动。&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//Sujuei.me/tags/js/"/>
    
      <category term="安全" scheme="//Sujuei.me/tags/%E5%AE%89%E5%85%A8/"/>
    
      <category term="黑科技" scheme="//Sujuei.me/tags/%E9%BB%91%E7%A7%91%E6%8A%80/"/>
    
  </entry>
  
  <entry>
    <title>说到加载图片，我们可以谈些什么</title>
    <link href="//Sujuei.me/2015/04/28/img-lazy-load/"/>
    <id>//Sujuei.me/2015/04/28/img-lazy-load/</id>
    <published>2015-04-28T15:54:00.000Z</published>
    <updated>2016-11-21T05:22:38.933Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/lazyload.jpg" alt="原图 by Denis Perepelenko">    </p>
<p>其实，一开始让我在网页中加载一张图片，我是，是拒绝的…因为实在太简单了。</p>
<p><code>&lt;img src=&quot;xx.jpg&quot; /&gt;</code>是每个前端开发都会的技能。然而，如果你想做到极致，事情还没有这么简单。</p>
<p>最近实现了个图片加载器，用于大型web前端项目中，关于加载图片这一话题，仔细想来可以加许多的特技。</p>
<a id="more"></a>
<p>###第一步：滚屏加载</p>
<p>这是最容易想到的点，也是一开始就准备做的。</p>
<p>随web体验的进步，滚屏加载代替分页加载的情形越来越多。也就是先预留图片位置，而不去加载图片，直到这个预留区域滚动到屏幕中，用户能看见了，才去加载图片。如此一来，有“按需加载”的意味，由于图片加载延后，不抢占带宽，在打开页面的首屏会快很多。我们称之为“懒加载(lazyload)”。</p>
<p>其实现也很简单，在html里面写<code>&lt;img lazy-src=&quot;xx.jpg&quot; /&gt;</code>，然后用js去判断这个节点是否出现在屏幕中，如果是，则取出<code>lazy-src</code>属性，赋值成<code>&lt;img lazy-src=&quot;xx.jpg&quot; src=&quot;xx.jpg&quot;/&gt;</code>，触发此节点onload，这就实现最简单的滚屏加载了。</p>
<p>###第二步：特殊状态处理</p>
<p>特殊状态有两种：加载中与加载失败。这两种情况的处理逻辑相类似，拿加载中的逻辑做例子。</p>
<p>图片触发加载，到图片加载完成（或失败）之间，肯定会有一段时间。不做处理的话，用户在等待的过程中，就只能看到空白的区域，非常的奇怪。在低网速，以及用户非常快的拉滚动条的情形下，这种现象将更加明显。</p>
<p>那么在触发onload之前，就需要补一些逻辑，展示对应的loading图。<br>将需要处理的img节点作为参数，调用tempImg函数，克隆一个节点强行插在img之前，用于loading中的展示。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> tempImg = <span class="function"><span class="keyword">function</span><span class="params">(target)</span></span>&#123;</div><div class="line">    <span class="keyword">var</span> w = target.width();</div><div class="line">    <span class="keyword">var</span> h = target.height();</div><div class="line">    <span class="keyword">var</span> tempDom = target.<span class="keyword">clone</span>().addClass(<span class="string">"lazy-loding"</span>).insertBefore(target);</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(w/h == <span class="number">1</span>)&#123;</div><div class="line">        tempDom[<span class="number">0</span>].src = <span class="string">"http://9.url.cn/edu/img/img-loading.png"</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        tempDom[<span class="number">0</span>].src = <span class="string">"http://9.url.cn/edu/img/img-loading2.png"</span>;</div><div class="line">    &#125;</div><div class="line">    target.hide();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###第三步：上报监控</p>
<p>这一步在大型前端项目中非常重要，也是经常被忽略的地方。尽管需要简易的后台配合，但不算麻烦的上报监控，能让产品更加稳定和健壮。</p>
<p>我在两个地方用到了上报。其一是图片加载失败，触发<code>onerror</code>时，这样一来我们能知道每天图片拉取失败的量；其二是图片加载的时间，能够帮助我们分析cdn服务是否异常，分析全国慢速用户比例等等。</p>
<p>而所谓的上报其实就是一个http请求，我会大概把这些信息带上</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">   <span class="keyword">log</span>(&#123;</div><div class="line">	<span class="string">'type'</span>: <span class="string">'error'</span>,</div><div class="line">	<span class="string">'msg'</span>: <span class="string">'lazyload拉取图片失败上报 '</span>,</div><div class="line">	<span class="string">'url'</span>: <span class="keyword">window</span>.location.href,</div><div class="line">	<span class="string">'pid'</span>: <span class="number">414342</span>  <span class="comment">//产品对应的id</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>###第四步：居中截取</p>
<p>这是前端无可避免的一个问题，先来说下此问题的背景。</p>
<p>由于我们是先用一个空白的img标签占位，再去加载图片，如果图片的高度特别长（比如新浪长微博），加载完成时就会撑开节点，引起滚动条的跳动。由于移动端屏幕较PC窄，一个跳动就可能让你找不到前一秒正在浏览的内容，这种体验尤其严重。在移动端的web设计中，可以看到许多知名互联网公司的产品，也经常忽略这一点。</p>
<p>因此我们可以限定占位区域的size，以此区域来做居中截取。当占位区域与图片最终展示同宽同高时，就不会引起跳动，而且也保持了视觉的一致性。</p>
<p>其原理如下，先判断是竖向长型图，还是横向长型图，根据不同的情况，优先让宽或高填充满占位区域，然后通过不同的负margin去实现居中。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">var</span> calSize = function($img) &#123;</div><div class="line">    <span class="built_in">var</span> w = $img.<span class="built_in">width</span>(), h = $img.<span class="built_in">height</span>(), <span class="built_in">width</span> = size[<span class="number">0</span>], <span class="built_in">height</span> = size[<span class="number">1</span>];</div><div class="line">    <span class="keyword">if</span>(w+h == <span class="number">0</span>) <span class="built_in">return</span>;</div><div class="line"></div><div class="line">    //如果是长型图，优先适配宽度，高度居中截取</div><div class="line">    <span class="keyword">if</span>(w/h &gt; <span class="built_in">width</span>/<span class="built_in">height</span>)&#123;</div><div class="line">        <span class="built_in">var</span> newWidth = <span class="built_in">height</span> * w / h;</div><div class="line">        <span class="built_in">var</span> margin = (<span class="built_in">width</span> - newWidth)/<span class="number">2</span>;</div><div class="line">        $img.<span class="built_in">height</span>(<span class="built_in">height</span>).css(&#123;<span class="string">"margin-left"</span>: margin&#125;);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">var</span> newHeight = <span class="built_in">width</span> * h / w;</div><div class="line">        <span class="built_in">var</span> margin = (<span class="built_in">height</span> - newHeight)/<span class="number">2</span>;</div><div class="line">        $img.<span class="built_in">width</span>(<span class="built_in">width</span>).css(&#123;<span class="string">"margin-top"</span>: margin&#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###第五步：支持webp</p>
<p>webp格式图片是google开发的一种旨在加快图片加载速度的图片格式，压缩提交大概只有jpg的2/3。随chrome的比例越来越多，其实让更多用户体验到webp也是一件好事。</p>
<p>那么问题来了，怎么去判断用户的浏览器是否支持webp呢？<br>根据ua去判断是个好方法，但不太靠谱，因为chrome中其实也有设置，让它不能去支持webp，而且webkit本身就开源，会衍生出很多你不知道名字的浏览器。</p>
<p>最终我使用的是特性检测：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(!supportedWebPIsLoading) &#123;</div><div class="line">    supportedWebPIsLoading = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">var</span> images = &#123;</div><div class="line">        basic: <span class="string">"data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAACyAgCdASoCAAEALmk0mk0iIiIiIgBoSygABc6zbAAA/v56QAAAAA=="</span></div><div class="line">    &#125;, $img = <span class="keyword">new</span> Image();</div><div class="line">    $img.onload = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">        supportedWebPIsLoading = <span class="keyword">false</span>;</div><div class="line">        $.cookie.set(<span class="string">"iswebp"</span> , +supportedWebP);</div><div class="line">    &#125;;</div><div class="line">    $img.onerror = <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</div><div class="line">        supportedWebP = <span class="keyword">false</span>;</div><div class="line">        supportedWebPIsLoading = <span class="keyword">false</span>;</div><div class="line">        $.cookie.set(<span class="string">"iswebp"</span> , +supportedWebP);</div><div class="line">    &#125;;</div><div class="line">    $img.src = images.basic;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们会让浏览器试着加载一张非常小的base64格式的webp图片，如果能够正常加载，说明是支持webp的。</p>
<p>并且，会把测试记录在cookie里，所以第二次直接从cookie里读结果，基本不会影响性能。完成了最重要的检查，我们就可以放心让服务器返回不同格式的图片了。</p>
<p>End.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/lazyload.jpg&quot; alt=&quot;原图 by Denis Perepelenko&quot;&gt;    &lt;/p&gt;
&lt;p&gt;其实，一开始让我在网页中加载一张图片，我是，是拒绝的…因为实在太简单了。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;img src=&amp;quot;xx.jpg&amp;quot; /&amp;gt;&lt;/code&gt;是每个前端开发都会的技能。然而，如果你想做到极致，事情还没有这么简单。&lt;/p&gt;
&lt;p&gt;最近实现了个图片加载器，用于大型web前端项目中，关于加载图片这一话题，仔细想来可以加许多的特技。&lt;/p&gt;
    
    </summary>
    
    
      <category term="js" scheme="//Sujuei.me/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>hexo主题Yilia在移动端适配的一些事</title>
    <link href="//Sujuei.me/2015/02/23/yilia-on-mobile/"/>
    <id>//Sujuei.me/2015/02/23/yilia-on-mobile/</id>
    <published>2015-02-23T04:58:00.000Z</published>
    <updated>2016-11-21T07:56:07.562Z</updated>
    
    <content type="html"><![CDATA[<p>[Yilia]是我去年9月开发的主题，本来只是想给自己玩，因而开始有许多“任性”的设计。诸如“我本可以兼容ie，但我就不”这种…<br>结果star数越来越多，半年里，居然成为了搜索“hexo-theme”最多star数的主题。<br>感慨大家跟我一样任性的同时，也是受宠若惊，万分感谢！</p>
<p>而年前的主要矛盾，是日益增多的star和fork数，与功能还未完善之间的矛盾；以及越来越多的bug被大家发现，与我忙得飞起只好假装没发现这些bug的矛盾…</p>
<p>默默放下抢红包的手机，还是决定先把关于hexo最想解决的三件事之一：移动端适配给做了。</p>
<a id="more"></a>
<p>##三件事</p>
<p>话说这三件事一直有放在心上，是使用hexo时还不够满意的地方。<br><br>             </p>
<ol>
<li><strong>移动端适配。</strong>就很多主题来看，响应式布局就等同于移动端适配，这是远远不足够的。布局影响的仅仅是视觉，还必须有特有的交互逻辑，以适应大家的操作习惯。</li>
<li><strong>seo。</strong>hexo的seo还比较弱，description需要支持文章自定义比较稳妥，而把标签云塞到keyword里面去是个好想法。</li>
<li><strong>模块化加载。</strong>把fancybox，jiathis，duoshuo这些给延迟加载，移动端和pc端js分离。就瀑布图来看，是有信心提速20%-30%的。<br><br></li>
</ol>
<p>##移动端适配</p>
<p>关于适配着重在这些方面：</p>
<ul>
<li>滚动时视觉感官上的流畅性</li>
<li>便于单手操作</li>
<li>次要信息在左侧边栏的收纳管理</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;[Yilia]是我去年9月开发的主题，本来只是想给自己玩，因而开始有许多“任性”的设计。诸如“我本可以兼容ie，但我就不”这种…&lt;br&gt;结果star数越来越多，半年里，居然成为了搜索“hexo-theme”最多star数的主题。&lt;br&gt;感慨大家跟我一样任性的同时，也是受宠若惊，万分感谢！&lt;/p&gt;
&lt;p&gt;而年前的主要矛盾，是日益增多的star和fork数，与功能还未完善之间的矛盾；以及越来越多的bug被大家发现，与我忙得飞起只好假装没发现这些bug的矛盾…&lt;/p&gt;
&lt;p&gt;默默放下抢红包的手机，还是决定先把关于hexo最想解决的三件事之一：移动端适配给做了。&lt;/p&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="//Sujuei.me/tags/hexo/"/>
    
      <category term="主题" scheme="//Sujuei.me/tags/%E4%B8%BB%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>展示豆瓣未登录首页的chrome插件</title>
    <link href="//Sujuei.me/2014/10/16/douban-index-for-chrome/"/>
    <id>//Sujuei.me/2014/10/16/douban-index-for-chrome/</id>
    <published>2014-10-16T00:15:00.000Z</published>
    <updated>2016-11-21T05:22:38.926Z</updated>
    
    <content type="html"><![CDATA[<p>某天，我惊讶的发现，豆瓣未登陆时的首页，比登录后的首页还要好玩！<br>其实，并不是只有我一个人这么觉得，我甚至见过有人专门打开隐身窗口刷此页面，真是机智的少年。        </p>
<p>不是很理解之余，这个chrome插件<a href="https://chrome.google.com/webstore/detail/%E8%B1%86%E7%93%A3%E9%A6%96%E9%A1%B5/pkciaaffjliomglnmjcjekkinbnnjcah?hl=zh-CN" target="_blank" rel="external">豆瓣首页 for chome</a>就诞生了。</p>
<p>但这个问题很有意思。<br><a id="more"></a></p>
<p>进入豆瓣相关页面，在导航条处会有“默认首页”tab，如截图虚线框处所示。点击即可进入。</p>
<p><img src="https://lh3.googleusercontent.com/Fo9kVNBCTqFVjBZUg901r0r50cB5zlVPN9DN5dbBBo_tpXFWTUUny-715sBnlwLVzdzZCm8s=s640-h400-e365-rw" alt="豆瓣首页 for chome"></p>
<p>这个问题有意思的地方在于，在国内很少有人做类似“减法”的东西。未登录时展示聚合的热门内容；登录后展示与个人相关的推荐内容，两者竟只取其一。大家例行吐槽，吐槽后接着用。</p>
<p>我找到了官方的一些解释：<a href="http://blog.douban.com/douban/2013/09/06/2662/" target="_blank" rel="external">《由头和环境：新豆瓣首页看待世界的方式》</a></p>
<blockquote>
<p>懂你的，会随你而变。… 希望豆瓣在你眼中不是一成不变的寂静的水泥地面，而是和你共呼吸、同作息的有氧森林。</p>
</blockquote>
<p>这句话说得很棒，各种产品的未来愿景都应如是。看到这会知道为什么以前的“豆瓣猜”会变成“订阅”，即使两者没太大本质的区别，但前者是被动的感觉，后者则是表达主动的需要。</p>
<p>那么推荐算法在这个产品形态中，则扮演了一个非常重要的角色。但目前，我个人感觉豆瓣的推荐并不能十分使人满意。</p>
<p>因而有了这个chrome插件。<br>我做这个插件，最由衷的愿望，就是某天能把这插件给消灭掉。</p>
<p>附：<a href="https://github.com/litten/douban-index" target="_blank" rel="external">github地址</a></p>
<p>litten 2014.10.16</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;某天，我惊讶的发现，豆瓣未登陆时的首页，比登录后的首页还要好玩！&lt;br&gt;其实，并不是只有我一个人这么觉得，我甚至见过有人专门打开隐身窗口刷此页面，真是机智的少年。        &lt;/p&gt;
&lt;p&gt;不是很理解之余，这个chrome插件&lt;a href=&quot;https://chrome.google.com/webstore/detail/%E8%B1%86%E7%93%A3%E9%A6%96%E9%A1%B5/pkciaaffjliomglnmjcjekkinbnnjcah?hl=zh-CN&quot;&gt;豆瓣首页 for chome&lt;/a&gt;就诞生了。&lt;/p&gt;
&lt;p&gt;但这个问题很有意思。&lt;br&gt;
    
    </summary>
    
    
      <category term="工具" scheme="//Sujuei.me/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="chrome" scheme="//Sujuei.me/tags/chrome/"/>
    
  </entry>
  
  <entry>
    <title>浏览器野史 UserAgent列传（下）</title>
    <link href="//Sujuei.me/2014/10/05/history-of-browser-useragent2/"/>
    <id>//Sujuei.me/2014/10/05/history-of-browser-useragent2/</id>
    <published>2014-10-05T09:26:00.000Z</published>
    <updated>2016-11-21T07:39:05.508Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/browser-history2.jpg" alt="其实应该叫做浏览器约架史">    </p>
<p>前篇<a href="/2014/09/26/history-of-browser-useragent/">《浏览器野史 UserAgent列传（上）》</a></p>
<p>###六、师夷长技</p>
<p>前面说到，微软靠Windows系统捆绑IE销售。而Windows自然也有它的对手，Linux。一个技术快速发展的时代，系统的世界里也是战火纷飞。Linux系统自从有了可视化界面，也需要浏览器呀。桌面系统KDE的缔造者们就发明了一个。</p>
<a id="more"></a>
<p>真是具有跨时代意义的工具呀，好伟大呀，人们在想，它叫什么呢？<br>但大神就是大神，大神就是讲究先从文字上占据压垮你的气势。<br>先有Navigator航海家，再有Explorer探索者，咱就叫Konqueror(Conqueror的变体)征服者吧。<br>行行行。我已懒得理这帮大神…</p>
<p>可是，问题来了。Konqueror使用KHTML排版引擎，即使它们认为自己跟Gecko引擎一样优秀，但用户不买单。你UserAgent里没有“Gecko”字样，我就不给你经过优良排版的html。<br>结果，Konqueror思来想去，做了一个艰难但很萌的决定，把UserAgent写成<code>Mozilla/5.0 (compatible; Konqueror/3.2; FreeBSD) (KHTML, like Gecko)</code>…<br>这就是现代浏览器里<code>like Gecko</code>这一萌词的由来。</p>
<p>就这样，伟大的排版引擎KHTML为了获得更好的资源，师夷长技。这并没什么不好，却造成了UserAgent的越发混乱。<br>KHTML与Gecko这一对，永远卿卿我我比翼双飞在UserAgent里面了。那个满含深意的“like”，有人觉得翻译成“像”，但也有人觉得应该是“喜欢”…</p>
<p>###七、世界大战</p>
<p>首先是IE冷静下来了，他觉得，你们不带这么玩的？<br>就我年少时不懂事，首先改了个Mozilla字样，后面追究这历史我岂不是成了罪魁祸首？我改还不行吗？<br>在IE6，它明确自己UserAgent为<code>Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0)</code>。除去已经注定不可抹去的“Mozilla”字样，其余信息简洁，准确，清晰。</p>
<p>但事态已经不可收拾。</p>
<p>Opera给这狂躁的世界添了一把火。它觉得，易容术非常炫酷呀。Opera直接在菜单提供了<code>Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; en) Opera 9.51</code>，<code>Mozilla/5.0 (Windows NT 6.0; U; en; rv:1.8.1) Gecko/20061208 Firefox/2.0.0 Opera 9.51</code>，<code>Opera/9.51 (Windows NT 5.1; U; en)</code>三个选择项。第一个是易容成IE，第二个是易容成火狐，第三个才是自己，选谁就是谁！</p>
<p>其实这并不是一件坏事。因为Opera是站在能够让用户通过选择，去获得更好的浏览体验的基础上的。你提供选择，或是不提供，混乱的UserAgent还是在这，不离，不弃。再者，这对网页的开发者有极大的好处，在某些情况，你不必同时打开几个不同的浏览器去调试。到目前，最新的Chrome浏览器更加炫酷，能够支持近40种不同的UserAgent，甚至你还可以自定义。当然这是后话。</p>
<p>与此同时，苹果公司依靠内核WebKit，开发出Safari，命名UserAgent为<code>Mozilla/5.0 (Macintosh; U; PPC Mac OS X; de-de) AppleWebKit/85.7 (KHTML, like Gecko) Safari/85.5</code>。</p>
<p>有人就会问了，不是Webkit内核吗，怎么还有<code>KHTML, like Gecko</code>？注意，内核Webkit包含了一个排版引擎叫WebCore，而WebCore是KHTML衍生而来的。也就是说，WebCore是KHTML的儿子，子承父业，基因差不多。为了能够正常排版，safari只能这么写。</p>
<p>后来，google也开发了自己的浏览器Chrome，其内核也是Webkit，但它设定UserAgent为<code>Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/0.2.149.27 Safari/525.13</code>。Safari一看，不对劲啊！你怎么也在后面写有Safari？Chrome呵呵一笑，你懂的。</p>
<p>因此，请让我一口气说完下面这一段：<br>Chrome希望能得到为Safari编写的网页，于是决定装成Safari，Safari使用了WebKit渲染引擎，而WebKit呢又伪装自己是KHTML，KHTML呢又是伪装成Gecko的。同时所有的浏览器又都宣称自己是Mozilla。</p>
<p>这就是整个UserAgent世界大战的格局…</p>
<p>###八、军阀混战</p>
<p>将目光聚焦到国内，更是狼烟四起，混乱不堪。大家都知道，浏览器是互联网的入口，这块肥肉谁也不想丢。因而一个接一个的“国产”浏览器进入斗兽场。<br>360，百度，QQ，UC，搜狗，猎豹，遨游，世界之窗…你能说出一大堆。连淘宝，酷狗，hao123都有浏览器，不信你搜。<br>注意我前面“国产”两个字必须加上双引号，因为这个made in china并不纯。国人并没能像远古大神一样，硬生生发明一个内核出来，我们更擅长“微创新”。</p>
<p>利用Trident（IE的内核），包装一下皮肤，美化一下，就可以说：完美兼容<br>利用Webkit，包装一下皮肤，美化一下，就可以说：极速浏览<br>把两个内核都包起来，就可以说：智能双核</p>
<p>是微创新！读书人的事，能叫偷吗？</p>
<p>在这插播一下，浏览器的“双核”，并不是你听说手机双核电脑双核那回事。再多个核，速度也不会更快，当然这么说，会显得很厉害的样子。德艺双馨，智勇双全，名利双收，才貌双绝，夫妻双双把家还，你看带“双”字的词都很牛的。</p>
<p>但我上面的叙述，的确有夸张的成分。浏览器的诞生，肯定不仅仅是包一下皮肤那么简单，国内的工程师们，也苦心研究做了许多工作。如果要说优化策略，我可以再写一篇超级长的文章。优化无止境，路漫漫其修远，向同行们致敬。只是我非常讨厌那些不把事实说清楚，纯粹靠文案去忽悠人的产品…</p>
<p>话说回来，这么多国产浏览器，总得靠不同UserAgent标志自己呀。<br>大家自动分为两个阵营：使用Trident内核的，在IE已有UserAgent后添加自己的名称；使用Webkit内核的，就在Chrome的UserAgent后面添加。</p>
<p>前者像QQ浏览器：<code>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser/7.7.26717.400)</code>。<br>后者像猎豹：<code>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.137 Safari/537.36 LBBROWSER</code>。<br>当然双核浏览器诚然就是墙头草，切换内核时UserAgent也需要跟着变化。</p>
<p>如此的混战格局，这厢的IE和Chome想必也是醉了。</p>
<p>###九、国共内战</p>
<p>适者生存是不变的生存法则，国产浏览器们经过一段时间的用户筛选，自然优胜劣汰。时值2010年，真正还在运营和更新的浏览器数量慢慢下降，用户集中在几家表现更优异的厂商手中。就在这时，好看的故事来了——3Q大战爆发。</p>
<p>有人说，腾讯电脑管家的推出是导火索。其实这场仗，大家都忍了好久，推不推出，都一定会在某个事件后爆发。360浏览器是奇虎的重量级产品，用户量众多，2009年它推出一个功能：过滤其它网站的广告。诚然民众们都很喜欢。可是其他互联网公司肯定就不乐意了，用户看不到更点击不到广告，这钱还怎么赚？</p>
<p>因而在3Q大战爆发后，腾讯的一个手段就是：如果你使用360浏览器，就不能访问QQ的网站（单单QQ空间就有巨大的用户量），也直接反攻360的最大收入来源。一个艰难的决定背后，往往是需要无数种的技术战略支撑的。企鹅判断用户是否使用360浏览器，依靠的就是UserAgent里是否有“360SE”的字样。</p>
<p>战报传来：号外，360浏览器上不了QQ空间！已经买了黄钻的杀马特贵族急了呀！只能换浏览器了呀！感覺侢乜卟哙噯嘞呀！<br>2011年11月3日，腾讯网站封杀360浏览器<br>2011年11月4日，360浏览器访问量仅为昨日一半<br>2011年11月5日，360浏览器访问量几乎为0</p>
<p>有人说，腾讯就这么快赢了？恰恰相反，360浏览器通过一次强制的自动升级，又可以访问QQ的网站了。360的工程师们在5日使用了伪装术——把“360SE”字样从UserAgent中去掉！<br>意思就是，360浏览器的UserAgent跟IE完全一样，你根本判断不出来（因而访问量为0）。就怕流氓有文化！企鹅傻眼了，总不能把大微软的IE也一并给禁了吧…</p>
<p>这场土匪遇恶霸的耍流氓大战，最终通过法律而化解。企鹅在技术侧拿360没办法，而360则得到了一个跟IE一样的身份证。在这场内战中，受伤的除了广大网民们，其实还有令人心疼UserAgent君，以往让它越长越长就算了，这次长了还得阉割掉，真心dan疼呀。</p>
<p>###十、明日边缘</p>
<p>看到这里，大家会明白一个道理：如果未来不出现一款霸主级别的浏览器（或内核），UserAgent应该不会有大变化了。<br>不过，这道理并不全对。别忘了，移动侧也是有浏览器的。<br>在早期能上网的手机里，内置了各手机厂商自研的浏览器。这些浏览器并不需要像PC一样的复杂设计，可以访问wap网页就足够了。因而它们的UserAgent命名，怎么简单怎么来，就直接叫<code>诺基亚 3100 Nokia3100/06.01 (UCWEB 3.3B)</code>，<code>PHILIPS755 ObigoInternetBrowser/2.0</code> 这样，有甚者连浏览器叫什么都不带 <code>TCL-3199</code>，<code>三星 E618 SEC-SGHE618</code>。</p>
<p>这样任由发展下去，一种要历史重演，往日重现的即视感压迫而来。<br>web世界的联合国——W3C组织，站在明日边缘，面对着历史和未来，终于发话，它制定UserAgent标准，以后都得按这规范去起名字。详细请阅<a href="http://www.w3.org/TR/UAAG/" target="_blank" rel="external">User Agent Accessibility Guidelines</a>。至此，命运坎坷的UserAgent终于逐步走向规范。W3C大法好，有人说你怎么不早点来拯救世界呀！其实W3C一直在努力，但规范的制定，到推广至大家认可并执行，是一条漫长的道路，需要时间，也需要实践。<br>W3C组织，在制定web标准这件工作之外，再我看来，还有两个身份：1、和事佬；2、背黑锅。和事不成，就得背黑锅。是的就是这样。</p>
<p>###彩蛋</p>
<p>那么，我们的故事接近尾声。还有一些有趣的小彩蛋。</p>
<ol>
<li>Chome 28开始，与苹果正式分道扬镳，采用Blink内核，但它的UserAgent并不改变。              </li>
<li>淘宝封杀微信打开淘宝页面，靠的就是微信内置浏览器UserAgent里的MicroMessenger字样。其实微信也可以像当初360一样把UserAgent去掉，但微信并不这样做。                </li>
<li>360出招之时留有后招。也许，它一开始就想到了腾讯会告他们对于UserAgent的欺瞒，因而它其实提供了设置项。默认设置是“保持跟IE一样的UserAgent”，但用户也可以不勾选。只是这选项比较隐蔽，而且你重启浏览器后…又会变回默认设置。如果没有这个小小的设置，结果大家可以自行想象。                </li>
<li>微软又玩新花样了，在泄露版IE 11中，去掉了以往的MSIE字样。初步猜测此举是为了使现有的 CSS hack 失效，避免过去网页设计师对IE差别对待的情况再度发生。但又会引发其他问题啊亲。</li>
</ol>
<hr>
<p>End.<br>Sujuei 2014.10.5</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/browser-history2.jpg&quot; alt=&quot;其实应该叫做浏览器约架史&quot;&gt;    &lt;/p&gt;
&lt;p&gt;前篇&lt;a href=&quot;/2014/09/26/history-of-browser-useragent/&quot;&gt;《浏览器野史 UserAgent列传（上）》&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;###六、师夷长技&lt;/p&gt;
&lt;p&gt;前面说到，微软靠Windows系统捆绑IE销售。而Windows自然也有它的对手，Linux。一个技术快速发展的时代，系统的世界里也是战火纷飞。Linux系统自从有了可视化界面，也需要浏览器呀。桌面系统KDE的缔造者们就发明了一个。&lt;/p&gt;
    
    </summary>
    
    
      <category term="web" scheme="//Sujuei.me/tags/web/"/>
    
      <category term="浏览器" scheme="//Sujuei.me/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>浏览器野史 UserAgent列传（上）</title>
    <link href="//Sujuei.me/2014/09/26/history-of-browser-useragent/"/>
    <id>//Sujuei.me/2014/09/26/history-of-browser-useragent/</id>
    <published>2014-09-26T03:26:00.000Z</published>
    <updated>2016-11-21T07:39:27.526Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/browser-history.jpg" alt="其实应该叫做浏览器约架史">   </p>
<p>某天，我做一个小项目，需要判断一下浏览器类型。简单的呀。<br>控制台敲下：<code>navigator.userAgent</code><br>浏览器回应：<code>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36</code></p>
<p>天，这串是啥？你怎么连话都说不清楚？</p>
<p>我对userAgent并不陌生，但明明一个单词就可以说清楚的事情，却是这么掏心掏肺的回答。怪可怜的，一定有冤情。</p>
<p>后来我查阅了很多资料，发现历史非常的精彩。</p>
<a id="more"></a>
<p>###大事年表</p>
<ul>
<li>1990年: Nexus(WorldWideWeb)诞生</li>
<li>1993年1月23日：Mosaic诞生</li>
<li>1994年12月：Netscape(Mozilla)诞生</li>
<li>1995年4月：Opera诞生</li>
<li>1995年8月16日：Internet Explorer诞生</li>
<li>2002年9月23日：Firefox诞生</li>
<li>2003年1月7日：Safari诞生</li>
<li>2008年9月2日：Chrome诞生</li>
</ul>
<p>###一、盘古开天地<br>很久很久之前，上古大神Berners-Lee发明了WorldWideWeb，即万维网。同时，李大神也发明了第一款浏览器。真是具有跨时代意义的工具呀，好伟大呀，人们在想，叫什么好呢？<br>但大神就是大神，大神内心的想法又岂是尔等凡人能够肆意揣摩？</p>
<p>万万没想到，李大神说，我这浏览器，也叫WorldWideWeb！不行么？<br>行行行。</p>
<p>虽然李大神起名字这么拽，但他后来发觉，还是得赋予一点承上启下的历史意义，就改名成“Nexus”。值得注意的是，这浏览器，居然是可以兼容Unix跟Microsoft DOS的。它在当时流行的各种电脑上跑得飞起，应用也越来越广，被称为“杀手级应用”。杀手级…你们看互联网一开始就是这么的腥风血雨。</p>
<p>但这个浏览器，还不支持图片的显示，这是出现UserAgent的导火索。</p>
<p>###二、唐尧虞舜<br>93年，伊利诺大学的NCSA组织认为，浏览器无图无真相，这不好。因而他们发明了第一款可显示图片的浏览器。<br>真是具有跨时代意义的工具呀，好伟大呀，人们在想，叫什么好呢？<br>但大神就是大神，大神就是连起名字都让你惊心动魄。</p>
<p>NCSA组织说，它能显示图片，偏偏我们就要叫它“马赛克(Mosaic)”！不行么？<br>行行行。  </p>
<p>但有人就问了，Nexus不显示图片，Mosaic能显示，你们让html提供者怎么写代码？你们是不是想逼死选择困难症患者？有没有考虑过天秤座的感受？</p>
<p>因而UserAgent就诞生了。Mosaic将自己标志为<code>NCSA_Mosaic/2.0 (Windows 3.1)</code>，大家该怎么写代码就怎么写，但请求会带上这个信息，服务器就知道该不该返回能显示图片的html。UserAgent君，出生时跟我们设想的一样简单，仅仅标明了自己是什么浏览器，在什么系统运行，以及各自的版本号。</p>
<p>新旧浏览器们像彬彬有礼的君王，商议和让位是为了更好的繁荣。但风雨欲来。</p>
<p>###三、楚汉争霸<br>像刘邦一样，走出来一个搅局的小流氓。当然他还是很有志向的，他的目标，就是战胜霸主Mosaic。后来，他还真的做到了。<br>如今，所有现代浏览器的UserAgent里都有它的标志，就像汉朝之后，我们都称为“汉”人。一群很有天赋的程序员，一起缔造了它的辉煌。</p>
<p>真是具有跨时代意义的工具呀，好伟大呀，人们在想，它叫什么呢？<br>但大神就是大神，大神就是让你永远也猜不到他们想了个什么名字。<br>大神们说，叫Mozilla，不行么？<br>行。但什么意思呢？</p>
<p>含义有二。其一，哥斯拉(Godzilla)谐音，诚然是一头野心勃勃的怪兽；其二，”Mosaic Killa”之意，Killa是俚语中Killer的拼法，即“马赛克的终结者”，赤裸裸的挑战。  </p>
<p>惊呆了的Mosaic小心翼翼的念着Mozilla这发音：“Mo…摸咋了？”勃然大怒，“摸你妹！”</p>
<p>鉴于Mosaic当时的权势，Mozilla改名成Netscape Navigator(网景航海家)。小怪兽突然变成有点文艺小清新的名字，郁闷得很，但内心的血液沸腾着。虽然叫大名叫网景，但它把UserAgent偷偷设置成<code>Mozilla/1.0 (Win3.1)</code>。还是摸咋了？咬我？</p>
<p>###四、宋元之战<br>很快，NetScape战胜了Mosaic，成为了新的霸主，因为其更优的展示。<br>NetScape最先支持了html框架显示，就是简单的table布局，内外边距之类，仅仅这点就将Mosaic抛诸身后。区别这两个浏览器，还是用的UserAgent。如果是UserAgent里含有“Mozilla”字样，那就发送支持框架的页面，否则，就发送不含框架的页面。  </p>
<p>NetScape帝国日益庞大，歌舞升平，一切风平浪静，直到微软的铁骑挥军南下。</p>
<p>微软发布了一款跟系统强绑定的浏览器，真是具有跨时代意义的工具呀，好伟大呀，人们在想，它叫什么呢？<br>不用想了，就是IE。这命名也相当简单粗暴，Internet Explorer，直接把这工具的用途拍在你脸上。连说明书都可以免了。</p>
<p>IE也是支持html标准框架的，但由于前面的历史原因，人们只会给UserAgent里含有“Mozilla”字样的浏览器发送含框架的页面。但这点小事能难倒我大微软？IE呵呵一笑，把自己的UserAgent改成<code>Mozilla/1.22 (compatible; MSIE 2.0; Windows 95)</code>。看，我这里也有“Mozilla”字样，也能收到含框架的页面了！</p>
<p>当然，这个小流氓行为，跟后来把IE和Windows捆绑一起销售的大流氓行为比起来，根本不为足道。后面的故事我们也知道了，IE把NetScape干掉了。但它的身体上，却永远的烙上了“Mozilla”的印记。</p>
<p>###五、康乾盛世</p>
<p>看过奥特曼的都知道，怪兽被打败了会再回来。别忘了NetScape曾拥有一批大神们，失败后，他们围绕着浏览器排版引擎Gecko(壁虎)成立了非正式组织Mozilla。小怪兽再次出发。大神们发明了另一款优秀的浏览器，它在插件拓展和开发调试领域做出的贡献，绝对可以载入互联网历史。</p>
<p>真是具有跨时代意义的工具呀，好伟大呀，人们在想，它叫什么呢？<br>但大神就是大神，大神就是即使你知道了Mozilla的命名都是野兽，却还是猜不到是什么。<br>Mozilla说，我们浴火重生，叫Phoenix(凤凰)！不行么？<br>真不行。</p>
<p>刚推出就被人告了，原来已经有一家公司叫做“凤凰科技”。<br>Mozilla瀑布汗，改名叫Firebird(火鸟)！还不行么？<br>我们得原谅一下他们的取名，虽然现在看来满满的山寨感，可放在那个时代，Firebird这名字很炫酷。就像你当初的QQ昵称叫赤炎天使感觉依然良好一样。</p>
<p>但是，他们发现，业内有个数据库系统，也叫的Firebird…泪流满面的Mozilla感慨重生好难呀。最后才决定叫Firefox(火狐)。     </p>
<p>基于Gecko引擎的Firefox非常优秀，为了告诉大家，我使用了这个引擎，它标志自己的UserAgent为<code>Mozilla/5.0 (Windows; U; Windows NT 5.1; sv-SE; rv:1.7.5) Gecko/20041108 Firefox/1.0</code>。<br>这时候的UserAgent，虽然长了点，但它并不混乱，准确的标明了系统，排版引擎，浏览器名称等信息。虽然IE这时已经占有了很大的市场份额，但基本停步不前；而Mozilla经过一段时间的修生养息，Firefox在业内广受好评，得到了快速的发展。</p>
<p>时值2003年，web2.0的浪潮前夕，浏览器的发展达到了空前的盛世。<br>然而所谓否极泰来，盛极则衰。涅槃的Firefox迎来盛世，却又恰恰由于盛世，决定了UserAgent纠结的命运。</p>
<hr>
<p><a href="/2014/10/05/history-of-browser-useragent2/">《浏览器野史 UserAgent列传（下）》</a></p>
<p>To Be Continue.<br>Sujuei 2014.9.28</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/browser-history.jpg&quot; alt=&quot;其实应该叫做浏览器约架史&quot;&gt;   &lt;/p&gt;
&lt;p&gt;某天，我做一个小项目，需要判断一下浏览器类型。简单的呀。&lt;br&gt;控制台敲下：&lt;code&gt;navigator.userAgent&lt;/code&gt;&lt;br&gt;浏览器回应：&lt;code&gt;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.153 Safari/537.36&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;天，这串是啥？你怎么连话都说不清楚？&lt;/p&gt;
&lt;p&gt;我对userAgent并不陌生，但明明一个单词就可以说清楚的事情，却是这么掏心掏肺的回答。怪可怜的，一定有冤情。&lt;/p&gt;
&lt;p&gt;后来我查阅了很多资料，发现历史非常的精彩。&lt;/p&gt;
    
    </summary>
    
    
      <category term="web" scheme="//Sujuei.me/tags/web/"/>
    
      <category term="浏览器" scheme="//Sujuei.me/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>丽江之旅</title>
    <link href="//Sujuei.me/2014/09/26/journey-to-yunnan/"/>
    <id>//Sujuei.me/2014/09/26/journey-to-yunnan/</id>
    <published>2014-09-25T16:53:00.000Z</published>
    <updated>2016-11-21T07:45:19.488Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/lijiang.jpg" alt="丽江古城">   </p>
<p>回来时给每个身边的好朋友都带了小礼物，最后却发现忘了给自己带。只有旅行时写的一些日记。蠢哭。</p>
<p>##无可救药</p>
<p>丽江这个地方，只要稍微给它写点文字，就会无一例外显得矫情。</p>
<p>天这么蓝，你不能不望。他们说，你看这天真他妈蓝。<br>吉他太动人，你不能不听。他们说，靠 ，大爷你NB。<br>酒喝得畅快，你不能不喝。他们笑着说，看你爽成那傻X样。</p>
<p>后来我终于明白：用粗俗的话去回避情感。因为这个地方，真是太TMD容易矫情了。<br>矫情是病，得治。荒诞又真实的人们认为，粗话是最温柔的良方！</p>
<p>只有在这说上几句，才觉得真实。这种感觉非常的微妙，就好像蜜糖太甜了，你必须去掺点无味的白水。又好比你与班上喜欢的一个姑娘相遇相视，她朝你微笑，你的眼神却飘忽云外。心如鹿撞，表现却一定得毫不在意。哥的心就是一块磐石，脸皮不重要，原则也不重要，重要的就是这不为所动的气场！老天才懂得解释这种诡异的现象。</p>
<p>结果白云悠悠，蓝天依旧。蜜糖还是甜。我们还是一群神经病。</p>
<a id="more"></a>
<p>##总有人幸福</p>
<p>其实可以想象。一个小镇，依山傍水，不经战火，在几百年上千年的时间里，太阳的万丈光华挥洒其中，自然而然就会像酒一样越来越醇。<br>来丽江之前，很多朋友就跟我说，你可能要失望的，这酒，包装太商业化了。第一天在丽江，第一个印象是民谣吉他缓缓流过商业化的四方街，其实没有惊喜，也没有失望。一切刚刚好。</p>
<p>后来我们每个晚上都跑古城，就越来越轻车熟路。小路直奔大水车，沿着满街的《一瞬间》走到四方街，左边吃的，右边酒吧。我喜欢这么简单的路线，连我这路痴都无所畏惧。但后来我又想，让我在这迷路一次也行呀。</p>
<p>有一天晚上，跟小草，jeep，karl一起去love wine &amp; 9酒吧。这里一男一女的驻唱，吉他与纳西手鼓相映相和，节拍流淌似水。“风花雪月”一瓶接着一瓶入喉，我觉得自己像一条鱼。酒是个好东西，所有的向往所有的忧虑所有的惆怅所有的欢乐，都可以借此浸泡在沉思里。往事的大浪滔滔，倒流的是一些水，你又会觉得跟鱼无关。这个时候，各自陈旧的心锁一一被瓦解，听着别人的故事感觉是自己的独白。每个人自有自的欢乐与悲伤，酒和音乐是大功率的放大器，将内心的电波投射到夜里，管它有没有听众。</p>
<p>而后我说，但夜里不该只聊孤独，迷茫与悔恨，此时此刻还是有幸福的东西呀。你们看那两个驻唱，他们是一对。能一起唱歌多幸福！<br>他们说，你怎么看出是一对？<br>我说，他们自己说的，你们没听见。<br>他们说，即使是一对，也不见得幸福，只是你看起来他们幸福。</p>
<p>直到他们唱到《安阳》——</p>
<blockquote>
<p>所有的人都醉了<br>  请为我点盏灯火<br>  在夜里静静歌唱<br>  回忆是淡淡忧伤…         </p>
</blockquote>
<p>妈蛋我最喜欢听的这首歌，此刻才最有感觉。<br>以前我觉得那个“点盏灯火”的人，应该是个还醒着的人，或许是个温柔的女孩，来找醉了的“我”；现在突然觉得，既然所有人都醉了，点灯的人应该就是自己。但他并不孤独，因为，所有的人都陪他醉了。</p>
<p>你们的眼睛都瞎了？两人唱完最后一首粤语歌，下楼梯还拉着手。我不相信他们不幸福。未来和过去不必讲，至少此时此刻。</p>
<p>##把我埋葬在深深的凉粉里</p>
<p>比起古城，我更喜欢束河。<br>白天人少，许多店铺十点多还没开门。有天一早，就跟小草去束河。两人写完明信片，走出“时光漫步”，往右一看，好家伙，没有一个人，一条路居然可望到尽头，蓝天与青石相接，两旁建筑静谧慵懒，好像所有的生灵都躲着我们不敢出来。小草说，没有人的古镇才有味道。我心里也被震撼住了，我说，是呀，但我的确闻到了好香的味道。</p>
<p>鸡豆凉粉。</p>
<p>胖乎乎的凉粉块好似肥肉，老婆子拿小铁皮切开，这就蹦跳着下锅啦。起油锅，洋洋洒洒铺一层油，凉粉们说，不对，脚底有点疼，老子不干了，生气了，就在上面滑溜溜的跳啊闹啊。青绿色慢慢变黄，翻一下，不敢用力，太嫩了怕翻烂。凉粉们还唱起了歌，滋滋滋的瞎叫。老婆子一看凉粉们在求饶，怪可怜的，就让他们跳到铲子上来。这边姜蒜辣椒切得了，扔上一把，趁着凉粉的热气，一凑合，一搅拌，齐活了。</p>
<p>开始惴惴不安，其一，这世界上原来还有热的凉粉？其二，这世界还有块状的凉粉？不过管它呢，都到我碗里来。<br>咬一口，辣椒让凉粉的味道活了，鲜香饱满，温润通畅。<br>其三，世界上原来还有这么好吃的凉粉呀…</p>
<p>##去哪儿</p>
<p>好比，一个女子，老了就应该优雅智慧，从容端庄，这是她最真实的美丽。假如她还假装纯真烂漫，恐怕是令人啼笑的。<br>一座古城也应该这样。无线电波包围你我，Wifi和3G横穿马路，难不成在古城通讯还得飞鸽传书？这不真实。丽江很真实，至少从某种意义来说。这样的地方，才不容易玩腻。</p>
<p>如果真的玩腻了，那就离开丽江。<br>上雪山在阳光里运动运动。<br>要么去拉市海骑马，看看日出。<br>要么去泸沽湖，白天风景，晚上火塘。<br>再去香格里拉，到松赞林寺看下喇嘛。<br>或者到普达措转一圈，看看湖里的白云。<br>晚上约上几个朋友，再到独克宗找个地方喝酒。聊聊天，随便做点什么。</p>
<p>几天下来，你就会发现，还是丽江有意思。</p>
<p>THE END.<br>2014.9.26</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/lijiang.jpg&quot; alt=&quot;丽江古城&quot;&gt;   &lt;/p&gt;
&lt;p&gt;回来时给每个身边的好朋友都带了小礼物，最后却发现忘了给自己带。只有旅行时写的一些日记。蠢哭。&lt;/p&gt;
&lt;p&gt;##无可救药&lt;/p&gt;
&lt;p&gt;丽江这个地方，只要稍微给它写点文字，就会无一例外显得矫情。&lt;/p&gt;
&lt;p&gt;天这么蓝，你不能不望。他们说，你看这天真他妈蓝。&lt;br&gt;吉他太动人，你不能不听。他们说，靠 ，大爷你NB。&lt;br&gt;酒喝得畅快，你不能不喝。他们笑着说，看你爽成那傻X样。&lt;/p&gt;
&lt;p&gt;后来我终于明白：用粗俗的话去回避情感。因为这个地方，真是太TMD容易矫情了。&lt;br&gt;矫情是病，得治。荒诞又真实的人们认为，粗话是最温柔的良方！&lt;/p&gt;
&lt;p&gt;只有在这说上几句，才觉得真实。这种感觉非常的微妙，就好像蜜糖太甜了，你必须去掺点无味的白水。又好比你与班上喜欢的一个姑娘相遇相视，她朝你微笑，你的眼神却飘忽云外。心如鹿撞，表现却一定得毫不在意。哥的心就是一块磐石，脸皮不重要，原则也不重要，重要的就是这不为所动的气场！老天才懂得解释这种诡异的现象。&lt;/p&gt;
&lt;p&gt;结果白云悠悠，蓝天依旧。蜜糖还是甜。我们还是一群神经病。&lt;/p&gt;
    
    </summary>
    
    
      <category term="生活" scheme="//Sujuei.me/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="旧事" scheme="//Sujuei.me/tags/%E6%97%A7%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title>再议减少HTTP请求</title>
    <link href="//Sujuei.me/2014/08/14/reduce-http-requests/"/>
    <id>//Sujuei.me/2014/08/14/reduce-http-requests/</id>
    <published>2014-08-14T05:10:00.000Z</published>
    <updated>2016-11-21T05:22:38.941Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/reduce-http.jpg" alt="沙龙分享">       </p>
<blockquote>
<p>最近参加了IMWEB前端技术沙龙活动，有幸能站到讲台上，将性能方面的经验与大家分享。现将“再议减少HTTP请求”部分简单摘剪成文。</p>
</blockquote>
<a id="more"></a>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言:"></a>前言:</h3><p>关于web性能，有两个著名论断：              </p>
<ol>
<li><strong>0.1-0.2s 用户认为是即时的；1-5s 用户觉得自己能与信息流畅地交互；5-10s 用户开始转移注意力</strong>——Robert Miller                               </li>
<li><strong>用户所接受的数据，有80~90%的时间都耗在前端上</strong>——Steve Souders</li>
</ol>
<p>前者说明，loading图（以下简称菊花）是必要的。人处于“开始转移注意力”时，这朵菊花就开始挽留你躁动的心。但web工程师的一个使命，就是通过提升性能，不让用户看到菊花。菊花要有，但不能常有，真是一朵磨人的小妖精…</p>
<p>后者说明，资源的加载和渲染可以大做文章。因为一个html文件，几乎是所有资源的承载器，哪些优先加载，怎样加载，都是前端工程师可以控制的。</p>
<h3 id="再议减少HTTP请求："><a href="#再议减少HTTP请求：" class="headerlink" title="再议减少HTTP请求："></a>再议减少HTTP请求：</h3><p>“尽量减少HTTP请求，减少DNS查找”这是Yslow写在最前面的两条规则。而放之实际，可能会遇到挑战。为何？因为我们完成了“降低请求数”的目标，但可能损失了其他方面的指标。</p>
<p><strong>a. 没有浏览器缓存</strong><br>减少HTTP请求，很常用的做法就是把js和css资源inline到html里。这样的做法，自然没有浏览器缓存，重复加载时连静态资源也必须加载。也许有人又说，我可以把整个html文件都缓存啊！的确可以，但以web开发的更新速度，html文件一般都不设或设置很短时间（5 min?）缓存。另外在web2.0时代里，html缓存会带来不必要的问题。比如登录前后，页面资源展示不一样，那么我们就得慎用html缓存。</p>
<p><strong>b. 没有cdn缓存</strong><br>这个很好理解，任何的内联资源，由于依赖于html，都必须从源服务器而不是cdn服务器返回。</p>
<p><strong>c. 不能按需加载</strong><br>为了按需加载，前端工程师可谓想法各异，天马行空。比如图片的lazyload技术，异步加载js脚本，而inline的方式恰恰将一切想法摁回脑中。</p>
<p><strong>d. 浏览器预解析DNS失效</strong><br>现代浏览器有预解析DNS技术。简单来说，就是页面下载到浏览器时，先扫描一遍，在这时发现域名并预解析DNS。这样的前置解析跟dom渲染等操作同步执行，诚然会使浏览器更快。但如果你的html页面因为内联了太多内容（base64图片），大于5M时，浏览器的预解析DNS将会失效。</p>
<h3 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h3><p>因而，我们时常像那只捡芝麻丢西瓜的熊。如此平衡这两者呢，业界给我们两个很好的案例。</p>
<p><strong>Demo1 必应</strong>               </p>
<blockquote>
<ol>
<li>首次内联CSS与JS<ol>
<li>将资源取出，并保存在localStorage中</li>
<li>资源名（版本）保存在cookie中</li>
<li>后续请求中，服务器检查对应的cookie</li>
<li>根据cookie的值，只嵌入新的脚本</li>
<li>加载时，从localStorage里载入资源</li>
</ol>
</li>
</ol>
</blockquote>
<p><strong>Demo2 百度(移动端)</strong>               </p>
<blockquote>
<ol>
<li>首次将静态资源打包，用jsonp统一返回<ol>
<li>将资源解析并保存在localStorage中</li>
<li>再次访问时检查localStorage中资源情况</li>
<li>如有缺失再发请求获取资源</li>
</ol>
</li>
</ol>
</blockquote>
<p>必应的做法确保了首次的http请求最少，后续充分发挥增量更新（当然粒度还是文件）的优势提高性能，但缺点是cookie并不可靠。百度则是把首次静态资源的http请求降低到一次，非常暴力的把全部css，js打包成字符串，以jsonp返回。宁愿用str转obj的解析时间去换取加载时间。而随V8引擎的强大，这点解析的时间也将越来越不值得提起。总而言之，这两个Demo都把http请求尽可能的降低，而后都利用了本地存储去获得资源。              </p>
<p>我有时候会想起那把由无名的铁匠用三个小时粗制而成的小李飞刀。<br>你得对技术怀敬畏之心。因为那些谁都懂的技术，在某些人的手里，还真能变出花儿来。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/reduce-http.jpg&quot; alt=&quot;沙龙分享&quot;&gt;       &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;最近参加了IMWEB前端技术沙龙活动，有幸能站到讲台上，将性能方面的经验与大家分享。现将“再议减少HTTP请求”部分简单摘剪成文。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="html5" scheme="//Sujuei.me/tags/html5/"/>
    
      <category term="前端" scheme="//Sujuei.me/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="性能" scheme="//Sujuei.me/tags/%E6%80%A7%E8%83%BD/"/>
    
  </entry>
  
  <entry>
    <title>一个文件夹的自我介绍</title>
    <link href="//Sujuei.me/2014/07/25/folder-to-tree/"/>
    <id>//Sujuei.me/2014/07/25/folder-to-tree/</id>
    <published>2014-07-25T00:52:00.000Z</published>
    <updated>2016-11-21T05:22:38.927Z</updated>
    
    <content type="html"><![CDATA[<p>#folder2tree</p>
<blockquote>
<p>用字符展示文件夹结构</p>
</blockquote>
<h3 id="前言-Before"><a href="#前言-Before" class="headerlink" title="前言 Before:"></a>前言 Before:</h3><p>如何介绍一个文件夹，简直纠结。 </p>
<p>要么<strong>图片</strong>，如果在截图前，你真的愿意，一层一层一层的剥开我的心。你会鼻酸你会流泪；<br>要么<strong>靠说</strong>，那么你可能得这么说：从前，有一个文件夹，文件夹里有两张图片；大图片在跟小图片讲故事…讲个什么故事额          </p>
<p><strong>因而，用纯字符描述文件夹的小工具必须得有呀。</strong><a href="https://github.com/litten/folder2tree" target="_blank" rel="external">github here</a>.<br><a id="more"></a></p>
<h3 id="使用-Usage"><a href="#使用-Usage" class="headerlink" title="使用 Usage:"></a>使用 Usage:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">@param &#123;Dom&#125; 父级dom节点               </div><div class="line">@param &#123;<span class="built_in">Array</span>&#125; 描述文件夹层级关系对象</div><div class="line"></div><div class="line">folder2tree.init(<span class="built_in">document</span>.getElementById(<span class="string">"ctn"</span>), [</div><div class="line">	&#123;</div><div class="line">		<span class="string">"img"</span> : [</div><div class="line">			<span class="string">"sprite.png"</span>,</div><div class="line">			<span class="string">"bg.png"</span></div><div class="line">		]</div><div class="line">	&#125;,&#123;</div><div class="line">		<span class="string">"js"</span>: [&#123;</div><div class="line">			<span class="string">"common"</span>: [</div><div class="line">				<span class="string">"jquery.js"</span>,&#123;</div><div class="line">					<span class="string">"highcharts"</span>: [&#123;</div><div class="line">						<span class="string">"modules"</span>: [<span class="string">"exporting.js"</span>]</div><div class="line">					&#125;,</div><div class="line">					<span class="string">"highcharts.js"</span></div><div class="line">				]&#125;</div><div class="line">			]</div><div class="line">		&#125;,&#123;</div><div class="line">			<span class="string">"index"</span>: [</div><div class="line">				<span class="string">"mian.js"</span>,&#123;</div><div class="line">					<span class="string">"modules"</span>: [<span class="string">"mod.video.js"</span>]</div><div class="line">				&#125;</div><div class="line">			]</div><div class="line">		&#125;]</div><div class="line">	&#125;,&#123;</div><div class="line">		<span class="string">"css"</span>: [</div><div class="line">			<span class="string">"base.css"</span>,</div><div class="line">			<span class="string">"index-main.css"</span>,</div><div class="line">			<span class="string">"index-video.css"</span></div><div class="line">		]</div><div class="line">	&#125;,</div><div class="line">	<span class="string">"index.html"</span>,</div><div class="line">	<span class="string">"favicon.ico"</span></div><div class="line">]);</div></pre></td></tr></table></figure>
<h3 id="展示-Show"><a href="#展示-Show" class="headerlink" title="展示 Show:"></a>展示 Show:</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">├─<span class="selector-tag">img</span></div><div class="line">│ ├─sprite<span class="selector-class">.png</span></div><div class="line">│ └─bg<span class="selector-class">.png</span></div><div class="line">├─js</div><div class="line">│ ├─common</div><div class="line">│ │ ├─jquery<span class="selector-class">.js</span></div><div class="line">│ │ └─highcharts</div><div class="line">│ │    ├─modules</div><div class="line">│ │    │ └─exporting<span class="selector-class">.js</span></div><div class="line">│ │    └─highcharts<span class="selector-class">.js</span></div><div class="line">│ └─index</div><div class="line">│    ├─mian<span class="selector-class">.js</span></div><div class="line">│    └─modules</div><div class="line">│       └─mod<span class="selector-class">.video</span><span class="selector-class">.js</span></div><div class="line">├─css</div><div class="line">│ ├─base<span class="selector-class">.css</span></div><div class="line">│ ├─index-main<span class="selector-class">.css</span></div><div class="line">│ └─index-<span class="selector-tag">video</span><span class="selector-class">.css</span></div><div class="line">├─index<span class="selector-class">.html</span></div><div class="line">└─favicon.ico</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;#folder2tree&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;用字符展示文件夹结构&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;前言-Before&quot;&gt;&lt;a href=&quot;#前言-Before&quot; class=&quot;headerlink&quot; title=&quot;前言 Before:&quot;&gt;&lt;/a&gt;前言 Before:&lt;/h3&gt;&lt;p&gt;如何介绍一个文件夹，简直纠结。 &lt;/p&gt;
&lt;p&gt;要么&lt;strong&gt;图片&lt;/strong&gt;，如果在截图前，你真的愿意，一层一层一层的剥开我的心。你会鼻酸你会流泪；&lt;br&gt;要么&lt;strong&gt;靠说&lt;/strong&gt;，那么你可能得这么说：从前，有一个文件夹，文件夹里有两张图片；大图片在跟小图片讲故事…讲个什么故事额          &lt;/p&gt;
&lt;p&gt;&lt;strong&gt;因而，用纯字符描述文件夹的小工具必须得有呀。&lt;/strong&gt;&lt;a href=&quot;https://github.com/litten/folder2tree&quot;&gt;github here&lt;/a&gt;.&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//Sujuei.me/tags/js/"/>
    
      <category term="工具" scheme="//Sujuei.me/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>instagram图片拉取小经验</title>
    <link href="//Sujuei.me/2014/03/03/instagram-api-ex/"/>
    <id>//Sujuei.me/2014/03/03/instagram-api-ex/</id>
    <published>2014-03-03T14:52:00.000Z</published>
    <updated>2016-11-21T07:54:01.438Z</updated>
    
    <content type="html"><![CDATA[<p>最近喜欢上了instagram，分享一下获取照片的经验。<br><a id="more"></a></p>
<p>###一、三“步”曲<br>instagram开放了API，授权遵循Oauth2.0协议。        </p>
<p>####1、注册client id<br>到<a href="http://instagram.com/developer/clients/manage/" target="_blank" rel="external">管理客户端页面</a>，选择“注册新客户端”。<br>这时会提示你填手机号，接着会收到短信验证码。经过验证，就到达了下面的界面：<br><img src="/assets/blogImg/instagram1.jpg" alt="填写信息"><br>按照字面意思填写完毕，client id就注册完毕了。                 </p>
<p><img src="/assets/blogImg/instagram2.jpg" alt="获得client_id">         </p>
<p>####2、用client_id去换取token<br>在浏览器中请求：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https:<span class="regexp">//i</span>nstagram.com<span class="regexp">/oauth/</span>authorize<span class="regexp">/?client_id=&#123;CLIENT_ID&#125;&amp;redirect_uri=&#123;REDIRECT_URI&#125;&amp;response_type=token</span></div></pre></td></tr></table></figure></p>
<p>花括号里面的值，对应上一步最终得到的<code>client_id</code>和自己设定的<code>redirect_uri</code>。<br>请求到的是一个授权页面，授权完毕后，则重定向到你的redirect_uri。注意看授权成功后的url，hash部分会附带给你的token。至此，token成功获取。</p>
<p>####3、用token去调用API</p>
<p>拿到token，就等于拿到仓库的钥匙了！<br>赶紧试着用token调用api查看自己的图片吧：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https:<span class="regexp">//</span>api.instagram.com<span class="regexp">/v1/u</span>sers<span class="regexp">/&#123;USER_ID&#125;/m</span>edia<span class="regexp">/recent/</span>?access_token=&#123;TOKEN&#125;</div></pre></td></tr></table></figure></p>
<p>这时，你会发现似乎…被instagram api坑了一道。user_id是个啥？机智如我，果断填上了自己的用户名。<br>结果错了。</p>
<p>后来发现有这个的网站：<a href="http://jelled.com/instagram/lookup-user-id" target="_blank" rel="external">lookup-user-id</a>，通过此业界良心，成功获取到user_id，摆平了上面的请求。</p>
<p>###二、参考</p>
<ol>
<li>更多功能可参考<a href="http://instagram.com/developer/endpoints/users/" target="_blank" rel="external">api文档</a></li>
<li>如果想了解Oauth授权，<a href="/blog/2013/08/20/oauth-rabbit/">点此</a></li>
</ol>
<p>###三、再说两句<br>图片分享的网站万万千，instagram却只有一个。我不是此产品的脑残粉，只是觉得社区氛围这种东西，可意会而不可言传，它是社交产品的灵魂。不是每个功能相近的产品都能营造的。</p>
<p>事实上，instagram有很多限制，或者大家称之“功能不完善”的地方。比如，在pc上浏览网站，居然不能发图片，不能看自己关注的人，或者有哪些粉丝。这都限制死了，何以称为社交？但换个角度来想，这样就“强迫”用户去用手机操作instagram，因为产品最想想表达的，就是用摄影去快速记录生活，而已。</p>
<p>不用拓展业务的噱头去损坏产品的思想表达，不刻意向老板汇报我们新增了多少用户量。</p>
<p><strong>“你想做什么，你就会进入什么样的圈子”</strong>，这句话，不单单是对用户而言，每个创造者心中都应有这样的思考。</p>
<p>the end.<br>Sujuei 2014.3.3</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近喜欢上了instagram，分享一下获取照片的经验。&lt;br&gt;
    
    </summary>
    
    
      <category term="web" scheme="//Sujuei.me/tags/web/"/>
    
      <category term="经验" scheme="//Sujuei.me/tags/%E7%BB%8F%E9%AA%8C/"/>
    
      <category term="产品" scheme="//Sujuei.me/tags/%E4%BA%A7%E5%93%81/"/>
    
  </entry>
  
  <entry>
    <title>像素级细节：移动端1px border的实现</title>
    <link href="//Sujuei.me/2014/02/22/thinner-than-1px-border/"/>
    <id>//Sujuei.me/2014/02/22/thinner-than-1px-border/</id>
    <published>2014-02-22T12:11:00.000Z</published>
    <updated>2016-11-21T07:59:27.844Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>请记住，每个尽责的设计师都是处女座…</p>
</blockquote>
<p>这里…没有黑处女座的意思，只是想借题发挥，并由衷的跪倒在强大的“像素眼”之下。<br><a id="more"></a></p>
<p>###一、你是我的眼</p>
<p>什么是像素眼？<br>就是那些个神奇的存在，他们用余光瞄了你一眼，然后跟你说：我发现啊，你左边眉毛比右边眉毛高了1像素，麻烦你调整下…</p>
<p>在腾讯，我身边的许多设计同学都有这样的眼睛。他们会把细节做到极致，也会因为频繁的修改，把你开发的心情搞得一团糟。但你得承认，他们是对的。</p>
<p>最近在做移动端web开发，按着设计图，toby已在我旁边核对修改了两个多小时。当我觉得已经万事大吉时，toby跟我说，还是觉得不太对——边框好像有点粗？</p>
<p>当时我就傻眼了，因为这已是最细的边框，电脑上清楚的显示，我已经设置了1px的border。于是我去解释，并建议更换个色值，让边框至少“看起来”更细。而toby却不接受，按他给我的说法是：这border看起来不性感…</p>
<p>原来这世界的审美观，都是以瘦为美，从女人到一根线？于是乎，为了寻找性感的border，搜集一堆资料后还真找到了方案：</p>
<ul>
<li><strong>父元素设置</strong>：scale(0.5,0.5)                 </li>
<li><strong>子元素设置</strong>：scale(2,2) 还原缩放，origin都是基于左上角（0,0）/left top</li>
</ul>
<p>这样父元素的border其实被缩放了，无疑更细。</p>
<p>###二、通用方案</p>
<p>用一个css类去为block元素添加更细的border<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">.border-1px&#123;</div><div class="line">  position: relative;</div><div class="line">  &amp;:before, &amp;:after&#123;</div><div class="line">    border-top: 1px solid #c8c7cc;</div><div class="line">    content: ' ';</div><div class="line">    display: block;</div><div class="line">    width: 100%;</div><div class="line">    position: absolute;</div><div class="line">    left: 0;</div><div class="line">  &#125;</div><div class="line">  &amp;:before&#123;</div><div class="line">    top: 0;</div><div class="line">  &#125;</div><div class="line">  &amp;:after&#123;</div><div class="line">    bottom: 0;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>适应移动设备：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@media (-webkit-min-device-pixel-ratio:1.5), (min-device-pixel-ratio: 1.5)&#123;</div><div class="line">  .border-1px&#123;</div><div class="line">    &amp;::after, &amp;::before&#123;</div><div class="line">      -webkit-transform: scaleY(.7);</div><div class="line">      -webkit-transform-origin: 0 0;</div><div class="line">      transform: scaleY(.7);</div><div class="line">    &#125;</div><div class="line">    &amp;::after&#123;</div><div class="line">      -webkit-transform-origin: left bottom;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@media (-webkit-min-device-pixel-ratio:2), (min-device-pixel-ratio: 2)&#123;</div><div class="line">  .border-1px&#123;</div><div class="line">    &amp;::after, &amp;::before&#123;</div><div class="line">      -webkit-transform: scaleY(.5);</div><div class="line">      transform: scaleY(.5);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###三、来个对比</p>
<p>比如，之前我学日语时，自己搞起了个app，这是50音列表界面，可以明显的看出区别：上图是原生方案，下图是…性感方案<br><img src="/assets/blogImg/border1px.jpg" alt="与原生方案对比">      </p>
<p>源码小demo，注意要在手机上才能看到效果：<a href="/assets/demo/border1px.html">demo</a>。</p>
<p>The End.<br>——Sujuei 2.22 </p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;请记住，每个尽责的设计师都是处女座…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这里…没有黑处女座的意思，只是想借题发挥，并由衷的跪倒在强大的“像素眼”之下。&lt;br&gt;
    
    </summary>
    
    
      <category term="html5" scheme="//Sujuei.me/tags/html5/"/>
    
      <category term="css3" scheme="//Sujuei.me/tags/css3/"/>
    
  </entry>
  
  <entry>
    <title>pjax: 当ajax遇上pushState</title>
    <link href="//Sujuei.me/2014/02/12/about-pjax/"/>
    <id>//Sujuei.me/2014/02/12/about-pjax/</id>
    <published>2014-02-12T00:55:00.000Z</published>
    <updated>2016-11-21T05:22:38.920Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p>var pjax = pushState + ajax;<br>小时候，小浣熊方便面里面有各种水浒人物的卡片。我买了一包，吃了方便面，饱了。而我又买了第二包，不是想吃方便面，而是仅仅想得到里面的卡片…          </p>
</blockquote>
<a id="more"></a>
<p>##<strong>一、简介</strong><br>pushState是html5中提供的方法，用以</p>
<ul>
<li>无刷新的更新浏览器地址栏；            </li>
<li>如其名称，将新地址push到历史堆栈中            </li>
</ul>
<p>用法：<code>pushState(data, title ,url)</code>            </p>
<p>data为保存的对象，可以在window.onpopstate时获取到；title为页面标题；url为需地址栏和历史发生改变的url。<br>正是这点看似很平常的功能，跟ajax结合到一起产生了火花。因为，ajax最擅长的事情就是局部刷新页面。</p>
<p>##<strong>二、ajax的纠结历史</strong><br>一切可以从ajax最擅长的事情说起。<br>ajax作为一个异步请求模型，从最初设计开始，也许压根就没打算将它跟浏览器历史挂钩。原因是历史堆栈所记录的，某种意思上可以说是顺序，跟我们理解的“同步”更为密切。</p>
<p>因而，<code>ajax可以无刷新改变页面内容，却无法改变页面的url</code>。</p>
<ul>
<li>####历史问题1 - 如何操控历史</li>
</ul>
<p>当单页面越来越流行，操作记录却很容易被忽略。假设有这样的单页面，按照分类点击，界面逐层递进：<code>体育 - 篮球 -nba -马刺队 - 邓肯</code><br>当我们点了4下到“邓肯”界面时，一个不小心的刷新，出现在你面前的也许是“体育”。原因是操作记录没有被记录。<br>而通常的解决方案是修改hash，每递进一层，去更新url的hash值，这样的方法：</p>
<ol>
<li>刷新时预先判断url的hash，从而知道这是哪一层，加载相应数据；          </li>
<li>支持了历史</li>
</ol>
<p>这样的方式貌似比较完善，其实不然。</p>
<ul>
<li>####历史问题2 - 对搜索引擎不友好</li>
</ul>
<p>最大的问题是，hash后生成的内容是不会被搜索引擎引用到。数据不能被爬取，无疑是浪费和损失。因此google放言，咱可以约定个协议：<code>#!xxx</code>这样hash的url，google也去爬取。称之为<code>hash bang</code>（哈希大爆炸？）。这一协议，在g+，twitter，人人，新浪微博上都可以看到。</p>
<p>事实上，ajax最或缺的两个问题，恰好被pushState的功能补充完善。</p>
<p>##<strong>三、pjax带来的价值</strong><br>除去补齐了ajax的问题，我们发现pjax会给web带来更多的好处。<br>回到开始说的“两包方便面”，我的意思是，有时你访问两个url，部分数据是相同的。比如百度贴吧，第一页和第二页的区别只是帖子内容（卡片）的不同，网站外框部分（方便面）都是一样的，这些东西就不需要在页面刷新时重复加载。</p>
<p>ajax处理这样的局部刷新，已经给我们带来了web2.0的体验，而加上pushstate的ajax则更进一步：</p>
<ol>
<li>一个url对应一套数据，有利于SEO；</li>
<li>更改数据和url时，只是局部刷新，带来较好的用户体验；</li>
<li>兼容性好，对不支持pushstate的浏览器，url也能正常请求页面（虽然有重复加载）；</li>
<li>刷新页面时，由于是url唯一，能正常加载到用户希望看到的数据，比处理hash的方式更方便；</li>
<li>后退与前进的浏览器操作，依然可以局部刷新（通过onpushstate事件捕获）</li>
</ol>
<p>##<strong>四、注意事项</strong></p>
<p>然而pjax不等于单纯的分离使用pushstate与ajax，还必须得做一些封装。缘于以下我能想到的注意事项：</p>
<ul>
<li>服务器端增加额外处理逻辑<br>服务器端，需要根据请求的参数，作出全页渲染或局部渲染响应<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="string">Accept:</span>text<span class="regexp">/html, */</span>*; q=<span class="number">0.01</span></div><div class="line">Accept-<span class="string">Encoding:</span>gzip,deflate,sdch</div><div class="line"><span class="string">Connection:</span>keep-alive</div><div class="line"><span class="string">Host:</span>qianduannotes.duapp.com</div><div class="line">User-<span class="string">Agent:</span>AppleWebKit<span class="regexp">/537.36 (KHTML, like Gecko) Chrome/</span><span class="number">31.0</span><span class="number">.1650</span><span class="number">.63</span> Safari/<span class="number">537.36</span></div><div class="line">X-Requested-<span class="string">With:</span>XMLHttpRequest</div><div class="line">X-<span class="string">PJAX:</span><span class="literal">true</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>比如请求头部可以设定一个X-PAJX:true，用以通知服务器。</p>
<ul>
<li><p>浏览器兼容<br>假如浏览器不支持pushstate，提供fallback操作，直接打开需更改url的地址：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$.support.pjax = <span class="built_in">window</span>.history &amp;&amp; <span class="built_in">window</span>.history.pushState</div><div class="line"><span class="comment">// Fallback</span></div><div class="line"><span class="keyword">if</span> ( !$.support.pjax ) &#123;</div><div class="line">  $.pjax = <span class="function"><span class="keyword">function</span>(<span class="params"> options </span>) </span>&#123;</div><div class="line">    <span class="built_in">window</span>.location = $.isFunction(options.url) ? options.url() : options.url</div><div class="line">  &#125;</div><div class="line">  $.fn.pjax = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>本地存储机制<br>无疑pjax与localstorage共同使用可以进一步提升体验，但这一步容易忽略的是数据上报。</p>
</li>
</ul>
<p>##<strong>五、参考资料</strong><br><a href="https://github.com/defunkt/jquery-pjax" target="_blank" rel="external">jquery-pjax</a><br><a href="https://github.com/welefen/pjax" target="_blank" rel="external">welefen封装的pjax</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;var pjax = pushState + ajax;&lt;br&gt;小时候，小浣熊方便面里面有各种水浒人物的卡片。我买了一包，吃了方便面，饱了。而我又买了第二包，不是想吃方便面，而是仅仅想得到里面的卡片…          &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="js" scheme="//Sujuei.me/tags/js/"/>
    
      <category term="html5" scheme="//Sujuei.me/tags/html5/"/>
    
  </entry>
  
  <entry>
    <title>把自己锁在杯子里</title>
    <link href="//Sujuei.me/2014/01/10/lock-me-in-a-cup/"/>
    <id>//Sujuei.me/2014/01/10/lock-me-in-a-cup/</id>
    <published>2014-01-10T12:30:00.000Z</published>
    <updated>2016-11-21T05:22:38.937Z</updated>
    
    <content type="html"><![CDATA[<p>杯子里的一条鱼<br>你可担心<br>会有天外扑来的龙卷风<br>把你的魂魄摄出领地？<br>泳池温热，心脏被灌了风，开垦者默言而卧<br>涛声隐隐作痛<br>若是一壶热酒浇下，由西向东<br>你是缱绻醉倒？还是鱼跃入梦？                                </p>
<p>—— 01.10</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;杯子里的一条鱼&lt;br&gt;你可担心&lt;br&gt;会有天外扑来的龙卷风&lt;br&gt;把你的魂魄摄出领地？&lt;br&gt;泳池温热，心脏被灌了风，开垦者默言而卧&lt;br&gt;涛声隐隐作痛&lt;br&gt;若是一壶热酒浇下，由西向东&lt;br&gt;你是缱绻醉倒？还是鱼跃入梦？                          
    
    </summary>
    
    
      <category term="旧事" scheme="//Sujuei.me/tags/%E6%97%A7%E4%BA%8B/"/>
    
      <category term="药别停" scheme="//Sujuei.me/tags/%E8%8D%AF%E5%88%AB%E5%81%9C/"/>
    
  </entry>
  
  <entry>
    <title>统一处理异步的js回调</title>
    <link href="//Sujuei.me/2013/10/06/handling-asynchronous-js/"/>
    <id>//Sujuei.me/2013/10/06/handling-asynchronous-js/</id>
    <published>2013-10-06T02:55:00.000Z</published>
    <updated>2016-11-21T05:22:38.932Z</updated>
    
    <content type="html"><![CDATA[<p>js编程时经常会用到异步处理，而异步会带了所谓的并发问题。比如，你需要向服务器发出多个ajax请求，然后在返回所有结果后做进一步处理，同时要显示动画。因此我们需要用到以下的方案。<br><a id="more"></a></p>
<p>###<strong>【定义函数】</strong><br>定义Batch函数。参数为函数组成的数组functions，这里面的函数将稍后执行，以及这些函数完成后的回调completionHandler。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Batch</span>(<span class="params">functions, completionHandler</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>._functions = functions;</div><div class="line">	<span class="keyword">this</span>._completionHandler = completionHandler;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###<strong>【启动请求】</strong><br>用this._remaining来记录未执行的函数量，然后执行各个函数。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Batch.prototype.execute = <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> i;</div><div class="line">  	<span class="keyword">var</span> functions = <span class="keyword">this</span>._functions;</div><div class="line">  	<span class="keyword">var</span> length = <span class="keyword">this</span>._remaining = functions.length;</div><div class="line">  	<span class="keyword">this</span>._results = [];</div><div class="line">  	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i += <span class="number">1</span>) &#123;</div><div class="line">      	functions[i](<span class="keyword">this</span>);</div><div class="line">  	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>###<strong>【让Batch知道函数完成】</strong><br>用this._results来记录执行结果，当this._remaining为0时，表示所有函数已执行完毕。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Batch.prototype.done = <span class="function"><span class="keyword">function</span> <span class="title">done</span>(<span class="params">result</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>._remaining -= <span class="number">1</span>;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">typeof</span>(result) !== <span class="string">'undefined'</span>) &#123;</div><div class="line">    	<span class="keyword">this</span>._results.push(result);</div><div class="line">  	&#125;</div><div class="line">  	<span class="keyword">if</span> (<span class="keyword">this</span>._remaining === <span class="number">0</span>) &#123;</div><div class="line">      	<span class="keyword">this</span>._completionHandler(<span class="keyword">this</span>._results);</div><div class="line">  	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>到这里，就完成了Batch这个函数的简单功能了。</p>
<p>###<strong>【使用】</strong><br>将Batch应用到实际上。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> urls = [</div><div class="line">  	<span class="string">'/api/gists/1000'</span>,</div><div class="line">  	<span class="string">'/api/gists/1001'</span>,</div><div class="line">  	<span class="string">'/api/gists/1002'</span>,</div><div class="line">  	<span class="string">'/api/gists/1003'</span>,</div><div class="line">  	<span class="string">'/api/gists/1004'</span>,</div><div class="line">  	<span class="comment">// ...</span></div><div class="line">  	<span class="string">'/api/gists/1337'</span>,</div><div class="line">  	<span class="comment">// etc...</span></div><div class="line">];</div><div class="line"></div><div class="line"><span class="keyword">var</span> i;</div><div class="line"><span class="keyword">var</span> length = urls.length;</div><div class="line"><span class="keyword">var</span> batchFunctions = [];</div><div class="line"></div><div class="line"><span class="comment">// 创建需要被batch执行的函数数组</span></div><div class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i += <span class="number">1</span>) &#123;</div><div class="line">  	batchFunctions.push(<span class="function"><span class="keyword">function</span> (<span class="params">batch</span>) </span>&#123;</div><div class="line">      	$.ajax.get(urls[i], <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</div><div class="line">          	batch.done(response);</div><div class="line">      	&#125;);</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> myBatch = <span class="keyword">new</span> Batch(batchFunctions, <span class="function"><span class="keyword">function</span> (<span class="params">results</span>) </span>&#123;</div><div class="line">	<span class="comment">//返回各个函数的结果数组</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">myBatch.execute(); <span class="comment">// 开始执行</span></div></pre></td></tr></table></figure></p>
<p>这样的方案其实是参考了“观察者”模式。相关源码推荐nodeJs的Async.js库。</p>
<p>THE END.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;js编程时经常会用到异步处理，而异步会带了所谓的并发问题。比如，你需要向服务器发出多个ajax请求，然后在返回所有结果后做进一步处理，同时要显示动画。因此我们需要用到以下的方案。&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//Sujuei.me/tags/js/"/>
    
      <category term="web" scheme="//Sujuei.me/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>web worker简易入门</title>
    <link href="//Sujuei.me/2013/09/25/web-worker-learning/"/>
    <id>//Sujuei.me/2013/09/25/web-worker-learning/</id>
    <published>2013-09-25T02:55:00.000Z</published>
    <updated>2016-11-21T05:22:38.945Z</updated>
    
    <content type="html"><![CDATA[<p>js是单线程的语言，由于此特性，我们在处理并发时需要用到一些技巧，如setTimeout()，setInterval()，调用XMLHttpRequest等。<br>但这里的并发只是非阻塞（参照John Resig的文章<a href="http://ejohn.org/blog/how-javascript-timers-work/" target="_blank" rel="external">How JavaScript Timers Work</a>），真正的多线程编程则需要HTML5的web worker。<br><a id="more"></a></p>
<p>###<strong>【worker的使用】</strong><br>web worker的使用非常简单，线程之间通讯的api与html5 postmessage或node.js里面的socket.io方法类似。</p>
<p>通讯：      </p>
<ol>
<li>发送方：postMessage(data)      </li>
<li>接收方：onmessage(event)</li>
</ol>
<p>终止web worker:        </p>
<ol>
<li>子线程: self.close()</li>
<li>父线程: worker.terminate()</li>
</ol>
<p>按照目前w3c规范，web worker分为两种：专用worker(Dedicated Worker)和共享worker(Shared Worker)。<br><!--more--></p>
<p>###<strong>【专用worker】</strong><br>实例化一个web worker对象，异步加载子线程文件worker.js，其中的代码将执行。</p>
<pre><code>var worker = new Worker(&quot;worker.js&quot;);
</code></pre><p>给worker增加侦听</p>
<pre><code>worker.onmessage = function (event) {
    alert(event.data);
};
</code></pre><p>在worker.js里，发送消息给父线程     </p>
<pre><code>postMessage(&apos;hello，imweb&apos;);
</code></pre><p>在父线程页面就能看到发送过来的信息了。</p>
<p>同时，在web worker标准中，是支持对象参数的，也就是说我们能够传递json数据。再看一个稍微复杂点的例子，父线程：</p>
<pre><code>var worker = new Worker(&quot;worker.js&quot;);
worker.onmessage = function (event) {
    document.getElementById(&quot;result&quot;).innerHTML=event.data;
};

function start(){
    worker.postMessage({&apos;cmd&apos;: &apos;start&apos;, &apos;msg&apos;: &apos;start&apos;});
}

function pause(){
    worker.postMessage({&apos;cmd&apos;: &apos;pause&apos;, &apos;msg&apos;: &apos;pause&apos;});
}

function stop(){
    worker.postMessage({&apos;cmd&apos;: &apos;stop&apos;, &apos;msg&apos;: &apos;stop&apos;});
}

function msg(){
    worker.postMessage({&apos;msg&apos;: &apos;hello imweb&apos;});
}
</code></pre><p>worker.js：</p>
<pre><code>self.onmessage = function (e) {
    var data = e.data;
      switch (data.cmd) {
    case &apos;start&apos;:
        taskStart(); //大量数据处理
          postMessage(&apos;WORKER DO: &apos; + data.msg);
          break;
    case &apos;pause&apos;:
        taskPause();
          postMessage(&apos;WORKER DO: &apos; + data.msg);
          break;
    case &apos;stop&apos;:
          postMessage(&apos;WORKER DO: &apos; + data.msg);
          self.close(); //终止web worker
          break;
    default:
          postMessage(&apos;MESSAGE: &apos; + data.msg);
      };
};
</code></pre><p>从上面的例子可以看到，一是利用对象参数，进程之间能够较灵活的实现控制；二是当woker执行taskStart()处理大量数据时，只在子进程处理，不会给主页面带来阻塞，通常，处理大量数据会消极影响程序的响应能力，而web worker通过这样的方式，能提供一个更流畅更实时的UI。</p>
<p>###<strong>【共享worker】</strong><br>共享worker允许线程在同源中的多个页面间进行共享，例如：同源中所有页面或脚本可以与同一个共享线程通信。它的实例化与事件侦听的写法与专用worker略有不同,主页面：</p>
<pre><code>var worker = new SharedWorker(&apos;shared-worker.js&apos;);
worker.port.onmessage = function(e) {
    msg = &apos;Someone just said &quot;&apos; + e.data.message + &apos;&quot;. That is message number &apos; + e.data.counter;
    console.log(msg);
};
worker.port.postMessage(&apos;hello shared worker!&apos;);
</code></pre><p>shared-worker.js:        </p>
<pre><code>var counter = 0;
var connections = [];
onconnect = function(eConn) {
       var port = eConn.ports[0]; // 此连接的特有port

   //当有消息的时候通知所有的连接
   port.onmessage = function(eMsg) { 
       counter++;
       for (var i=0; i &lt; connections.length; i++) {
           connections[i].postMessage({
               message: eMsg.data,
               counter: counter
           });
       }
   }
   port.start();
   connections.push(port);
</code></pre><p>用两个窗口打开这个页面，第一个显示：<strong>Someone just said “Hello shared worker!” This is message number 1</strong>，第二个也收到一样的信息，<br>但是后面是<strong>message number 2</strong>。</p>
<p>###<strong>【安全性和错误检查】</strong><br>出于安全性的考虑，web worker必须遵守同源策略。同时，它的全局对象是worker对象本身，this和self引用的都是worker对象。<br>只能访问：</p>
<ol>
<li>navigator 对象（仅限appName, appVersion, platform, userAgent）</li>
<li>location 对象（只读）</li>
<li>XMLHttpRequest</li>
<li>setTimeout(), setInterval(), clearTimeout()和clearInterval()方法</li>
</ol>
<p>不能访问：</p>
<ol>
<li>DOM(不是线程安全的)</li>
<li>window 对象</li>
<li>document 对象</li>
<li>parent 对象</li>
</ol>
<p>worker内部出现错误时，可以用worker.onerror侦听到，error的事件有三个属性：      </p>
<ol>
<li>filename: 发生错误的文件名</li>
<li>lineno: 代码行号</li>
<li>message: 完整的错误信息</li>
</ol>
<p>如：</p>
<pre><code>worker.onerror = function(e) {
    console.log(e.filename+&quot;ERROR on line&quot;+e.lineno+&quot;,msg:&quot;+e.message);
}
</code></pre><p>###<strong>【web worker的其他尝试】</strong><br>对于比较消耗时间的操作，我们可看到web worker能够发挥它的作用。比如：大量数据排序，精确到像素的canvas计算等。而我们又知道，jsonp加载数据时，动态创建script标签，加载和执行这些过程都是阻塞式的，而web worker正好可以异步加载，这会是更快的方式吗？带着这个疑问我做了下面的试验，分别用jsonp和worker的方式去加载文件，计算数据返回时延：</p>
<pre><code>function tryJsonp(){
    var d = (new Date()).valueOf();
    var jsonp=document.createElement(&quot;script&quot;);  
    jsonp.type=&quot;text/javascript&quot;;  
    jsonp.src=&quot;worker.js?_=&quot;+d;  
    document.getElementsByTagName(&quot;head&quot;)[0].appendChild(jsonp);
    jsonp.onload = jsonp.onreadystatechange = function(){  
           if(!this.readyState||this.readyState==&apos;loaded&apos;||this.readyState==&apos;complete&apos;){  
               console.log(&apos;jsonp: &apos;+ ((new Date()).valueOf() - d));
        }  
    }
}
function tryWorker(){
    var d = (new Date()).valueOf();
    var worker = new Worker(&quot;worker.js&quot;);
    worker.postMessage({&apos;cmd&apos;: &apos;start&apos;, &apos;msg&apos;: &apos;start&apos;});
    worker.onmessage = function (event) {
        console.log(&apos;web worker: &apos;+ ((new Date()).valueOf() - d));
    };
}
</code></pre><p>第一次加载是一份1k大小的文件，每个方法重复5次，返回结果为:<br><img src="/assets/blogImg/web_worker1.png" alt="1k文件重复5次"><br>第二次加载1800k大小的文件，返回结果为：<br><img src="/assets/blogImg/web_worker2.png" alt="1800k文件重复5次"><br>可以看到对于较小的数据，jsonp还是比web worker要快，这可能是实例化worker对象时带来的影响；而数据偏大时，web worker的加载将会更优，而且它可以异步加载。</p>
<p>THE END.</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;js是单线程的语言，由于此特性，我们在处理并发时需要用到一些技巧，如setTimeout()，setInterval()，调用XMLHttpRequest等。&lt;br&gt;但这里的并发只是非阻塞（参照John Resig的文章&lt;a href=&quot;http://ejohn.org/blog/how-javascript-timers-work/&quot;&gt;How JavaScript Timers Work&lt;/a&gt;），真正的多线程编程则需要HTML5的web worker。&lt;br&gt;
    
    </summary>
    
    
      <category term="html5" scheme="//Sujuei.me/tags/html5/"/>
    
      <category term="web" scheme="//Sujuei.me/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>兔子，胡萝卜与OAuth的故事</title>
    <link href="//Sujuei.me/2013/08/20/oauth-rabbit/"/>
    <id>//Sujuei.me/2013/08/20/oauth-rabbit/</id>
    <published>2013-08-20T04:55:00.000Z</published>
    <updated>2016-11-21T05:22:38.941Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/rabbit.jpg" alt="来搞一记Oauth吧"> </p>
<blockquote>
<p>那些简单的故事，就别用复杂的方式传诵</p>
</blockquote>
<p>##<strong>【让我来讲几个故事吧】</strong>     </p>
<p>从前，有只老兔子，在仓库里存了一万根胡萝卜，作为给小兔子的遗产。而后他就去周游世界了。小兔子有天想去把萝卜拿出来，却被仓库外的一只兔子拦住了。一问才知道，这是老兔子安排的仓库守卫。和所有故事中的守护者一样，他正直而古板，八字眉下面有着睡眠不足的熊猫眼，世人一般称他为兔门神。兔子想要拿到萝卜，就得说服兔门神呀，于是他走了上前…<br><a id="more"></a></p>
<p>##<strong>【兔子与OAuth1.0的故事】</strong></p>
<ol>
<li>兔子首先得证明自己是只兔子，不是狗熊也不是狼，于是他向兔门神出示了身份证</li>
<li>兔门神说：哦，你是只兔子。但你还得证明你是老兔子的兔崽子呀。兔子说我爸旅游去了，怎么证明呢？兔门神说，这样吧，我把你的身份证拍下来，发送给你爸，让他看下这是不是你。于是兔门神打开了微信……</li>
<li>正在休假的老兔子看了下照片，回复说证件照好难看毁三观啊，但勉强认得出这货就是我儿子</li>
<li>兔门神确认这信息后，说，你老爸还是认你这个儿子的</li>
<li>兔子问，那我可以去拿胡萝卜了没？</li>
<li>兔门神说，可以了，这样吧，我发你个通行证，以后拿这个来我就不用这么麻烦了。</li>
</ol>
<p>##<strong>【兔子与OAuth1.0a的故事】</strong></p>
<p>这种貌似天衣无缝的形式，却被一只坏兔子看出了破绽。他注意到一个细节，在最后的一步，兔门神都是习惯性的把通行证交给了面前的兔子,而不管这只兔子是不是当初的那只。于是，坏兔子趁兔门神正在和老兔子聊微信的时候，一个劲站在了兔子前面，最后兔门神居然把通行证塞给了他！这怎么可以？于是在第一步和第六步又有了修改。</p>
<ol>
<li>兔子出示身份证的同时，也出示了自己的私房照，说，门神大哥呀，后面你记得把通行证给照片上的帅哥！</li>
<li>……</li>
<li>……</li>
<li>……</li>
<li>……</li>
<li>兔门神看了下面前的兔子，私房照上的明显P过嘛但勉强认得出是本人，于是才交出了通行证</li>
</ol>
<p>##<strong>【兔子与Oauth2.0的故事】</strong></p>
<p>兔门神回家后，向他的老婆兔女神汇报了今天的工作，更安全的方案使他得意洋洋，没想到被兔女神骂了一顿。兔女神说，兔子证明自己还得带个身份证，你不知道在天朝办个身份证多麻烦吗？让小兔子跟老兔子去聊下微信就可以了干嘛要你插手？兔门神哑口无言，兔女神高贵冷艳的说我有四种方案，给你先说说最常用的一种吧。</p>
<ol>
<li>兔子一开始就跟他老爸聊微信了。当然他得明确告诉老爸，他需要打开哪个仓库（因为老兔子有很多儿子，每个儿子去拿萝卜的仓库不一样，兔子要指定一下具体是哪个，问他可不可以）</li>
<li>老兔子回复说：“just do IT”…</li>
<li>兔子然后去拿胡萝卜，首先被兔女神拦住了。女神告诉他，你要给我四样东西：老兔子的回复，你的私房照，身份证，还要给我一个密码。兔子愣愣的想了个密码，把这四样东西交了过去</li>
<li>兔女神把这四种东西混在一起，用魔法变出了两件法宝：一封情书和一撮猴子毛…然后她解释说：拿着我的情书去找我老公，他就让你进仓库了；但是这情书会过期，是出于安全考虑啦，过期后你得召唤我再写一封，召唤出我的步骤就是吹一下猴子毛，像孙悟空那样你就别在意这些细节好伐？</li>
<li>兔子拿着情书去找兔门神时，发现他由于被妻子分担了压力，明显睡眠好多了…</li>
</ol>
<p>##<strong>【演员表】</strong></p>
<p><strong>兔子</strong>-消费者，也就是第三方应用<br><strong>老兔子</strong>-用户，也就是我们，记住，我们永远是第三方的亲爹<br><strong>仓库</strong>-Oauth提供者，这里有我们保存的资料，比如说新浪微博，qq空间，人人…<br><strong>兔门神</strong>-在前两个故事中，由授权服务器和资源服务器共同扮演，在最后的故事中，只由资源服务器扮演<br><strong>兔女神</strong>-授权服务器，只管授权，不管取资源                   </p>
<p>##<strong>【重要道具】</strong></p>
<p><strong>身份证</strong>-签名，将一个http请求以及相应参数字符串化<br><strong>拍下的身份证照片</strong>-Request Token，服务器进行认证<br><strong>通行证</strong>-Access Token，获取资源的凭证<br><strong>私房照</strong>-重定向地址<br><strong>坏兔子</strong>(我把它当成道具而不是演员)-重定向地址劫持<br><strong>仓库的名称</strong>-appId,即对应具体哪个第三方<br><strong>just do it</strong>-Auth code，用户授权号<br><strong>第三个故事的身份证</strong>-client id 客户端帐号<br><strong>密码</strong>-client secret 客户端密码<br><strong>魔法</strong>-将client id，client secket，重定向地址，Auth code生成Access Token<br><strong>情书</strong>-Access Token，获取资源的凭证<br><strong>猴子毛</strong>-Refresh Token，用来在Access Token过期后将其刷新，刷新需带上client id和client secret                        </p>
<p>##<strong>【说书人说】</strong></p>
<p>Oauth2.0比起Oauth1.0，没有了第一步的签名，将服务器分开为授权服务器与资源服务器。这是最大的两个特征。开放平台必须得做到对第三方友好，才有利于接入。像Oauth1.0签名的操作，就难倒了许多第三方。也许你知道了Oauth2.0接入步骤简化了些，但也知道其内部实现要更复杂，抛去安全方面的考虑，我认为这是正确的方向。因为，Oauth2.0在某种意义上说，向第三方做到了——“把悲伤留给自己，你的美丽让你带走”。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/rabbit.jpg&quot; alt=&quot;来搞一记Oauth吧&quot;&gt; &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;那些简单的故事，就别用复杂的方式传诵&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;##&lt;strong&gt;【让我来讲几个故事吧】&lt;/strong&gt;     &lt;/p&gt;
&lt;p&gt;从前，有只老兔子，在仓库里存了一万根胡萝卜，作为给小兔子的遗产。而后他就去周游世界了。小兔子有天想去把萝卜拿出来，却被仓库外的一只兔子拦住了。一问才知道，这是老兔子安排的仓库守卫。和所有故事中的守护者一样，他正直而古板，八字眉下面有着睡眠不足的熊猫眼，世人一般称他为兔门神。兔子想要拿到萝卜，就得说服兔门神呀，于是他走了上前…&lt;br&gt;
    
    </summary>
    
    
      <category term="web" scheme="//Sujuei.me/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>谈谈OAuth1,OAuth2异同</title>
    <link href="//Sujuei.me/2013/08/11/brief-oauth/"/>
    <id>//Sujuei.me/2013/08/11/brief-oauth/</id>
    <published>2013-08-11T02:55:00.000Z</published>
    <updated>2016-11-21T05:22:38.921Z</updated>
    
    <content type="html"><![CDATA[<p>##<strong>一、写在前面</strong><br>在收集资料时，我查询和学习了许多介绍OAuth的文章，这些文章有好有坏，但大多是从个例出发。因此我想从官方文档出发，结合在stackoverflow上的一些讨论，一并整理一下。整理的内容分为OAuth1.0a和OAuth2两部分。</p>
<blockquote>
<p>OAuth 1.0a：One Leg -&gt;Two Leg -&gt; Three Legged<br>OAuth 2:Two Leg -&gt;Three Legged (附：Refresh Token的方式)</p>
</blockquote>
<p>这两种模式都是按箭头从左往右安全性递增，其实现也会相对复杂。关于官方的这种leg（腿？）的说法，在中文翻译中比较少有文章提及。下面分别来介绍OAuth的这5种授权流程。</p>
<a id="more"></a>
<p>##<strong>二、OAuth1.0a</strong><br><strong>2.1 OAuth 1.0a (One Leg)</strong></p>
<ol>
<li>应用给服务器发送一个签名请求，附带以下参数：           <ul>
<li>oauth_token Empty String             </li>
<li>oauth_consumer_key                  </li>
<li>oauth_timestamp                   </li>
<li>oauth_nonce                    </li>
<li>oauth_signature                  </li>
<li>oauth_signature_method              </li>
<li>oauth_version Optional                  </li>
</ul>
</li>
<li>服务验证并授予对资源的访问                 </li>
<li>应用程序利用请求的资源                </li>
</ol>
<p><strong>2.2 OAuth 1.0a (Two Legs)</strong></p>
<ol>
<li>应用发送一个签名请求，以获取 Request Token：                 <ul>
<li>oauth_consumer_key                          </li>
<li>oauth_timestamp                     </li>
<li>oauth_nonce                        </li>
<li>oauth_signature                  </li>
<li>oauth_signature_method                       </li>
<li>oauth_version Optional                      </li>
</ul>
</li>
<li>服务器返回Request Token：                   <ul>
<li>oauth_token                    </li>
<li>oauth_token_secret                  </li>
<li>Additional Parameters / Arguments                   </li>
</ul>
</li>
<li>发送签名请求，用Request Token换取Access Token                      <ul>
<li>oauth_token Request Token                    </li>
<li>oauth_consumer_key                   </li>
<li>oauth_nonce                 </li>
<li>oauth_signature                      </li>
<li>oauth_signature_method                    </li>
<li>oauth_version                           </li>
</ul>
</li>
<li>服务器返回Access Token和Token Secret    </li>
<li>应用通过Access Token和Token Secret利用请求的资源</li>
</ol>
<p><strong>2.3 OAuth 1.0a (Three Legged)</strong></p>
<ol>
<li>应用发送一个签名请求，以获取 Request Token：                <ul>
<li>oauth_consumer_key                       </li>
<li>oauth_timestamp                       </li>
<li>oauth_nonce                       </li>
<li>oauth_signature                       </li>
<li>oauth_signature_method                       </li>
<li>oauth_version Optional                       </li>
</ul>
</li>
<li>服务器返回Request Token：                       <ul>
<li>oauth_token                       </li>
<li>oauth_token_secret                       </li>
<li>oauth_callback_confirmed                       </li>
<li>… Additional Parameters / Arguments                       </li>
</ul>
</li>
<li>发送给用户授权的URL                       <ul>
<li>oauth_token                       </li>
</ul>
</li>
<li>提示用户进行授权                       </li>
<li>用户进行授权                       </li>
<li>授权结束后返回应用，附带上：                       <ul>
<li>oauth_token                       </li>
<li>oauth_verifier                       </li>
</ul>
</li>
<li>发送签名请求，用Request Token换取Access Token                       <ul>
<li>oauth_token Request Token                       </li>
<li>oauth_consumer_key                       </li>
<li>oauth_nonce                       </li>
<li>oauth_signature                       </li>
<li>oauth_signature_method                       </li>
<li>oauth_version                       </li>
<li>oauth_verifier                       </li>
</ul>
</li>
<li>服务器返回Access Token和Token Secret                       </li>
<li>应用通过Access Token和Token Secret利用请求的资源                       </li>
</ol>
<p>##<strong>三、OAuth2</strong>         </p>
<p><strong> 3.1 OAuth 2 (Two Legged)</strong></p>
<p>3.1.1 客户端凭据方式              </p>
<ol>
<li>应用发送请求到服务器：                   <ul>
<li>grant_type = client_credentials<br>如果没有使用Authorization（Authorization: Basic Base64(client_id:client_secret)） 的header，必须附带参数为：                   </li>
<li>client_id                   </li>
<li>client_secret                   </li>
</ul>
</li>
<li>服务器以Access Token回应                   <ul>
<li>access_token                   </li>
<li>expires_in                   </li>
<li>token_type                   </li>
</ul>
</li>
</ol>
<p>3.1.2 隐式授予方式               </p>
<ol>
<li>应用发送请求到服务器：                                                <ul>
<li>response_type = token                      </li>
<li>redirect_uri This is a server-side Redirection URI hosted by the provider or yourself.                      </li>
<li>scope                      </li>
<li>state Optional                      </li>
<li>client_id                      </li>
</ul>
</li>
<li>用户可根据需要授权。                      <ul>
<li>username                      </li>
<li>password                      </li>
</ul>
</li>
<li>服务器将响应包含access_token在内的redirect_uri                      </li>
<li>应用程序跳转至redirect_uri                      </li>
<li>redirect_uri将响应一段脚本或HTML片段。响应的脚本或HTML片段包含参数access_token，还有您可能需要的任何其他参数。                  </li>
</ol>
<p>3.1.3 资源所有者密码方式                  </p>
<ol>
<li>应用向资源所有者请求凭证                   <ul>
<li>username                   </li>
<li>password                   </li>
</ul>
</li>
<li>应用使用凭证，向服务器发送请求                   <ul>
<li>grant_type = password                   </li>
<li>username                   </li>
<li>password<br>url看起来会像这样：grant_type=password&amp;username=my_username&amp;password=my_password<br>如果你没有使用Authorization的header，必须附带上参数：                   </li>
<li>client_id                   </li>
<li>client_secret<br>url看起来会像是：<br>grant_type=password&amp;username=my_username&amp;password=my_password&amp;client_id=random_string&amp;client_secret=random_secret                   </li>
</ul>
</li>
<li>服务器返回Access Toke                   <ul>
<li>access_token                   </li>
<li>expires_in                   </li>
<li>token_type                   </li>
</ul>
</li>
</ol>
<p><strong> 3.2 OAuth 2 (Three Legged) </strong></p>
<ol>
<li>应用重定向用户到授权服务：                    <ul>
<li>client_id                    </li>
<li>redirect_uri                    </li>
<li>response_type                    </li>
<li>state Optional; Unique identifier to protect against CSRF                    </li>
<li>scope Optional; what data your application can access.<br>url看起来会像是：<br>oauth_service/login/oauth/authorize?client_id=3MVG9lKcPoNINVB&amp;redirect_uri=<a href="http://localhost/oauth/code_callback&amp;scope=user" target="_blank" rel="external">http://localhost/oauth/code_callback&amp;scope=user</a>                    </li>
</ul>
</li>
<li>用户登录服务器并确认授权给应用                    </li>
<li>服务器重定向用户到redirect_url ，附带参数：                    <ul>
<li>code                    </li>
<li>state                    </li>
</ul>
</li>
<li>应用拿到code，并换取Access Token                    <ul>
<li>client_id                    </li>
<li>client_secret                    </li>
<li>code                    </li>
<li>redirect_uri Optional;                    </li>
<li>grant_type = “authorization_code”                    </li>
</ul>
</li>
<li>如果的client_id和client_secret是有效的，服务器将调用一个回调redirect_url，包含ACCESS_TOKEN                    <ul>
<li>access_token                    </li>
<li>expires_in                    </li>
<li>refresh_token                    </li>
</ul>
</li>
<li>应用保存ACCESS_TOKEN，在随后的请求中使用。通常这个值被存储在session或或cookie，需要时作为授权请求的参数。   </li>
</ol>
<p><strong> 3.3 OAuth 2 (Refresh Token 刷新token) </strong></p>
<p>在OAuth2中，Token会有过期时间，我们必须去refresh_token，使用其他一些先前获得的参数，生成一个新的token。这是一个容易得多的流程。    </p>
<ol>
<li>创建刷新令牌请求                  <ul>
<li>grant_type = “refresh_token”                      </li>
<li>scope Optional; Cannot have any new scopes not previously defined.                     </li>
<li>refresh_token                     </li>
<li>client_id                     </li>
<li>client_secret                     </li>
</ul>
</li>
<li>服务验证和响应以下参数：                     <ul>
<li>access_token                     </li>
<li>issued_at                     </li>
</ul>
</li>
</ol>
<p>##<strong>四、stackoverflow上的一些问答</strong>         </p>
<p><strong>Q</strong>：OpenID和OAuth的区别是什么？<br><strong>A</strong>：OpenID是有关身份验证（即证明你是谁），OAuth有关授权（即授予访问权限），推荐博文：<a href="http://cakebaker.42dh.com/2008/04/01/openid-versus-oauth-from-the-users-perspective/" target="_blank" rel="external">从用户的角度来看OpenID和OAuth</a>                    </p>
<p><strong>Q</strong>：OAuth2与OAuth1不同的地方是？有人可以简单的解释的OAuth2和OAuth1之间的区别吗？ OAuth1现在已经过时，应实施的OAuth2？我没有看到许多实现的OAuth2，大多数仍在使用OAuth，这让我怀疑的OAuth2的准备使用。是吗？<br><strong>A</strong>：OAuth2能更好地支持不是基于浏览器的应用。对于不是基于浏览器的应用程序，这是对OAuth的主要挑战。例如，在OAuth1.0，桌面应用或手机应用必须引导用户打开浏览器所需的服务，与服务进行身份验证，并复制令牌从服务返回给应用程序。这里的主要批评是针对用户体验。使用OAuth2.0，可以用新的方式为用户的应用程序获得授权。<br>OAuth2.0不再需要客户端应用程序拥有密钥。这让人回想起老的Twitter认证的API，它并不需要应用得到HMAC哈希令牌和请求字符串。使用OAuth2.0，应用程序可以通过HTTPS获得令牌。<br>OAuth2.0的签名流程简单得多。没有更多的特殊解析，排序，或编码。<br>OAuth2.0的访问令牌是“短命”的。通常情况下，OAuth1.0的访问令牌可以存储一年或一年以上（Twitter从来没有让他们到期）。 OAuth的2.0有刷新令牌的概念。虽然我不能完全肯定这是什么意思，我的猜测是，您的访问令牌可以是短暂存储的（即基于会话），而你可以刷新令牌。你使用刷新令牌获取新的访问令牌，而不是让用户重新授权您的应用程序。<br>最后，OAuth2.0使得负责处理的OAuth请求的服务器和处理用户的授权服务器之间的角色有一个干净的分离。更多信息，在上述的文章中详述。</p>
<p><strong>Q</strong>：OAuth2服务器群怎么使用state来防范CSRF？<br><strong>A</strong>：state只是一个随机的字符串，可以做这样的事情：$state = md5(uniqid(rand(), TRUE));在session中记录satate，以便稍后你能做验证。一些额外的资料：<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-threatmodel-00" target="_blank" rel="external">OAuth2威胁文件模型</a>，<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-26#section-10.12" target="_blank" rel="external">特别CSRF保护</a>                                    </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;##&lt;strong&gt;一、写在前面&lt;/strong&gt;&lt;br&gt;在收集资料时，我查询和学习了许多介绍OAuth的文章，这些文章有好有坏，但大多是从个例出发。因此我想从官方文档出发，结合在stackoverflow上的一些讨论，一并整理一下。整理的内容分为OAuth1.0a和OAuth2两部分。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;OAuth 1.0a：One Leg -&amp;gt;Two Leg -&amp;gt; Three Legged&lt;br&gt;OAuth 2:Two Leg -&amp;gt;Three Legged (附：Refresh Token的方式)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这两种模式都是按箭头从左往右安全性递增，其实现也会相对复杂。关于官方的这种leg（腿？）的说法，在中文翻译中比较少有文章提及。下面分别来介绍OAuth的这5种授权流程。&lt;/p&gt;
    
    </summary>
    
    
      <category term="web" scheme="//Sujuei.me/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>网易“聚合阅读”布局的实现</title>
    <link href="//Sujuei.me/2013/05/03/my-news-reader-box/"/>
    <id>//Sujuei.me/2013/05/03/my-news-reader-box/</id>
    <published>2013-05-03T02:55:00.000Z</published>
    <updated>2016-11-21T05:22:38.940Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/myReader0.jpg" alt="聚合阅读">   </p>
<p>网易<a href="http://news.tag.163.com/" target="_blank" rel="external">聚合阅读</a>的出现的确让人惊艳了一下。流畅的交互,使碎片化的新闻资讯像报纸一样摊在眼前,这是信息大爆炸的时代产物。不管你能不能接受这种新阅读形式，事实上，每天越来越多的新闻层出不穷，还没被人看到就已成为了“旧闻”。回归报纸的版面设计，堆叠新闻模块，让用户告别一条接一条整齐的新闻链接，而是在一个版面上提供更多的信息，不失为一种尝试。</p>
<p>而抛去产品的层面，从前端方向来看，“聚合阅读”也有许多值得学习的地方。这几天研究了一下源码，谈谈它随机布局的实现，以及一些优化的措施。</p>
<p>##<strong>demo</strong></p>
<p>点击按钮可以改变布局：<br><a id="more"></a></p>
<iframe id="demoIframe" src="/assets/demo/my_news_reader/index.html" width="600" height="420" scrolling="no"></iframe>

<p>##<strong>一.怎样定义格子对象</strong></p>
<p>每个格子对象，都至少应该有这5个属性：   </p>
<ul>
<li>left：距离左边界的位置         </li>
<li>top：距离上边界的位置           </li>
<li>width：格子宽度             </li>
<li>height：格子高度            </li>
<li>background：格子颜色        </li>
</ul>
<p>逐个去定义对象无疑是愚蠢的：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Block</span>(<span class="params">o</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span>&#123;</div><div class="line">		<span class="attr">left</span>: o.left,</div><div class="line">		<span class="attr">top</span>: o.top,</div><div class="line">		<span class="attr">width</span>: o.width,</div><div class="line">		<span class="attr">height</span>: o.height,</div><div class="line">		<span class="attr">bg</span>: o.bg</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> block1 = <span class="keyword">new</span> Block(&#123;</div><div class="line">	<span class="attr">left</span>: <span class="number">0</span>,</div><div class="line">	<span class="attr">top</span>: <span class="number">0</span>,</div><div class="line">	<span class="attr">width</span>: <span class="number">50</span>,</div><div class="line">	<span class="attr">height</span>: <span class="number">50</span>,</div><div class="line">	<span class="attr">bg</span>: <span class="string">"#3f3"</span></div><div class="line">&#125;);</div><div class="line"><span class="keyword">var</span> block2 = …</div><div class="line">…</div><div class="line"><span class="keyword">var</span> block37 = …</div></pre></td></tr></table></figure></p>
<p>这样不仅不利于后期维护，而且构造格子的嵌套关系也相对麻烦。</p>
<p>网易的做法是使用“交替切割”的方式来做：         </p>
<ol>
<li>将大块先切成两列。         </li>
<li>左列（红色部分）再切成三行，右列（褐，黄，蓝部分）也切成三行。</li>
<li>对形成的6个小块，再进行列的切割</li>
</ol>
<p>整个做法就是“列-行-列-行-……”这样的交替切割。所以它的对象是这样设置的,其中random属性可以约定同级的cols或rows是否可以随机变换位置，width和height的值是规定一个父级块的分割比例。其设置的形式例如（例子与demo的设定无关）：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.tagConfig.pageLayout = &#123;</div><div class="line">	<span class="attr">top</span>: <span class="number">0</span>,</div><div class="line">	<span class="attr">left</span>: <span class="number">0</span>,</div><div class="line">	<span class="attr">width</span>: <span class="number">100</span>,</div><div class="line">	<span class="attr">height</span>: <span class="number">100</span>,</div><div class="line">	<span class="attr">random</span>: !<span class="number">1</span>,</div><div class="line">	<span class="attr">cols</span>: [&#123;</div><div class="line">		<span class="attr">width</span>: <span class="number">30</span>,</div><div class="line">		<span class="attr">rows</span>: [&#123;</div><div class="line">			<span class="attr">height</span>: <span class="number">40</span>,</div><div class="line">			<span class="attr">cols</span>: [&#123;</div><div class="line">				<span class="attr">width</span>: <span class="number">30</span>,</div><div class="line">				<span class="attr">rows</span>:[&#123;</div><div class="line">					<span class="attr">height</span>:<span class="number">100</span></div><div class="line">				&#125;]</div><div class="line">			&#125;,&#123;</div><div class="line">				<span class="attr">width</span>: <span class="number">70</span>,</div><div class="line">				<span class="attr">rows</span>:[&#123;</div><div class="line">					<span class="attr">height</span>:<span class="number">100</span></div><div class="line">				&#125;]</div><div class="line">			&#125;]</div><div class="line">		&#125;,</div><div class="line">		&#123;</div><div class="line">			<span class="attr">height</span>: <span class="number">30</span></div><div class="line">		&#125;,&#123;</div><div class="line">			<span class="attr">height</span>: <span class="number">30</span></div><div class="line">		&#125;]</div><div class="line">	&#125;,&#123;</div><div class="line">		<span class="attr">width</span>: <span class="number">70</span>,</div><div class="line">		<span class="attr">rows</span>:[&#123;</div><div class="line">			<span class="attr">height</span>:<span class="number">100</span></div><div class="line">		&#125;]</div><div class="line">	&#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##<strong>二.递归调用切割函数</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_getGrids</span>(<span class="params">tag</span>) </span>&#123;</div><div class="line">	<span class="comment">/*domArr是拥有left,top,width,height,bg等属性的所有dom数组，_getGrids的最终目的就是生成这个数组*/</span></div><div class="line">	<span class="keyword">var</span> domArr = [],</div><div class="line">	_cutGrid(tag.pageLayout,</div><div class="line">		<span class="function"><span class="keyword">function</span>(<span class="params">tag</span>) </span>&#123;</div><div class="line">			<span class="keyword">if</span> (tag.rows || tag.cols) &#123;</div><div class="line">				<span class="comment">/*假如子级存在rows或者cols，则递归切割*/</span></div><div class="line">				_cutGrid(tag, <span class="built_in">arguments</span>.callee);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> &#123;</div><div class="line">				<span class="comment">/*子级不存在rows或者cols，不再进行切割，构造domArr*/</span></div><div class="line">				…</div><div class="line">				domArr.push(xxx)</div><div class="line">				…</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	);</div><div class="line">	<span class="keyword">return</span> domArr;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##<strong>三.切割函数</strong></p>
<p>切割函数挺有意思的，下次想再用一篇文章来详细写一下，在这里仅贴出参考的源码。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*对象复制函数*/</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_shadowClone</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> t = &#123;&#125;;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> n <span class="keyword">in</span> e) e.hasOwnProperty(n) &amp;&amp; (t[n] = e[n]);</div><div class="line">	<span class="keyword">return</span> t;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/*判断子块随机布局与否*/</span></div><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">ranOrNot</span>(<span class="params">e, t</span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> n = [];</div><div class="line">		<span class="keyword">typeof</span> t == <span class="string">"undefined"</span> &amp;&amp; (t = e, e = <span class="number">0</span>);</div><div class="line">		<span class="keyword">for</span> (; e &lt; t; e++) n.push(e);</div><div class="line">		<span class="keyword">return</span> n</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*随机布局*/</span></div><div class="line">	<span class="built_in">Array</span>.prototype.randomEach = <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="number">3</span>);</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span> t != <span class="string">"function"</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>;</div><div class="line">		<span class="keyword">var</span> n = <span class="keyword">this</span>.length,</div><div class="line">		r = ranOrNot(n);</div><div class="line">		<span class="keyword">while</span> (n) &#123;</div><div class="line">			<span class="keyword">var</span> i = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * n--);</div><div class="line">			<span class="keyword">if</span> (t(<span class="keyword">this</span>[r[i]]) === !<span class="number">1</span>) <span class="keyword">break</span>;</div><div class="line">			r[i] = r[n]</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	<span class="comment">/*常规布局*/</span></div><div class="line">	<span class="built_in">Array</span>.prototype.forEach || (<span class="built_in">Array</span>.prototype.forEach = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> t = <span class="keyword">this</span>.length;</div><div class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span> e != <span class="string">"function"</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>;</div><div class="line">		<span class="keyword">var</span> n = <span class="built_in">arguments</span>[<span class="number">1</span>];</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">var</span> r = <span class="number">0</span>; r &lt; t; r++) r <span class="keyword">in</span> <span class="keyword">this</span> &amp;&amp; e.call(n, <span class="keyword">this</span>[r], r, <span class="keyword">this</span>)</div><div class="line">	&#125;)</div><div class="line">&#125; )();</div><div class="line"></div><div class="line"><span class="comment">/*切割函数*/</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_cutGrid</span>(<span class="params">tag, funcJudge</span>) </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">a</span>) </span>&#123;</div><div class="line">		<span class="function"><span class="keyword">function</span> <span class="title">h</span>(<span class="params">cutLength</span>) </span>&#123;</div><div class="line">			<span class="comment">/*复制子块对象并计算出子块top,left*/</span></div><div class="line">			<span class="keyword">var</span> u, a = _shadowClone(cutLength);</div><div class="line">			c++,</div><div class="line">			u = c === l ? tag[cutType2.measure] - s: <span class="built_in">Math</span>.floor(cutLength[cutType2.measure] * tag[cutType2.measure] / <span class="number">100</span>),</div><div class="line">			a[cutType1.offset] = i + tag[cutType1.offset],</div><div class="line">			a[cutType2.offset] = s + tag[cutType2.offset],</div><div class="line">			a[cutType1.measure] = f,</div><div class="line">			a[cutType2.measure] = u,</div><div class="line">			a.colorPattern = tag.colorPattern,</div><div class="line">			<span class="comment">/*判断小块是否还需要分割*/</span></div><div class="line">			funcJudge(a),</div><div class="line">			s += u</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">var</span> f, l = a[cutType2.name].length,</div><div class="line">		c = <span class="number">0</span>;</div><div class="line">		u++,</div><div class="line">		f = u === cutLength ? tag[cutType1.measure] - i: <span class="built_in">Math</span>.floor(a[cutType1.measure] * tag[cutType1.measure] / <span class="number">100</span>),</div><div class="line">		a.random === !<span class="number">1</span> ? a[cutType2.name].forEach(h) : a[cutType2.name].randomEach(h),</div><div class="line">		s = <span class="number">0</span>,</div><div class="line">		i += f</div><div class="line">	&#125;</div><div class="line">	<span class="comment">/*根据大块是否有rows属性，定义两种切割方式*/</span></div><div class="line">	<span class="keyword">var</span> cutType1, cutType2;</div><div class="line">	tag.rows ? (cutType1 = &#123;</div><div class="line">		<span class="attr">name</span>: <span class="string">"rows"</span>,</div><div class="line">		<span class="attr">measure</span>: <span class="string">"height"</span>,</div><div class="line">		<span class="attr">offset</span>: <span class="string">"top"</span></div><div class="line">	&#125;,</div><div class="line">	cutType2 = &#123;</div><div class="line">		<span class="attr">name</span>: <span class="string">"cols"</span>,</div><div class="line">		<span class="attr">measure</span>: <span class="string">"width"</span>,</div><div class="line">		<span class="attr">offset</span>: <span class="string">"left"</span></div><div class="line">	&#125;) : (cutType1 = &#123;</div><div class="line">		<span class="attr">name</span>: <span class="string">"cols"</span>,</div><div class="line">		<span class="attr">measure</span>: <span class="string">"width"</span>,</div><div class="line">		<span class="attr">offset</span>: <span class="string">"left"</span></div><div class="line">	&#125;,</div><div class="line">	cutType2 = &#123;</div><div class="line">		<span class="attr">name</span>: <span class="string">"rows"</span>,</div><div class="line">		<span class="attr">measure</span>: <span class="string">"height"</span>,</div><div class="line">		<span class="attr">offset</span>: <span class="string">"top"</span></div><div class="line">	&#125;);</div><div class="line">	<span class="keyword">var</span> i = <span class="number">0</span>,</div><div class="line">	s = <span class="number">0</span>,</div><div class="line">	cutLength = tag[cutType1.name].length,</div><div class="line">	u = <span class="number">0</span>;</div><div class="line">	<span class="comment">/*是否随机布局*/</span></div><div class="line">	tag.random === !<span class="number">1</span> ? tag[cutType1.name].forEach(a) : tag[cutType1.name].randomEach(a)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##<strong>四.最后</strong><br>完成到这一步，我已不记得声明对象时出了多少次错误。各种尖括号，方括号，逗号和分号翩翩起舞时，你一定跟我一样很想念coffee的语法糖…</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/myReader0.jpg&quot; alt=&quot;聚合阅读&quot;&gt;   &lt;/p&gt;
&lt;p&gt;网易&lt;a href=&quot;http://news.tag.163.com/&quot;&gt;聚合阅读&lt;/a&gt;的出现的确让人惊艳了一下。流畅的交互,使碎片化的新闻资讯像报纸一样摊在眼前,这是信息大爆炸的时代产物。不管你能不能接受这种新阅读形式，事实上，每天越来越多的新闻层出不穷，还没被人看到就已成为了“旧闻”。回归报纸的版面设计，堆叠新闻模块，让用户告别一条接一条整齐的新闻链接，而是在一个版面上提供更多的信息，不失为一种尝试。&lt;/p&gt;
&lt;p&gt;而抛去产品的层面，从前端方向来看，“聚合阅读”也有许多值得学习的地方。这几天研究了一下源码，谈谈它随机布局的实现，以及一些优化的措施。&lt;/p&gt;
&lt;p&gt;##&lt;strong&gt;demo&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;点击按钮可以改变布局：&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//Sujuei.me/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>毕业衫的设计初稿以及设计这件小事</title>
    <link href="//Sujuei.me/2013/04/15/graduation-shirt-design/"/>
    <id>//Sujuei.me/2013/04/15/graduation-shirt-design/</id>
    <published>2013-04-15T02:36:00.000Z</published>
    <updated>2016-11-21T05:22:38.927Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/bys0.jpg" alt="乔治·伯恩斯，美国著名喜剧演员，八十高龄时夺得了奥斯卡奖">  </p>
<blockquote>
<p>“宁愿失败地做你爱做的事情，也不要成功地做你恨做的事情。” （I honestly think it is better to be a failure at something you love than to be a success at something you hate.） —— George Burns</p>
</blockquote>
<p>有那么一段时间，我很讨厌去做设计。           </p>
<p>厌倦了那种明明没有灵感，但第二天又得交稿的焦急。幸好有音乐，书，游戏和电影，试图说服自己，可以在deadline之前从中寻找到灵感。一幅一幅的参考图片从眼前走马而过，哒哒哒的鼠标点击声不绝于耳，时间越晚，我越认定这事情的疯狂和危险。我希望有那么一天，有人能直接把设计图递到我面前，而我将只着手编码的工作。</p>
<p>直到实习过后，我成为了一名前端。我开始怀念设计了。<br><a id="more"></a><br>事实并不像想象那样的完美。当有人做好了设计，这意味着无论你觉得设计好坏，你都得去接受，去遵从设计的样式。这就好比强迫自己吃一道不一定喜欢的菜，也许好吃，也许恶心，但你还是得吃下去，冷暖自知。抛弃枕头的励志书，忘掉那个万能的“别人家的孩子”，不去考虑如何能成为百万富翁，而是成为自己喜欢的自己，吃到自己钓的鱼，唱自己写的歌，创造自己设计的东西，原来这都是些多么幸福的事情！</p>
<p>实习的时候有次在海边，Frank问我回校后干点什么，我说，我一定要设计学院09级的毕业衫。是的，失败又怎样呢，不专业又怎样呢，这是我爱做的事情。也许，可以说是小小的梦想，或者说是“小小的蓄谋已久的”梦想。</p>
<p><img src="/assets/blogImg/bys1.jpg" alt="毕业衫方案1"><br><img src="/assets/blogImg/bys2.jpg" alt="毕业衫方案2"><br><img src="/assets/blogImg/bys3.jpg" alt="毕业衫方案3"> </p>
<p>（设计的那3天时间比较赶，只能完成了初稿。细心可以发现，第三个方案有很多细节处理不妥，另外背面的设计也没花过多时间去思考。一定督促自己去完善~）</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/bys0.jpg&quot; alt=&quot;乔治·伯恩斯，美国著名喜剧演员，八十高龄时夺得了奥斯卡奖&quot;&gt;  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;“宁愿失败地做你爱做的事情，也不要成功地做你恨做的事情。” （I honestly think it is better to be a failure at something you love than to be a success at something you hate.） —— George Burns&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;有那么一段时间，我很讨厌去做设计。           &lt;/p&gt;
&lt;p&gt;厌倦了那种明明没有灵感，但第二天又得交稿的焦急。幸好有音乐，书，游戏和电影，试图说服自己，可以在deadline之前从中寻找到灵感。一幅一幅的参考图片从眼前走马而过，哒哒哒的鼠标点击声不绝于耳，时间越晚，我越认定这事情的疯狂和危险。我希望有那么一天，有人能直接把设计图递到我面前，而我将只着手编码的工作。&lt;/p&gt;
&lt;p&gt;直到实习过后，我成为了一名前端。我开始怀念设计了。&lt;br&gt;
    
    </summary>
    
    
      <category term="设计" scheme="//Sujuei.me/tags/%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>模式应用小分享——中介者模式(mediator)</title>
    <link href="//Sujuei.me/2013/01/02/mediator-model/"/>
    <id>//Sujuei.me/2013/01/02/mediator-model/</id>
    <published>2013-01-02T04:36:00.000Z</published>
    <updated>2016-11-21T05:22:38.938Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/assets/blogImg/mediator1.jpg" alt="实况足球">   </p>
<blockquote>
<p>你需要一种设计模式，一定是哪里出问题了。这问题是指语言天生缺陷，不得不去寻找一种通用的解决方案。</p>
</blockquote>
<p>程序设计最后的终点，就是要找到一种解决方案来解决问题。这句话正确无疑。但我又想起有个冷笑话，A对B说：我教你怎么去赢这盘象棋，B问怎样，A回答说：吃掉对方的“帅”就赢了啊。略去中间的过程，直接描述到结果，这其实是毫无意义的。而设计模式，又恰恰关乎中间解决问题的过程。<br><a id="more"></a><br>现在关于模式的文章与书籍层出不穷，我自己也在看。但当我将理论回归应用的时候，一下子就懵了。这么多的模式，就像是一张又一张的棋谱教学，它告诉你要这么那么做，但你很少知道如何对症下药。也许到最后你东拼西凑总可以把“帅”吃掉，但遇到一个问题，如何选择下一步的模式见招拆招，已达到最有效率的胜利呢？</p>
<p>因此我想写一些模式在应用方面的小分享。</p>
<p>##<strong>中介者，你想到了什么？</strong><br>我们可以从实况足球谈起。一场足球比赛，进球加分，犯规处罚，控制时间，这些事件都由一个人来处决，我们叫他裁判，其实他就是比赛的中介者。裁判童鞋，代表了一种<strong>“控制集中化”</strong>的理念，这就是中介者模式的关键。试想一下，我们平时打球一般没有裁判，比分多少，是否犯规等都是由运动员我们自己来记录的，而我们往往都会有记错比分或者犯规纠纷的经验吧。这反应到程序上，就可以说是交互的复杂性带来的混乱。因此，我们在正规的比赛中必须要有裁判，运动员才可以把全部精力放到比赛上面去。于是中介者的引入，把运动员自己的复杂性变成了中介者的复杂性。</p>
<p>再深入一点，为什么有了裁判后，运动员的精力可以更集中呢？原因很简单，我们不需要记对方的分数了，犯规了也用不着自己去跟对方辩论。也就是说，两个队伍之间完全不用有比赛信息的直接交流了，取而代之的是把自己的信息转交给了裁判，让裁判去衡量两个队伍的信息，再进行加分，去判定是否犯规。这时我们可以说，这两个队伍对象解耦了，队伍对象之间的解耦，在客户端程序设计上的效果是很显著的，你很容易再引入一个队伍对象进行管理。试想一下如果有一场奇怪的球赛是有三个，四个队伍一起进行的，有了裁判这个中介者，运动员还是可以集中精力去比赛，否则他们就要去再多记比分了。</p>
<p>##<strong>一个例子</strong></p>
<p><iframe id="demoIframe" src="/assets/demo/mediator/demo.html" width="500" height="314" scrolling="no"></iframe><br>或者点这里弹出看<a href="/assets/demo/mediator/demo.html">demo</a><br>三国无双游戏中，有个经典的桥段，大家称为“拼刀”。当两个武将触发拼刀时，武将用武器相互抵着，玩家需要疯狂的按攻击键，一定时间内，谁按的次数多，谁就能赢得拼刀的胜利。其实这就是一个中介者模式的好例子。</p>
<p>其实不止是像这种“比赛”，想想像电力公司，将各家的电力进行集中管理，像给大家批阅试卷，给出成绩的老师，像一下子可以灭所有灯的寝室楼阿姨，像中国人民代表大会…额好吧，总之就是这么回事。</p>
<p>##<strong>demo代码解析 coffeescript实现（50行）</strong></p>
<p>首先我们设定<code>Player</code>对象，它有points和name属性，同时有一个prototype的属性play，使自己的分数加以，并将这信息通知中介者mediator：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="title">Player</span> = <span class="params">(name)</span>-&gt;</span></div><div class="line">	@points = <span class="number">0</span></div><div class="line">	@name = name</div><div class="line"></div><div class="line">Player::play = <span class="function">-&gt;</span></div><div class="line">	@points++</div><div class="line">	mediator.played()</div></pre></td></tr></table></figure></p>
<p>然后我们设定<code>scoreboard</code>对象，这是一个得分板，在MVC模式当中，充当了V(view)，视图。它的使命就是update，将传递给它的数据score展示出来。因为裁判是mediator，它判定队伍得分后(得到score)，他必须通知电视台(对应scoreboard)，让他们把分数展示出来：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">scoreboard = </div><div class="line">	element:</div><div class="line">		<span class="built_in">document</span>.getElementById <span class="string">"results"</span></div><div class="line">	update:<span class="function"><span class="params">(score)</span>-&gt;</span></div><div class="line">		msg = <span class="string">''</span></div><div class="line">		<span class="keyword">for</span> key,value <span class="keyword">of</span> score </div><div class="line">			<span class="keyword">if</span> score.hasOwnProperty key</div><div class="line">				msg = msg+<span class="string">"&lt;span&gt;&lt;strong&gt;<span class="subst">#&#123;key&#125;</span>&lt;/strong&gt;:<span class="subst">#&#123;value&#125;</span>&lt;/span&gt;"</span></div><div class="line">		@element.innerHTML = msg</div><div class="line">		diff = score.Home - score.Guest</div><div class="line">		<span class="keyword">if</span> diff &gt; <span class="number">15</span> </div><div class="line">			alert <span class="string">"Home Win!"</span></div><div class="line">			location.reload();</div><div class="line">		<span class="keyword">else</span> <span class="keyword">if</span> diff &lt;<span class="number">-15</span></div><div class="line">			alert <span class="string">"Guest Win!"</span></div><div class="line">			location.reload();</div><div class="line">		<span class="keyword">else</span></div><div class="line">			<span class="built_in">document</span>.getElementById(<span class="string">'barGuest'</span>).style.width = <span class="number">150</span> + (diff*<span class="number">10</span>) + <span class="string">'px'</span></div></pre></td></tr></table></figure></p>
<p>最后的片段就是中介者，<code>mediator</code>。它首先要决定开始比赛，也就是setup，新建了一个名称为Home，一个名称为Guest的Player model。当两个player得分时，mediator执行played，收集两方的分数，构造成score对象，并将这score对象交由scoreboard展示。keypress则是用于判断怎样才算得分：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">mediator = </div><div class="line">	players:&#123;&#125;</div><div class="line">	setup:<span class="function">-&gt;</span></div><div class="line">		players = @players</div><div class="line">		players.home = <span class="keyword">new</span> Player <span class="string">'Home'</span></div><div class="line">		players.guest = <span class="keyword">new</span> Player <span class="string">'Guest'</span></div><div class="line">	played:<span class="function">-&gt;</span></div><div class="line">		players = @players</div><div class="line">		score = </div><div class="line">			Home: players.home.points</div><div class="line">			Guest:players.guest.points</div><div class="line">		scoreboard.update score</div><div class="line">	keypress:<span class="function"><span class="params">(e)</span>-&gt;</span></div><div class="line">		e = e|| <span class="built_in">window</span>.event</div><div class="line">		keycode = e.which</div><div class="line">		<span class="keyword">if</span> keycode <span class="keyword">is</span> <span class="number">102</span></div><div class="line">			mediator.players.home.play()</div><div class="line">			<span class="keyword">return</span></div><div class="line">		<span class="keyword">if</span> keycode <span class="keyword">is</span> <span class="number">106</span></div><div class="line">			mediator.players.guest.play()</div><div class="line">			<span class="keyword">return</span></div></pre></td></tr></table></figure></p>
<p>最后执行，运行程序：<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mediator.setup()</div><div class="line"><span class="built_in">window</span>.onkeypress = mediator.keypress</div></pre></td></tr></table></figure></p>
<p>##<strong>小分享心得</strong><br>中介者模式将控制集中化，colleague对象之间解耦，不必维护各自之间的网状通信，但mediator承受了所有colleague提供过来的信息，肯定会相对复杂。如何优化mediator也会成为一个课题。中介者模式有点像一对多的模型，一个mediator对应多个colleague，而如果现实模型是多对多的，中介者模型视复杂度来说不一定适合。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;/assets/blogImg/mediator1.jpg&quot; alt=&quot;实况足球&quot;&gt;   &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;你需要一种设计模式，一定是哪里出问题了。这问题是指语言天生缺陷，不得不去寻找一种通用的解决方案。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;程序设计最后的终点，就是要找到一种解决方案来解决问题。这句话正确无疑。但我又想起有个冷笑话，A对B说：我教你怎么去赢这盘象棋，B问怎样，A回答说：吃掉对方的“帅”就赢了啊。略去中间的过程，直接描述到结果，这其实是毫无意义的。而设计模式，又恰恰关乎中间解决问题的过程。&lt;br&gt;
    
    </summary>
    
    
      <category term="coffeescript" scheme="//Sujuei.me/tags/coffeescript/"/>
    
      <category term="模式" scheme="//Sujuei.me/tags/%E6%A8%A1%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>当我想用css3实现一个动作类库</title>
    <link href="//Sujuei.me/2012/12/31/css3-animater/"/>
    <id>//Sujuei.me/2012/12/31/css3-animater/</id>
    <published>2012-12-30T16:02:00.000Z</published>
    <updated>2016-11-21T05:22:38.923Z</updated>
    
    <content type="html"><![CDATA[<p>当我如是想的时候，事实上我已想了很久。后来被各种纠结的差事冲乱了生活和心绪，并且心里认为这是个妥当无比的借口。找到了借口后一拖再拖，果然认识到deadline才是第一生产力的真理。最近，却是被朋友的一句话逼急了，他跟我说：我们的业务用到了css4的新属性！</p>
<p>这句话的意思，大体等同于说，我买到了一个iphone6，亲你怎么看？<br><a id="more"></a><br>它在我脑中纷乱起舞，那是plans vs zombies中一大波僵尸正在逼近的场景。是的，再不行动，就要被技术的狂潮给淹没了！日前，就我的浅薄见闻，当html5越来越多的功能被应用到业务主功能上，诸如本地存储，拖拽优化，postMessage通信…css3却是另一番光景。一方面，一个个绚丽效果的css3-demo在网上被围观与叫好，大家却又在为浏览器兼容性和差异性这座大山望而却步。css3技术在大家眼中更偏向于一种优化的体验，等于说，你不敢用它来实现网站的key point，即使是一个圆角，不问技术细节的产品经理也会想使用图片来代替的。</p>
<p>因此，缘由可以归结为：我忍够了。要玩，就玩个大的。</p>
<p>其实虽然我想了很久，但这个“想”，更偏向于单纯的幻想，而不是思考。暑假的时候，在腾讯大讲堂看到有哥们分享css3与js的动画效率比较的演示，就萌生了这个想法。现在，在正式尝试编写类库之前，我想先写2~3个实验demo，来看看技术的复杂度以及一些可以避免的暗礁，并做好一些记录。当然这些demo必须得使用最新的chrome，firefox，opera以及ie8，9才能正常运行。</p>
<p>##<strong>第一个实验：人物sprite图动画实现，按键与位移的衔接</strong><br>请按键盘方向键控制人物运动：</p>
<iframe id="demoIframe" src="/assets/demo/pre_css3_demo/demo.html" width="641" height="483" scrolling="no"></iframe>

<p>##<strong>最深的体会</strong><br><strong>我的js代码需要怎样“辅助”css3？</strong><br>按照我的理解，如果是说一个dom元素的“动作”的话，完全可以用纯css3来实现，而且你可以将dom的动作串连起来。<br>例如：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> q-down &#123;</div><div class="line">     0%&#123;</div><div class="line">          <span class="attribute">-webkit-transform</span>:<span class="built_in">rotate</span>(0deg);</div><div class="line">          <span class="attribute">top</span>:<span class="number">10px</span>;</div><div class="line">     &#125;</div><div class="line">     33%&#123;</div><div class="line">          <span class="attribute">-webkit-transform</span>: <span class="built_in">scale</span>(1.5);</div><div class="line">          <span class="attribute">top</span>:<span class="number">147px</span>;</div><div class="line">     &#125;</div><div class="line">     66%&#123;</div><div class="line">          <span class="attribute">top</span>:<span class="number">10px</span>;</div><div class="line">          <span class="attribute">-webkit-transform</span>: <span class="built_in">translate</span>(50px,50px);</div><div class="line">     &#125;</div><div class="line">    100% &#123;</div><div class="line">         <span class="attribute">top</span>:<span class="number">147px</span>;</div><div class="line">         <span class="attribute">-webkit-transform</span>:<span class="built_in">rotate</span>(45deg);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.box</span> &#123;</div><div class="line">    <span class="attribute">-webkit-animation</span>:q-down  ease;</div><div class="line">    <span class="attribute">-webkit-animation-duration</span>: <span class="number">2s</span>;</div><div class="line">    <span class="attribute">-webkit-animation-timing-function</span>: linear;</div><div class="line">    <span class="attribute">-webkit-transform</span>:<span class="built_in">rotate</span>(45deg);</div><div class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</div><div class="line">    <span class="attribute">background</span>: red;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">147px</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">100px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>dom元素会在0%，33%，66%，100%这些时间点上做出相应的效果响应。<br><strong>这样的动作序列还会有什么问题吗？</strong><br>在demo当中，我设置了按一下“左”键，人物向左偏移一格，按一下“下”键，人物下移一格，于是我就遇到了这样的两种情况：<br>    1、用户按下“下”，人物向下偏移动作完成后，他仍不放手，此时同时按了“左”<br>    我认为此时用户在使用“双键”，这时人物会再向左下方向都偏移一格。<br>    2、用户“几乎”同时按下“下”和“左”，由于js每次只能检测单键的keycode<br>    程序会判断用户是先按下了某个键，再使用了双键。<br>    而用户之所以“几乎”同时按下，本是希望只执行“双键”的。</p>
<p><img src="/assets/blogImg/css3_anm.jpg" alt="两种情况"><br>1与2的区别，其实就是双键产生时，两个按键的时间间隔的区别。时间间隔长，用户是需要1这种效果的，而时间间隔短，用户就是想只执行“双键”。但程序是固定的，无论时间间隔有多短，在它看来就是有先后，因此程序认为2和1是一样的。我在demo里，就用了时间戳的方式，而这种方式，其实是“投机取巧”的一种方式。</p>
<p>回到上面那个问题来，这样的纯css3动作序列有什么问题？时间的问题更深入一点我可以得到结论：<br>    那就是无法侦听一个css3动作是否已经结束。<br>如果我能够侦听动作是否正在执行，那么一切就好办了，如果前动作已完成，我就像情况1一样“先单键再双键”去操作，如果前动作未完成，我就判断用户是想只执行“双键”。</p>
<p>OK，js代码就是要像jquery的animate方法一样，构造一个动作的队列，存放用户积累下来的动作，并作好回调判断。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;当我如是想的时候，事实上我已想了很久。后来被各种纠结的差事冲乱了生活和心绪，并且心里认为这是个妥当无比的借口。找到了借口后一拖再拖，果然认识到deadline才是第一生产力的真理。最近，却是被朋友的一句话逼急了，他跟我说：我们的业务用到了css4的新属性！&lt;/p&gt;
&lt;p&gt;这句话的意思，大体等同于说，我买到了一个iphone6，亲你怎么看？&lt;br&gt;
    
    </summary>
    
    
      <category term="css3" scheme="//Sujuei.me/tags/css3/"/>
    
  </entry>
  
  <entry>
    <title>生产者-消费者模型的coffeescript实现</title>
    <link href="//Sujuei.me/2012/12/24/coffee-pc/"/>
    <id>//Sujuei.me/2012/12/24/coffee-pc/</id>
    <published>2012-12-24T15:51:00.000Z</published>
    <updated>2016-11-21T05:22:38.921Z</updated>
    
    <content type="html"><![CDATA[<p>这两天一直在看coffeescript相关的东西，也帮一个朋友搞了个生产者-消费者模型的C语言实现。想到还没用coffeescript真正意义上写过程序，那就尝试做一下吧。</p>
<p>其实<a href="http://read.douban.com/ebook/198648/" target="_blank" rel="external">《CoffeeScript小书》</a>是暑假实习时就买了，一直比较向往着函数式编程却拖延了很久没行动起来。小书只有几十页，本是github上一个开源的项目，我喜欢这种轻巧的文字。语法部分看下来，再看下类与继承，只花了半天的时间，而且心情非常愉悦，然后就可以开始我菜鸟的第一次试飞了。</p>
<p>生产者-消费者模型没什么好说的了，就是读写共享缓冲区，pv操作控制是否冲突。更多的就是冲着coffeescript来的。下面是一些凌乱但自认为有思考价值的记录，或许后续我会继续写一些coffeescript的学习笔记，再做深入的研究。<br><a id="more"></a></p>
<p>##<strong>demo，可尝试点击“生产”“消费”按钮</strong></p>
<p><iframe src="/assets/demo/coffee_pc_demo/pro-con.html" width="780" height="336" scrolling="no"></iframe></p>
<p>##<strong>litten如是想：</strong></p>
<ul>
<li>我一定要学一门，至少一门函数式风格编程语言，没有太深远的想法，就觉得它就是我的菜       </li>
<li>这个程序是66行的coffeescript代码，最后编译后得到了122行的js代码，说明编程效率提升显著          </li>
<li>括号，方括号，花括号，还有逗号有时候会多烦人，特别是使用过ExtJs的人，而coffeescript可以没有</li>
<li>用法简洁的jquery在coffeescript里面会更简洁                   </li>
<li>关于coffeescript的循环，它不推荐你使用for循环，而是使用“推导”，暴露在底层的循环只有while语法        </li>
<li>事件绑定时，使用=&gt;可以免去js上下文切换this的麻烦               </li>
<li>coffeescript的数组迭代方法非常的酷，三言两语说不清             </li>
<li>javascript会是下一个JVM吗？              </li>
<li>站在产品的角度，我认为coffeescript这名字太长了-_-!              </li>
</ul>
<p>##<strong>附上源码</strong><br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">N = <span class="number">10</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProCon</span></span></div><div class="line">	data: </div><div class="line">		mutex:<span class="number">1</span></div><div class="line">		empty:N</div><div class="line">		full:<span class="number">0</span></div><div class="line">		front:<span class="number">0</span></div><div class="line">		rear:<span class="number">0</span></div><div class="line">		buf: []</div><div class="line">	init:<span class="function">-&gt;</span></div><div class="line">		i = <span class="number">0</span></div><div class="line">		<span class="keyword">while</span> i&lt;N</div><div class="line">			newDom = $(<span class="string">'&lt;div class="bufBox"&gt;&lt;div class="bufCover"&gt;'</span>+i+<span class="string">'&lt;/div&gt;'</span>+i+<span class="string">'&lt;/div&gt;'</span>)</div><div class="line">			$(<span class="string">'#buf'</span>).append(newDom)</div><div class="line">			@data.buf.push <span class="string">'e'</span></div><div class="line">			i++</div><div class="line">		$(<span class="string">'#produce'</span>).click =&gt;</div><div class="line">			@producer()</div><div class="line">		$(<span class="string">'#consume'</span>).click =&gt;</div><div class="line">			@consumer()</div><div class="line">	p:<span class="function"><span class="params">(num)</span>-&gt;</span></div><div class="line">		<span class="keyword">return</span> --num</div><div class="line">	v:<span class="function"><span class="params">(num)</span>-&gt;</span></div><div class="line">		<span class="keyword">return</span> ++num</div><div class="line">	produceItem:<span class="function">-&gt;</span></div><div class="line">		$(<span class="string">'&lt;p class="desPro"&gt;生产了产品&lt;/p&gt;'</span>).insertBefore $(<span class="string">"#des p:first"</span>)</div><div class="line">		<span class="keyword">return</span> <span class="string">'m'</span></div><div class="line">	consumeItem:<span class="function">-&gt;</span></div><div class="line">		$(<span class="string">'&lt;p class="desCon"&gt;消费了产品&lt;/p&gt;'</span>).insertBefore $(<span class="string">"#des p:first"</span>)</div><div class="line">	enterItem:<span class="function"><span class="params">(item)</span> -&gt;</span></div><div class="line">		@data.front = (@data.front+<span class="number">1</span>)%N</div><div class="line">		@data.buf[@data.front] = item;</div><div class="line">		str = <span class="string">"存入产品<span class="subst">#&#123;@data.buf[@data.front]&#125;</span>到缓冲区<span class="subst">#&#123;@data.front&#125;</span>"</span></div><div class="line">		$(<span class="string">"&lt;p class='desPro'&gt;<span class="subst">#&#123;str&#125;</span>&lt;/p&gt;"</span>).insertBefore $(<span class="string">"#des p:first"</span>)</div><div class="line">		$($(<span class="string">'.bufCover'</span>)[@data.front]).animate </div><div class="line">			<span class="string">"height"</span>:<span class="string">"50px"</span></div><div class="line">	removeItem:<span class="function">-&gt;</span></div><div class="line">		@data.rear = (@data.rear + <span class="number">1</span>) % N;</div><div class="line">		@data.buf[@data.rear] = <span class="string">'e'</span>;</div><div class="line">		str = <span class="string">"取出产品<span class="subst">#&#123;@data.buf[@data.rear]&#125;</span>从缓冲区<span class="subst">#&#123;@data.rear&#125;</span>"</span></div><div class="line">		$(<span class="string">"&lt;p class='desCon'&gt;<span class="subst">#&#123;str&#125;</span>&lt;/p&gt;"</span>).insertBefore $(<span class="string">"#des p:first"</span>)</div><div class="line">		$($(<span class="string">'.bufCover'</span>)[@data.rear]).animate </div><div class="line">			<span class="string">"height"</span>:<span class="string">"0px"</span></div><div class="line">	producer:<span class="function">-&gt;</span></div><div class="line">		<span class="keyword">if</span> @data.full==N</div><div class="line">			$(<span class="string">"&lt;p class='desSpe'&gt;缓冲区已全满&lt;/p&gt;"</span>).insertBefore $(<span class="string">"#des p:first"</span>)</div><div class="line">			<span class="keyword">return</span></div><div class="line">		item = @produceItem()</div><div class="line">		@data.empty = @p(@data.empty)</div><div class="line">		@data.mutex = @p(@data.mutex)</div><div class="line">		@enterItem(item)</div><div class="line">		@data.mutex = @v(@data.mutex)</div><div class="line">		@data.full = @v(@data.full)</div><div class="line">	consumer:<span class="function">-&gt;</span></div><div class="line">		<span class="keyword">if</span> @data.empty==N</div><div class="line">			$(<span class="string">"&lt;p class='desSpe'&gt;缓冲区已空&lt;/p&gt;"</span>).insertBefore $(<span class="string">"#des p:first"</span>)</div><div class="line">			<span class="keyword">return</span></div><div class="line">		@data.full = @p(@data.full)</div><div class="line">		@data.mutex = @p(@data.mutex)</div><div class="line">		@removeItem()</div><div class="line">		@data.mutex = @v(@data.mutex)</div><div class="line">		@data.empty = @v(@data.empty)</div><div class="line">		@consumeItem()</div><div class="line">		</div><div class="line">procon = <span class="keyword">new</span> ProCon</div><div class="line">procon.init();</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这两天一直在看coffeescript相关的东西，也帮一个朋友搞了个生产者-消费者模型的C语言实现。想到还没用coffeescript真正意义上写过程序，那就尝试做一下吧。&lt;/p&gt;
&lt;p&gt;其实&lt;a href=&quot;http://read.douban.com/ebook/198648/&quot;&gt;《CoffeeScript小书》&lt;/a&gt;是暑假实习时就买了，一直比较向往着函数式编程却拖延了很久没行动起来。小书只有几十页，本是github上一个开源的项目，我喜欢这种轻巧的文字。语法部分看下来，再看下类与继承，只花了半天的时间，而且心情非常愉悦，然后就可以开始我菜鸟的第一次试飞了。&lt;/p&gt;
&lt;p&gt;生产者-消费者模型没什么好说的了，就是读写共享缓冲区，pv操作控制是否冲突。更多的就是冲着coffeescript来的。下面是一些凌乱但自认为有思考价值的记录，或许后续我会继续写一些coffeescript的学习笔记，再做深入的研究。&lt;br&gt;
    
    </summary>
    
    
      <category term="js" scheme="//Sujuei.me/tags/js/"/>
    
      <category term="coffeescript" scheme="//Sujuei.me/tags/coffeescript/"/>
    
  </entry>
  
  <entry>
    <title>css实现九宫格(二)</title>
    <link href="//Sujuei.me/2012/12/21/css-jiugongge2/"/>
    <id>//Sujuei.me/2012/12/21/css-jiugongge2/</id>
    <published>2012-12-21T05:54:00.000Z</published>
    <updated>2016-11-21T05:22:38.922Z</updated>
    
    <content type="html"><![CDATA[<p>书接上回，<a href="http://litten.github.com/2012/12/14/css-jiugongge/" target="_blank" rel="external">上回在这</a>。</p>
<blockquote>
<p>9个元素，每个50*50px，排成九宫格<br>默认是border颜色为blue，hover到格子上变成red（兼容到IE6）</p>
</blockquote>
<p><img src="/assets/blogImg/jiugongge1.jpg" alt="css题目">     </p>
<p>题目的关键是解决“公用边”，上次我主要做了两个方面的尝试：</p>
<blockquote>
<p>用负margin使元素的border叠加<br>用table的border-collapse实现边框合并</p>
</blockquote>
<p>这一次的思路则更加简明，也是个人认为是更好的方法。感谢<a href="http://weibo.com/u/1666828424" target="_blank" rel="external">队长</a>提供的思路。</p>
<a id="more"></a>
<p>##<strong>能不能不用border？</strong><br><img src="/assets/blogImg/jiugongge10.jpg" alt="一个格子的透视图，a其实充当了div的“边框”"><br>如果不用border，怎么实现hover后，格子四周变红呢？那肯定是两个dom嵌套在一起，一大一小，小的dom作为“格子”，大的dom作为格子的红色“边框”。先看我初始化的一个格子设定：<br>html：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>初始css:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">	#test div&#123;</div><div class="line">		width: 50px;</div><div class="line">		line-height: 50px;</div><div class="line">		text-align:center;</div><div class="line">		background: #AAA;</div><div class="line">	&#125;</div><div class="line">	#test a&#123;</div><div class="line">		width: 55px;</div><div class="line">		line-height: 55px;</div><div class="line">		float: left;</div><div class="line">	&#125;</div><div class="line">	#test a:hover&#123;</div><div class="line">		background: red;</div><div class="line">	&#125;</div><div class="line">```css</div><div class="line">由于a标签设置了宽度为55px，div标签设置了宽度为50px，这时候格子hover看起来只露出了**右边**的5px红色部分。          </div><div class="line"></div><div class="line">接下来，div添加属性&lt;code&gt;margin-top:5px;margin-right:5px&lt;/code&gt;，这时可以显示**上部**的5px边框。再接着，在div的容器，也就是a标签设置&lt;code&gt;padding-left:5px;padding-bottom:5px;&lt;/code&gt;，使格子**左边框**和**下边框**都显示出来。</div><div class="line"></div><div class="line">![完成一个格子的设置步骤](/assets/blogImg/jiugongge8.jpg)      </div><div class="line"></div><div class="line">那么为什么要将a标签设置为55px，再进行一系列关于margin和padding的设置呢，原因我们最后再说。</div><div class="line"></div><div class="line">因此修改后的css为：</div><div class="line">```css</div><div class="line">	#test div&#123;</div><div class="line">		width: 50px;</div><div class="line">		line-height: 50px;</div><div class="line">		text-align:center;</div><div class="line">		background: #AAA;</div><div class="line">		margin-right:5px;</div><div class="line">		margin-top:5px;</div><div class="line">	&#125;</div><div class="line">	#test a&#123;</div><div class="line">		width: 55px;</div><div class="line">		line-height: 55px;</div><div class="line">		float: left;</div><div class="line">		margin-right: -5px;</div><div class="line">		margin-bottom: -5px;</div><div class="line">	&#125;</div><div class="line">	#test a:hover&#123;</div><div class="line">		background: red;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>##<strong>九个格子会怎样？</strong><br>将a标签左浮动，同时添加到九个格子，这时候的效果是：两个格子之间会有10px的距离。</p>
<p>为解决“公用边”问题，在a标签添加负值的margin：<code>margin-right:-5px;margin-bottom:-5px;</code>。最后将最外层的容器#test的宽度和高度设置为170px(50<em>3+5</em>4)，背景设置为蓝色。这时候大功告成了。</p>
<p><img src="/assets/blogImg/jiugongge9.jpg" alt="完成九个格子的设置步骤">      </p>
<p>最终的代码是：<br>html：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>7<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>8<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>9<span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>css：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#test</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">170px</span>;</div><div class="line">	<span class="attribute">height</span>:<span class="number">170px</span>;</div><div class="line">	<span class="attribute">background</span>: blue;</div><div class="line">	<span class="attribute">margin</span>: <span class="number">0</span> auto;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test</span> <span class="selector-tag">div</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">line-height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">text-align</span>:center;</div><div class="line">	<span class="attribute">background</span>: <span class="number">#AAA</span>;</div><div class="line">	<span class="attribute">margin-right</span>:<span class="number">5px</span>;<span class="comment">/*这句不要也可以*/</span></div><div class="line">	<span class="attribute">margin-top</span>:<span class="number">5px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test</span> <span class="selector-tag">a</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">55px</span>;</div><div class="line">	<span class="attribute">line-height</span>: <span class="number">55px</span>;</div><div class="line">	<span class="attribute">float</span>: left;</div><div class="line">	<span class="attribute">text-decoration</span>: none;</div><div class="line">	<span class="attribute">padding-left</span>: <span class="number">5px</span>;</div><div class="line">	<span class="attribute">padding-bottom</span>: <span class="number">5px</span>;</div><div class="line">	<span class="attribute">margin-right</span>: -<span class="number">5px</span>;</div><div class="line">	<span class="attribute">margin-bottom</span>: -<span class="number">5px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line">	<span class="attribute">background</span>: red;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##<strong>巧妙在哪里？</strong></p>
<ul>
<li>a标签hover前不设置背景色，露出最外层#test的蓝色背景，看起来格子有蓝色的边框；a标签hover时背景色设置为红色，充当了格子的红色边框；       </li>
<li>a标签设置为55px是最关键的一点。按照此思路和题目要求，格子是50px大小，边框的dom应该是60px大小。而此时a设置为55px，因为a要设置<code>padding-left:5px;padding-bottom:5px;</code>，刚好a就有60px大小了；而a里面的div要设置<code>margin-top:5px;margin-right:5px</code>（其实margin-right也可以不加）,这时候margin和padding就达到了一个“中和”的效果，使布局不发生偏差。</li>
</ul>
<p>点此看<a href="/assets/demo/jiugongge_demo2.html">demo</a>。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;书接上回，&lt;a href=&quot;http://litten.github.com/2012/12/14/css-jiugongge/&quot;&gt;上回在这&lt;/a&gt;。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;9个元素，每个50*50px，排成九宫格&lt;br&gt;默认是border颜色为blue，hover到格子上变成red（兼容到IE6）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/assets/blogImg/jiugongge1.jpg&quot; alt=&quot;css题目&quot;&gt;     &lt;/p&gt;
&lt;p&gt;题目的关键是解决“公用边”，上次我主要做了两个方面的尝试：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;用负margin使元素的border叠加&lt;br&gt;用table的border-collapse实现边框合并&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这一次的思路则更加简明，也是个人认为是更好的方法。感谢&lt;a href=&quot;http://weibo.com/u/1666828424&quot;&gt;队长&lt;/a&gt;提供的思路。&lt;/p&gt;
    
    </summary>
    
    
      <category term="css" scheme="//Sujuei.me/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>分享一个IE6，7的CSS hack bug</title>
    <link href="//Sujuei.me/2012/12/17/share-a-css-hack/"/>
    <id>//Sujuei.me/2012/12/17/share-a-css-hack/</id>
    <published>2012-12-17T11:43:00.000Z</published>
    <updated>2016-11-21T05:22:38.942Z</updated>
    
    <content type="html"><![CDATA[<p>###一、分享一个IE6，7的css hack bug。<br><img src="/assets/blogImg/css_hack.jpg" alt="css hack">   </p>
<blockquote>
<p>IE和我们之间，肯定有一个是傻逼，如果它不是，那我们准是。不然很多事情没法解释…  ——多么痛的领悟 </p>
</blockquote>
<a id="more"></a>
<p>先看代码，或者点击看<a href="/assets/demo/hack_demo.html">demo</a><br>html:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#main</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</div><div class="line">	<span class="attribute">margin</span>: <span class="number">0</span> auto;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#main</span> <span class="selector-class">.box</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">margin-left</span>: <span class="number">10px</span>;</div><div class="line">	<span class="attribute">position</span>: relative;</div><div class="line">	<span class="attribute">float</span>: left;</div><div class="line">	<span class="attribute">background</span>: <span class="number">#333</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#main</span> <span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line">	<span class="attribute">z-index</span>: <span class="number">999</span>;</div><div class="line">	<span class="comment">/*background: #333;*/</span></div><div class="line">	<span class="comment">/*background: #999;*/</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>.box设置了的四行核心代码是：          </p>
<ul>
<li><code>float:left</code> - 左浮动         </li>
<li><code>margin-left: 10px</code> - 左外边距为10px            </li>
<li><code>position: relative</code> - 因为在box里面想用一个dom做绝对定位            </li>
<li><code>background: #333</code> - 设置background颜色为#333<br>当.box触发hover时，做了一步z-index的改变，这时候在IE6，7中出现bug：因margin-left失效，.box会向左移动10px；而且这时候设置margin-left是不起作用的，hover结束后.box也不会回到原来的位置。</li>
</ul>
<p>###二、淡定解决异次元的bug</p>
<p>诡异的事情最后水落石出：<strong>background属性居然影响了margin</strong>。</p>
<p>将.box:hover多加一行background属性，比如：<code>background: #999</code>，这样子在IE上“看上去”就解决了。<br><strong>但是</strong>，就当你以为解决了bug的时候，如果.box:hover的background颜色设置与hover之前的颜色一样，也就是设置为<code>background: #333</code>，阴魂不散的bug又会重新出现啦。</p>
<p>庆幸你的需求是background颜色不一样吧。如果还真是悲剧到要做成一样的颜色，解决的办法恐怕只能是取消.box的<code>position: relative</code>，然后多加一层dom容器了。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div class="box"&gt;</div><div class="line">	&lt;div style="position: relative"&gt;…&lt;/div&gt;</div><div class="line">	…</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure></p>
<p>友情link：<a href="http://xueran.github.com/blog/2012/12/17/csstest-jiugongge/" target="_blank" rel="external">xueran的这篇文字</a>。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;###一、分享一个IE6，7的css hack bug。&lt;br&gt;&lt;img src=&quot;/assets/blogImg/css_hack.jpg&quot; alt=&quot;css hack&quot;&gt;   &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;IE和我们之间，肯定有一个是傻逼，如果它不是，那我们准是。不然很多事情没法解释…  ——多么痛的领悟 &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="css" scheme="//Sujuei.me/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>css实现九宫格(一)</title>
    <link href="//Sujuei.me/2012/12/14/css-jiugongge/"/>
    <id>//Sujuei.me/2012/12/14/css-jiugongge/</id>
    <published>2012-12-14T11:15:00.000Z</published>
    <updated>2016-11-21T05:22:38.922Z</updated>
    
    <content type="html"><![CDATA[<p>前段时间，我的 leader Henry在群里面分享了一道<a href="http://www.etao.com/" target="_blank" rel="external">一淘</a>的面试题。         题目非常的有趣，忙完前阵的工作之后突然记起，也尝试做了一下。</p>
<blockquote>
<p>9个元素，每个50*50px，排成九宫格<br>默认是border颜色为blue，hover到格子上变成red（兼容到IE6）</p>
</blockquote>
<p><img src="/assets/blogImg/jiugongge1.jpg" alt="css题目">    </p>
<a id="more"></a>
<p>做成九宫格大家都会，但题目的陷阱就在hover上。鼠标hover到格子4，格子5时，其实他们“共用”了一条边。由于是纯css实现的，我们不可能说用js去动态改变dom，因此怎样实现“公用边”就成为了难点。</p>
<p><strong>尝试的过程：</strong>           </p>
<ul>
<li>我的第一个想法，用“叠加”的方式实现“公用边”；        </li>
<li>后来的想法，用table的border-collapse实现“公用边”；          </li>
<li>在table想法的基础上改进；</li>
<li>一种更简便的做法，不需要border，见九宫格(二)                       </li>
</ul>
<p>##<strong>我的第一个想法</strong>       </p>
<p>先做做看，尝试永远是第一步。我将9个div都设置了5px的border，排成了九宫格，添加了hover，这时候初始的效果是：<br><img src="/assets/blogImg/jiugongge2.jpg" alt="初始效果"><br>这样其实格子之间的距离是两倍border（10px）。需要再将中间的一竖（2，5，8）设置<code>margin-left:-5px;margin-right:-5px;</code>,再将中间的一横（3，4，5）设置<code>margin-top:-5px;margin-bottom:-5px;</code>，这样等于是强制把格子间的距离“拉”到5px。<br><img src="/assets/blogImg/jiugongge3.jpg" alt="把格子间的距离“拉”到5px"><br>到这一步，简单的九宫格是完成了，但hover之后会发现，格子的边会被挡住（格子5的下边和右边分别被格子8和格子6挡住）。因为这里“公用边”的思路准确来说是“重合边”，是用负值的margin强制定位的。而我的解决方式是hover时添加<code>z-index:999</code>，让hover到的格子在最上层显示而不会被挡住。同时，不要忘记在9个div的css里面添加一句让z-index生效的<code>position: relative;</code>，具体原因看<a href="http://www.csser.com/question/4f4332dedbc7b0ac4c00034e" target="_blank" rel="external">这里</a>。     </p>
<p>代码君：<br>1.html：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test0"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span>1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lr_indent"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span>3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tb_indent"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lr_indent tb_indent"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tb_indent"</span>&gt;</span>6<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span>7<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lr_indent"</span>&gt;</span>8<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span>9<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>2.css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#test0</span>&#123;</div><div class="line">	<span class="attribute">margin</span>: <span class="number">30px</span>;</div><div class="line">	<span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test0</span> <span class="selector-tag">div</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">float</span>: left;</div><div class="line">	<span class="attribute">background</span>: <span class="number">#eee</span>;</div><div class="line">	<span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#00f</span>;</div><div class="line">	<span class="attribute">text-align</span>: center;</div><div class="line">	<span class="attribute">line-height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">color</span>: <span class="number">#090</span>;</div><div class="line">	<span class="attribute">position</span>: relative;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test0</span> <span class="selector-class">.lr_indent</span>&#123;</div><div class="line">	<span class="attribute">margin-left</span>: -<span class="number">5px</span>;</div><div class="line">	<span class="attribute">margin-right</span>: -<span class="number">5px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test0</span> <span class="selector-class">.tb_indent</span>&#123;</div><div class="line">	<span class="attribute">margin-top</span>: -<span class="number">5px</span>;</div><div class="line">	<span class="attribute">margin-bottom</span>: -<span class="number">5px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test0</span> <span class="selector-tag">div</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line">	<span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#f00</span>;</div><div class="line">	<span class="attribute">z-index</span>: <span class="number">999</span>;</div><div class="line">	<span class="attribute">background</span>: <span class="number">#eee</span>;<span class="comment">/*必须加这一句，在IE6，7有bug*/</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>思考：这样的方式好吗？不够好。<br>这才是9宫格，如果是16，25，…，81个格子，设置margin缩进的人力代价是很高的。<br>兼容性，在IE6，7下，负值margin在hover时候有bug。</p>
</blockquote>
<p><img src="/assets/blogImg/jiugongge4.jpg" alt="ie6，7下，hover时负值margin-left不起效">      </p>
<p>##<strong>后来的想法</strong>      </p>
<p>经过第一次尝试，我得到一个经验：<code>要用一种通用的方法去解决“公用边”</code>，而不是分别设置.lr_indent和.tb_indent。<br>随即我想到了表格。作为table，它有个很突出的属性，就是合并border，css里面的设置为<code>border-collapse:collapse;</code>。ok，这就是key point。</p>
<p>按照这个思路，我简单的编写了代码，一开始我把hover定位到td上面去，发现hover时也会出现第一个想法中“挡住”的情况。而且，去将td的position改变，再添加z-index的方法是不可能有用的(z-index不会起效)。   </p>
<p>我的方法是在td中包含一个span，把hover定位到span中去，td设置为<code>position:relative;</code>，span设置为<code>position:absolute;</code>，这时候的hover就可以设置让span的border不被挡住展示了。<br>代码君又来了：<br>html：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test1"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>1<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>2<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>3<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>5<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>6<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>7<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>8<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>9<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>css：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">*&#123;</div><div class="line">	<span class="attribute">margin</span>:<span class="number">0</span>;</div><div class="line">	<span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">table</span>&#123;</div><div class="line">	<span class="attribute">border-collapse</span>: collapse;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test1</span> <span class="selector-tag">td</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">background</span>: <span class="number">#eee</span>;</div><div class="line">	<span class="attribute">position</span>: relative;</div><div class="line">	<span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#00f</span>;</div><div class="line">	<span class="attribute">text-align</span>: center;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test1</span> <span class="selector-tag">td</span> <span class="selector-tag">span</span>&#123;</div><div class="line">	<span class="attribute">color</span>: <span class="number">#090</span>;</div><div class="line">	<span class="attribute">display</span>:block;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">position</span>: absolute;</div><div class="line">	<span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">	<span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">	<span class="attribute">line-height</span>: <span class="number">50px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test1</span> <span class="selector-tag">td</span> <span class="selector-tag">span</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line">	<span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#f00</span>;</div><div class="line">	<span class="attribute">margin-top</span>:-<span class="number">5px</span>;</div><div class="line">	<span class="attribute">margin-left</span>: -<span class="number">5px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>别忘了span在hover时，必须设置一个负的<code>margein-top</code>和<code>margein-left</code>，以保证红色边框恰好定位在格子四周。见css君最后的片段。假如不设置，你看到的将是这样：<br><img src="/assets/blogImg/jiugongge5.jpg" alt="未设置span:hover的margin"><br>本以为已经大功告成了，在IE中测试却让我傻了眼：<br><img src="/assets/blogImg/jiugongge6.jpg" alt="IE7下的情景"><br>（ps：作为前端一枚，我已经做好了妥妥的心理准备，但此情此景还是让人喷出一口老血……）</p>
<p>##<strong>改进，改进</strong>         </p>
<p>说实话，table和div之争这么多年，大家都在页面中用越来越多的div，而越发的鄙视table，反而对table的熟悉程度反应了前端们的基础是否扎实。吃一堑长一智，这句话特别适用于在table中翻江倒海的亲们。</p>
<p>改进！</p>
<p>首先这个bug（也无所谓是不是bug，算是浏览器的差异性吧）我知道，在table的td里面设置了<code>position:relative;</code>就会在IE中出现这样的情况。注意是所有的IE哦，包括IE10。而根据第二个思路，最后的hover定位的元素为span，它本身设定为<code>position:absolute;</code>它的父级元素必须得设置<code>position:relative;</code>才能完成题目功能，这是毋庸置疑的。</p>
<p>既然现在span的父级td不能设置<code>position:relative;</code>，我就在它们之间添加一个div，用来做span的容器。 </p>
<p>代码君再一次来了：<br>html:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test2"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">table</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>1<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>2<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>3<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>4<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>5<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>6<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>7<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>8<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>9<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>css:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">*&#123;</div><div class="line">	<span class="attribute">margin</span>:<span class="number">0</span>;</div><div class="line">	<span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">table</span>&#123;</div><div class="line">	<span class="attribute">border-collapse</span>: collapse;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test2</span> <span class="selector-tag">td</span>&#123;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">background</span>: <span class="number">#eee</span>;</div><div class="line">	<span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#00f</span>;</div><div class="line">	<span class="attribute">text-align</span>: center;</div><div class="line">	<span class="attribute">vertical-align</span>: top;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test2</span> <span class="selector-tag">td</span> <span class="selector-tag">div</span>&#123;</div><div class="line">	<span class="attribute">position</span>:relative;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test2</span> <span class="selector-tag">td</span> <span class="selector-tag">div</span> <span class="selector-tag">span</span>&#123;</div><div class="line">	<span class="attribute">color</span>: <span class="number">#090</span>;</div><div class="line">	<span class="attribute">display</span>:block;</div><div class="line">	<span class="attribute">width</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">height</span>: <span class="number">50px</span>;</div><div class="line">	<span class="attribute">position</span>: absolute;</div><div class="line">	<span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">	<span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">	<span class="attribute">line-height</span>: <span class="number">50px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#test2</span> <span class="selector-tag">td</span> <span class="selector-tag">div</span> <span class="selector-tag">span</span><span class="selector-pseudo">:hover</span>&#123;</div><div class="line">	<span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#f00</span>;</div><div class="line">	<span class="attribute">margin-left</span>: -<span class="number">5px</span>;</div><div class="line">	<span class="attribute">margin-top</span>: -<span class="number">5px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>OK，效果达成！<br><img src="/assets/blogImg/jiugongge7.jpg" alt="最终完成的效果"><br>可以猛点这里看看<a href="/assets/demo/jiugongge_demo.html">demo</a>。        </p>
<p><strong>最后吐槽，不对，总结一下下：</strong>           </p>
<blockquote>
<p>先到IE上去测，再转到其它浏览器，以少走弯路，这叫擒贼先擒王-_-!；<br>win8的metro布局最近挺流行的，有时候table比div好用；<br>IE君，你真是……此处省略1024个字                </p>
</blockquote>
<p>这个系列打算写两篇文章，下一篇介绍另外一种更简洁的方法。:)</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前段时间，我的 leader Henry在群里面分享了一道&lt;a href=&quot;http://www.etao.com/&quot;&gt;一淘&lt;/a&gt;的面试题。         题目非常的有趣，忙完前阵的工作之后突然记起，也尝试做了一下。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;9个元素，每个50*50px，排成九宫格&lt;br&gt;默认是border颜色为blue，hover到格子上变成red（兼容到IE6）&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;/assets/blogImg/jiugongge1.jpg&quot; alt=&quot;css题目&quot;&gt;    &lt;/p&gt;
    
    </summary>
    
    
      <category term="css" scheme="//Sujuei.me/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="//Sujuei.me/2012/12/13/hello-world/"/>
    <id>//Sujuei.me/2012/12/13/hello-world/</id>
    <published>2012-12-12T17:39:00.000Z</published>
    <updated>2016-11-21T05:22:38.932Z</updated>
    
    <content type="html"><![CDATA[<p>在Winiex的推荐和帮助下，这个octopress博客终于搭建起来了。</p>
<p>折腾了两天多，在github page上看到自己的博客加载下来时，突然有种错综复杂的恍惚感。是的，它不是qq空间，不是新浪博客，不是豆瓣小站，也不是贴吧。它更像是属于自己的一块小小的领地，因而我满足于这种归属感。我愿在上面安静劳作。</p>
<p>一个农民，通过自身努力终于分到了一块地，不再需要在地主的土地上创造流量价值时，于是翻身作主的他可以宣告说：Hello World。当然这个农民确切来说是个码农。</p>
<p>感谢Zespia提供的slash主题。我很喜欢这种色调。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在Winiex的推荐和帮助下，这个octopress博客终于搭建起来了。&lt;/p&gt;
&lt;p&gt;折腾了两天多，在github page上看到自己的博客加载下来时，突然有种错综复杂的恍惚感。是的，它不是qq空间，不是新浪博客，不是豆瓣小站，也不是贴吧。它更像是属于自己的一块小小的领地
    
    </summary>
    
    
      <category term="杂谈" scheme="//Sujuei.me/tags/%E6%9D%82%E8%B0%88/"/>
    
      <category term="octopress" scheme="//Sujuei.me/tags/octopress/"/>
    
  </entry>
  
</feed>
